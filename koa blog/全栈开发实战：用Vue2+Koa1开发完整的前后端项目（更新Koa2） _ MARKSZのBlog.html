<!DOCTYPE html>
<!-- saved from url=(0069)https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/f(4).txt"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/shares.json"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/shares(1).json"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(1)"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/1.txt"></script><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/1(1).txt"></script><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2）"><meta name="keywords" content="前端,Vue,Nodejs,Koa"><meta name="author" content="Molunerfinn"><meta name="copyright" content="Molunerfinn"><title>全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） | MARKSZのBlog</title><link rel="shortcut icon" href="https://molunerfinn.com/favicon.ico"><link rel="stylesheet" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/index.css"><link rel="stylesheet" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/font-awesome.min.css"><link rel="dns-prefetch" href="https://cdn.staticfile.org/"><link rel="dns-prefetch" href="https://cdn.bootcss.com/"><link rel="dns-prefetch" href="https://creativecommons.org/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net/"><link rel="stylesheet" type="text/css" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/instantsearch.min.css"><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/osd.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/ca-pub-2358465699478507.js.下载"></script><script async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/analytics.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/hm.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/instantsearch.min.js.下载" defer=""></script><link rel="stylesheet" type="text/css" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/gitalk.min.css"><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/gitalk.min.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/md5.min.js.下载"></script><link rel="manifest" href="https://molunerfinn.com/manifest.json"><link rel="manifest" href="https://molunerfinn.com/manifest.json"><script async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/f(5).txt"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2358465699478507",enable_page_level_ads:"true"})</script><link rel="dns-prefetch" href="https://hm.baidu.com/"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?19a7ebdbb87f2403773c7ab0cae16d21";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com/"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-105869658-1","auto"),ga("send","pageview")</script><script>var GLOBAL_CONFIG={root:"/",algolia:{appId:"BGLU1ICJFH",apiKey:"85948beeaf121424b806828adc21c8b5",indexName:"mofinn",hits:{per_page:10},languages:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}.",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,copy:{success:"Copy successfully",error:"Copy error",noSupport:"The browser does not support"}}</script><link rel="preload" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/f(6).txt" as="script"><script type="text/javascript" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/f(6).txt"></script><link rel="preload" href="https://pagead2.googlesyndication.com/pagead/js/r20190408/r20190131/show_ads_impl.js" as="script"><style type="text/css">.at-icon{fill:#fff;border:0}.at-icon-wrapper{display:inline-block;overflow:hidden}a .at-icon-wrapper{cursor:pointer}.at-rounded,.at-rounded-element .at-icon-wrapper{border-radius:12%}.at-circular,.at-circular-element .at-icon-wrapper{border-radius:50%}.addthis_32x32_style .at-icon{width:2pc;height:2pc}.addthis_24x24_style .at-icon{width:24px;height:24px}.addthis_20x20_style .at-icon{width:20px;height:20px}.addthis_16x16_style .at-icon{width:1pc;height:1pc}#at16lb{display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:1001;background-color:#000;opacity:.001}#at_complete,#at_error,#at_share,#at_success{position:static!important}.at15dn{display:none}#at15s,#at16p,#at16p form input,#at16p label,#at16p textarea,#at_share .at_item{font-family:arial,helvetica,tahoma,verdana,sans-serif!important;font-size:9pt!important;outline-style:none;outline-width:0;line-height:1em}* html #at15s.mmborder{position:absolute!important}#at15s.mmborder{position:fixed!important;width:250px!important}#at15s{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);float:none;line-height:1em;margin:0;overflow:visible;padding:5px;text-align:left;position:absolute}#at15s a,#at15s span{outline:0;direction:ltr;text-transform:none}#at15s .at-label{margin-left:5px}#at15s .at-icon-wrapper{width:1pc;height:1pc;vertical-align:middle}#at15s .at-icon{width:1pc;height:1pc}.at4-icon{display:inline-block;background-repeat:no-repeat;background-position:top left;margin:0;overflow:hidden;cursor:pointer}.addthis_16x16_style .at4-icon,.addthis_default_style .at4-icon,.at4-icon,.at-16x16{width:1pc;height:1pc;line-height:1pc;background-size:1pc!important}.addthis_32x32_style .at4-icon,.at-32x32{width:2pc;height:2pc;line-height:2pc;background-size:2pc!important}.addthis_24x24_style .at4-icon,.at-24x24{width:24px;height:24px;line-height:24px;background-size:24px!important}.addthis_20x20_style .at4-icon,.at-20x20{width:20px;height:20px;line-height:20px;background-size:20px!important}.at4-icon.circular,.circular .at4-icon,.circular.aticon{border-radius:50%}.at4-icon.rounded,.rounded .at4-icon{border-radius:4px}.at4-icon-left{float:left}#at15s .at4-icon{text-indent:20px;padding:0;overflow:visible;white-space:nowrap;background-size:1pc;width:1pc;height:1pc;background-position:top left;display:inline-block;line-height:1pc}.addthis_vertical_style .at4-icon,.at4-follow-container .at4-icon{margin-right:5px}html>body #at15s{width:250px!important}#at15s.atm{background:none!important;padding:0!important;width:10pc!important}#at15s_inner{background:#fff;border:1px solid #fff;margin:0}#at15s_head{position:relative;background:#f2f2f2;padding:4px;cursor:default;border-bottom:1px solid #e5e5e5}.at15s_head_success{background:#cafd99!important;border-bottom:1px solid #a9d582!important}.at15s_head_success a,.at15s_head_success span{color:#000!important;text-decoration:none}#at15s_brand,#at15sptx,#at16_brand{position:absolute}#at15s_brand{top:4px;right:4px}.at15s_brandx{right:20px!important}a#at15sptx{top:4px;right:4px;text-decoration:none;color:#4c4c4c;font-weight:700}#at15sptx:hover{text-decoration:underline}#at16_brand{top:5px;right:30px;cursor:default}#at_hover{padding:4px}#at_hover .at_item,#at_share .at_item{background:#fff!important;float:left!important;color:#4c4c4c!important}#at_share .at_item .at-icon-wrapper{margin-right:5px}#at_hover .at_bold{font-weight:700;color:#000!important}#at_hover .at_item{width:7pc!important;padding:2px 3px!important;margin:1px;text-decoration:none!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover{margin:0!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover,#at_share .at_item.athov,#at_share .at_item:hover{background:#f2f2f2!important;border:1px solid #e5e5e5;color:#000!important;text-decoration:none}.ipad #at_hover .at_item:focus{background:#fff!important;border:1px solid #fff}.at15t{display:block!important;height:1pc!important;line-height:1pc!important;padding-left:20px!important;background-position:0 0;text-align:left}.addthis_button,.at15t{cursor:pointer}.addthis_toolbox a.at300b,.addthis_toolbox a.at300m{width:auto}.addthis_toolbox a{margin-bottom:5px;line-height:initial}.addthis_toolbox.addthis_vertical_style{width:200px}.addthis_button_facebook_like .fb_iframe_widget{line-height:100%}.addthis_button_facebook_like iframe.fb_iframe_widget_lift{max-width:none}.addthis_toolbox a.addthis_button_counter,.addthis_toolbox a.addthis_button_facebook_like,.addthis_toolbox a.addthis_button_facebook_send,.addthis_toolbox a.addthis_button_facebook_share,.addthis_toolbox a.addthis_button_foursquare,.addthis_toolbox a.addthis_button_linkedin_counter,.addthis_toolbox a.addthis_button_pinterest_pinit,.addthis_toolbox a.addthis_button_tweet{display:inline-block}.addthis_toolbox span.addthis_follow_label{display:none}.addthis_toolbox.addthis_vertical_style span.addthis_follow_label{display:block;white-space:nowrap}.addthis_toolbox.addthis_vertical_style a{display:block}.addthis_toolbox.addthis_vertical_style.addthis_32x32_style a{line-height:2pc;height:2pc}.addthis_toolbox.addthis_vertical_style .at300bs{margin-right:4px;float:left}.addthis_toolbox.addthis_20x20_style span{line-height:20px}.addthis_toolbox.addthis_32x32_style span{line-height:2pc}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact,.addthis_toolbox.addthis_pill_combo_style a{float:left}.addthis_toolbox.addthis_pill_combo_style a.addthis_button_tweet{margin-top:-2px}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact{margin-right:4px}.addthis_default_style .addthis_separator{margin:0 5px;display:inline}div.atclear{clear:both}.addthis_default_style .addthis_separator,.addthis_default_style .at4-icon,.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300bs,.addthis_default_style .at300m{float:left}.at300b img,.at300bo img{border:0}a.at300b .at4-icon,a.at300m .at4-icon{display:block}.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300m{padding:0 2px}.at300b,.at300bo,.at300bs,.at300m{cursor:pointer}.addthis_button_facebook_like.at300b:hover,.addthis_button_facebook_like.at300bs:hover,.addthis_button_facebook_send.at300b:hover,.addthis_button_facebook_send.at300bs:hover{opacity:1}.addthis_20x20_style .at15t,.addthis_20x20_style .at300bs{overflow:hidden;display:block;height:20px!important;width:20px!important;line-height:20px!important}.addthis_32x32_style .at15t,.addthis_32x32_style .at300bs{overflow:hidden;display:block;height:2pc!important;width:2pc!important;line-height:2pc!important}.at300bs{overflow:hidden;display:block;background-position:0 0;height:1pc;width:1pc;line-height:1pc!important}.addthis_default_style .at15t_compact,.addthis_default_style .at15t_expanded{margin-right:4px}#at_share .at_item{width:123px!important;padding:4px;margin-right:2px;border:1px solid #fff}#at16p{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);z-index:10000001;position:absolute;top:50%;left:50%;width:300px;padding:10px;margin:0 auto;margin-top:-185px;margin-left:-155px;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#5e5e5e}#at_share{margin:0;padding:0}#at16pt{position:relative;background:#f2f2f2;height:13px;padding:5px 10px}#at16pt a,#at16pt h4{font-weight:700}#at16pt h4{display:inline;margin:0;padding:0;font-size:9pt;color:#4c4c4c;cursor:default}#at16pt a{position:absolute;top:5px;right:10px;color:#4c4c4c;text-decoration:none;padding:2px}#at15sptx:focus,#at16pt a:focus{outline:thin dotted}#at15s #at16pf a{top:1px}#_atssh{width:1px!important;height:1px!important;border:0!important}.atm{width:10pc!important;padding:0;margin:0;line-height:9pt;letter-spacing:normal;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#444;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);padding:4px}.atm-f{text-align:right;border-top:1px solid #ddd;padding:5px 8px}.atm-i{background:#fff;border:1px solid #d5d6d6;padding:0;margin:0;box-shadow:1px 1px 5px rgba(0,0,0,.15)}.atm-s{margin:0!important;padding:0!important}.atm-s a:focus{border:transparent;outline:0;transition:none}#at_hover.atm-s a,.atm-s a{display:block;text-decoration:none;padding:4px 10px;color:#235dab!important;font-weight:400;font-style:normal;transition:none}#at_hover.atm-s .at_bold{color:#235dab!important}#at_hover.atm-s a:hover,.atm-s a:hover{background:#2095f0;text-decoration:none;color:#fff!important}#at_hover.atm-s .at_bold{font-weight:700}#at_hover.atm-s a:hover .at_bold{color:#fff!important}.atm-s a .at-label{vertical-align:middle;margin-left:5px;direction:ltr}.at_PinItButton{display:block;width:40px;height:20px;padding:0;margin:0;background-image:url(//s7.addthis.com/static/t00/pinit00.png);background-repeat:no-repeat}.at_PinItButton:hover{background-position:0 -20px}.addthis_toolbox .addthis_button_pinterest_pinit{position:relative}.at-share-tbx-element .fb_iframe_widget span{vertical-align:baseline!important}#at16pf{height:auto;text-align:right;padding:4px 8px}.at-privacy-info{position:absolute;left:7px;bottom:7px;cursor:pointer;text-decoration:none;font-family:helvetica,arial,sans-serif;font-size:10px;line-height:9pt;letter-spacing:.2px;color:#666}.at-privacy-info:hover{color:#000}.body .wsb-social-share .wsb-social-share-button-vert{padding-top:0;padding-bottom:0}.body .wsb-social-share.addthis_counter_style .addthis_button_tweet.wsb-social-share-button{padding-top:40px}.body .wsb-social-share.addthis_counter_style .addthis_button_facebook_like.wsb-social-share-button{padding-top:21px}@media print{#at4-follow,#at4-share,#at4-thankyou,#at4-whatsnext,#at4m-mobile,#at15s,.at4,.at4-recommended{display:none!important}}@media screen and (max-width:400px){.at4win{width:100%}}@media screen and (max-height:700px) and (max-width:400px){.at4-thankyou-inner .at4-recommended-container{height:122px;overflow:hidden}.at4-thankyou-inner .at4-recommended .at4-recommended-item:first-child{border-bottom:1px solid #c5c5c5}}</style><style type="text/css">.at-branding-logo{font-family:helvetica,arial,sans-serif;text-decoration:none;font-size:10px;display:inline-block;margin:2px 0;letter-spacing:.2px}.at-branding-logo .at-branding-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////+GlNUkcc1QAAAB1JREFUeNpiYIQDBjQmAwMmkwEM0JnY1WIxFyDAABGeAFEudiZsAAAAAElFTkSuQmCC")}.at-branding-logo .at-branding-icon,.at-branding-logo .at-privacy-icon{display:inline-block;height:10px;width:10px;margin-left:4px;margin-right:3px;margin-bottom:-1px;background-repeat:no-repeat}.at-branding-logo .at-privacy-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAKCAMAAABR24SMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABhQTFRF8fr9ot/xXcfn2/P5AKva////////AKTWodjhjAAAAAd0Uk5T////////ABpLA0YAAAA6SURBVHjaJMzBDQAwCAJAQaj7b9xifV0kUKJ9ciWxlzWEWI5gMF65KUTv0VKkjVeTerqE/x7+9BVgAEXbAWI8QDcfAAAAAElFTkSuQmCC")}.at-branding-logo span{text-decoration:none}.at-branding-logo .at-branding-addthis,.at-branding-logo .at-branding-powered-by{color:#666}.at-branding-logo .at-branding-addthis:hover{color:#333}.at-cv-with-image .at-branding-addthis,.at-cv-with-image .at-branding-addthis:hover{color:#fff}a.at-branding-logo:visited{color:initial}.at-branding-info{display:inline-block;padding:0 5px;color:#666;border:1px solid #666;border-radius:50%;font-size:10px;line-height:9pt;opacity:.7;transition:all .3s ease;text-decoration:none}.at-branding-info span{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.at-branding-info:before{content:'i';font-family:Times New Roman}.at-branding-info:hover{color:#0780df;border-color:#0780df}</style><script type="text/javascript" charset="utf-8" async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/layers.7745e3f0a0a2fc3494ea.js.下载"></script><style type="text/css">.at-share-dock.atss{top:auto;left:0;right:0;bottom:0;width:100%;max-width:100%;z-index:1000200;box-shadow:0 0 1px 1px #e2dfe2}.at-share-dock.at-share-dock-zindex-hide{z-index:-1!important}.at-share-dock.atss-top{bottom:auto;top:0}.at-share-dock a{width:auto;transition:none;color:#fff;text-decoration:none;box-sizing:content-box;-webkit-box-sizing:content-box;-moz-box-sizing:content-box}.at-share-dock a:hover{width:auto}.at-share-dock .at4-count{height:43px;padding:5px 0 0;line-height:20px;background:#fff;font-family:Helvetica neue,arial}.at-share-dock .at4-count span{width:100%}.at-share-dock .at4-count .at4-share-label{color:#848484;font-size:10px;letter-spacing:1px}.at-share-dock .at4-count .at4-counter{top:2px;position:relative;display:block;color:#222;font-size:22px}.at-share-dock.at-shfs-medium .at4-count{height:36px;line-height:1pc;padding-top:4px}.at-share-dock.at-shfs-medium .at4-count .at4-counter{font-size:18px}.at-share-dock.at-shfs-medium .at-share-btn .at-icon-wrapper,.at-share-dock.at-shfs-medium a .at-icon-wrapper{padding:6px 0}.at-share-dock.at-shfs-small .at4-count{height:26px;line-height:1;padding-top:3px}.at-share-dock.at-shfs-small .at4-count .at4-share-label{font-size:8px}.at-share-dock.at-shfs-small .at4-count .at4-counter{font-size:14px}.at-share-dock.at-shfs-small .at-share-btn .at-icon-wrapper,.at-share-dock.at-shfs-small a .at-icon-wrapper{padding:4px 0}</style><style type="text/css">div.at-share-close-control.ats-dark,div.at-share-open-control-left.ats-dark,div.at-share-open-control-right.ats-dark{background:#262b30}div.at-share-close-control.ats-light,div.at-share-open-control-left.ats-light,div.at-share-open-control-right.ats-light{background:#fff}div.at-share-close-control.ats-gray,div.at-share-open-control-left.ats-gray,div.at-share-open-control-right.ats-gray{background:#f2f2f2}.atss{position:fixed;top:20%;width:3pc;z-index:100020;background:none}.at-share-close-control{position:relative;width:3pc;overflow:auto}.at-share-open-control-left{position:fixed;top:20%;z-index:100020;left:0;width:22px}.at-share-close-control .at4-arrow.at-left{float:right}.atss-left{left:0;float:left;right:auto}.atss-right{left:auto;float:right;right:0}.atss-right.at-share-close-control .at4-arrow.at-right{position:relative;right:0;overflow:auto}.atss-right.at-share-close-control .at4-arrow{float:left}.at-share-open-control-right{position:fixed;top:20%;z-index:100020;right:0;width:22px;float:right}.atss-right .at-share-close-control .at4-arrow{float:left}.atss.atss-right a{float:right}.atss.atss-right .at4-share-title{float:right;overflow:hidden}.atss .at-share-btn,.atss a{position:relative;display:block;width:3pc;margin:0;outline-offset:-1px;text-align:center;float:left;transition:width .15s ease-in-out;overflow:hidden;background:#e8e8e8;z-index:100030;cursor:pointer}.at-share-btn::-moz-focus-inner{border:0;padding:0}.atss-right .at-share-btn{float:right}.atss .at-share-btn{border:0;padding:0}.atss .at-share-btn:focus,.atss .at-share-btn:hover,.atss a:focus,.atss a:hover{width:4pc}.atss .at-share-btn .at-icon-wrapper,.atss a .at-icon-wrapper{display:block;padding:8px 0}.atss .at-share-btn:last-child,.atss a:last-child{border:none}.atss .at-share-btn span .at-icon,.atss a span .at-icon{position:relative;top:0;left:0;display:block;background-repeat:no-repeat;background-position:50% 50%;width:2pc;height:2pc;line-height:2pc;border:none;padding:0;margin:0 auto;overflow:hidden;cursor:pointer;cursor:hand}.at4-share .at-custom-sidebar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-right:4px;display:inline-block;text-align:center}.at4-share .at-custom-sidebar-count{font-size:17px;line-height:1.25em;color:#222}.at4-share .at-custom-sidebar-text{font-size:9px;line-height:1.25em;color:#888;letter-spacing:1px}.at4-share .at4-share-count-container{position:absolute;left:0;right:auto;top:auto;bottom:0;width:100%;color:#fff;background:inherit}.at4-share .at4-share-count,.at4-share .at4-share-count-container{line-height:1pc;font-size:10px}.at4-share .at4-share-count{text-indent:0;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-weight:200;width:100%;height:1pc}.at4-share .at4-share-count-anchor{padding-bottom:8px;text-decoration:none;transition:padding .15s ease-in-out .15s,width .15s ease-in-out}</style><style type="text/css">#at4-drawer-outer-container{top:0;width:20pc;position:fixed}#at4-drawer-outer-container.at4-drawer-inline{position:relative}#at4-drawer-outer-container.at4-drawer-inline.at4-drawer-right{float:right;right:0;left:auto}#at4-drawer-outer-container.at4-drawer-inline.at4-drawer-left{float:left;left:0;right:auto}#at4-drawer-outer-container.at4-drawer-shown,#at4-drawer-outer-container.at4-drawer-shown *{z-index:999999}#at4-drawer-outer-container,#at4-drawer-outer-container .at4-drawer-outer,#at-drawer{height:100%;overflow-y:auto;overflow-x:hidden}.at4-drawer-push-content-right-back{position:relative;right:0}.at4-drawer-push-content-right{position:relative;left:20pc!important}.at4-drawer-push-content-left-back{position:relative;left:0}.at4-drawer-push-content-left{position:relative;right:20pc!important}#at4-drawer-outer-container.at4-drawer-right{left:auto;right:-20pc}#at4-drawer-outer-container.at4-drawer-left{right:auto;left:-20pc}#at4-drawer-outer-container.at4-drawer-shown.at4-drawer-right{left:auto;right:0}#at4-drawer-outer-container.at4-drawer-shown.at4-drawer-left{right:auto;left:0}#at-drawer{top:0;z-index:9999999;height:100%;animation-duration:.4s}#at-drawer.drawer-push.at-right{right:-20pc}#at-drawer.drawer-push.at-left{left:-20pc}#at-drawer .at-recommended-label{padding:0 0 0 20px;color:#999;line-height:3pc;font-size:18px;font-weight:300;cursor:default}#at-drawer-arrow{width:30px;height:5pc}#at-drawer-arrow.ats-dark{background:#262b30}#at-drawer-arrow.ats-gray{background:#f2f2f2}#at-drawer-open-arrow{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAABcCAYAAAC1OT8uAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk3ODNCQjdERUQ3QjExRTM5NjFGRUZBODc3MTIwMTNCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk3ODNCQjdFRUQ3QjExRTM5NjFGRUZBODc3MTIwMTNCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTc4M0JCN0JFRDdCMTFFMzk2MUZFRkE4NzcxMjAxM0IiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTc4M0JCN0NFRDdCMTFFMzk2MUZFRkE4NzcxMjAxM0IiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7kstzCAAAB4ElEQVR42uyWv0oDQRDGb9dYimgVjliID2Ca9AGfwtZob2Grja1PIFj7EhGCYK99VPBPOkVMp8X5rc6FeN7dfjOksMjAxwXZ3667OzvfLKRr682l5ZV9aDh+fxsnRHhoDzqGLjFBi4XOoFtoAxowoB893o/w7WpAl/+QgQMBwwRdTPhUC2lAV/wDA7qy5WOgq9psHejqTqkKdLE7KYCv0JZjMgBgB58raBG6mP1K6j2pT099T+qMUOeeOss1wDcEIA1PnQXy576rAUI0oFMoC7VCnn40Gs8Pd4lAiXNUKmJ0lh1mPzGEWiyUCqAGW3Pwv4IvUJsFO9CHgP3Zr6Te0xwgAf3LxaAjS241pbikCRkOg+nSJdV4p8HOPl3vvRYI5dtrgVDvvcWovcWovcWovcWovcWovcWovQChWNywNpqvdAKtQp/QNmPUIQ6kwwqt2Xmsxf6GMPM1Pptsbz45CPmXqKb+15Gz4J/LZcDSNIqBlQlbB0afe1mmUDWiCNKFZRq0VKMeXY1CTDq2sJLWsCmoaBBRqNRR6qBKC6qCaj2rDIqaXBGiXHEaom00h1S+K3fVlr6HNuqgvgCh0+owt21bybQn8+mZ78mcEebcM2e5+T2ZX24ZqCph0qn1vgQYAJ/KDpLQr2tPAAAAAElFTkSuQmCC);background-repeat:no-repeat;width:13px;height:23px;margin:28px 0 0 8px}.at-left #at-drawer-open-arrow{background-position:0 -46px}.ats-dark #at-drawer-open-arrow{background-position:0 -23px}.ats-dark.at-left #at-drawer-open-arrow{background-position:0 -69px}#at-drawer-arrow.at4-drawer-modern-browsers{position:fixed;top:40%;background-repeat:no-repeat;background-position:0 0!important;z-index:9999999}.at4-drawer-inline #at-drawer-arrow{position:absolute}#at-drawer-arrow.at4-drawer-modern-browsers.at-right{right:0}#at-drawer-arrow.at4-drawer-modern-browsers.at-left{left:0}.at4-drawer-push-animation-left{transition:left .4s ease-in-out .15s}.at4-drawer-push-animation-right{transition:right .4s ease-in-out .15s}#at-drawer.drawer-push.at4-drawer-push-animation-right{right:0}#at-drawer.drawer-push.at4-drawer-push-animation-right-back{right:-20pc!important}#at-drawer.drawer-push.at4-drawer-push-animation-left{left:0}#at-drawer.drawer-push.at4-drawer-push-animation-left-back{left:-20pc!important}#at-drawer .at4-closebutton.drawer-close{content:'X';color:#999;display:block;position:absolute;margin:0;top:0;right:0;width:3pc;height:45px;line-height:45px;overflow:hidden;opacity:.5}#at-drawer.ats-dark .at4-closebutton.drawer-close{color:#fff}#at-drawer .at4-closebutton.drawer-close:hover{opacity:1}#at-drawer.ats-dark.at4-recommended .at4-logo-container a{color:#666}#at-drawer.at4-recommended .at4-recommended-vertical{padding:0}#at-drawer.at4-recommended .at4-recommended-item .sponsored-label{margin:2px 0 0 21px;color:#ddd}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item{position:relative;padding:0;width:20pc;height:180px;margin:0}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img a:after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);z-index:1000000;transition:all .2s ease-in-out}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item.at-hover .at4-recommended-item-img a:after{background:rgba(0,0,0,.8)}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img,#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img a,#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img img{width:20pc;height:180px;float:none}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption{width:100%;position:absolute;bottom:0;left:0;height:70px}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4{color:#fff;position:absolute;height:52px;top:0;left:20px;right:20px;margin:0;padding:0;line-height:25px;font-size:20px;font-weight:600;z-index:1000001;text-decoration:none;text-transform:none}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4 a:hover{text-decoration:none}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4 a:link{color:#fff}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption small{position:absolute;top:auto;bottom:10px;left:20px;width:auto;color:#ccc}#at-drawer.at4-recommended .at4-logo-container{margin-left:20px}#at-drawer.ats-dark.at4-recommended .at4-logo-container a:hover{color:#fff}#at-drawer.at4-recommended .at-logo{margin:0}</style><style type="text/css">.at4-follow.at-mobile{display:none!important}.at4-follow{position:fixed;top:0;right:0;font-weight:400;color:#666;cursor:default;z-index:10001}.at4-follow .at4-follow-inner{position:relative;padding:10px 24px 10px 15px}.at4-follow-inner,.at-follow-open-control{border:0 solid #c5c5c5;border-width:1px 0 1px 1px;margin-top:-1px}.at4-follow .at4-follow-container{margin-left:9pt}.at4-follow.at4-follow-24 .at4-follow-container{height:24px;line-height:23px;font-size:13px}.at4-follow.at4-follow-32 .at4-follow-container{width:15pc;height:2pc;line-height:2pc;font-size:14px}.at4-follow .at4-follow-container .at-follow-label{display:inline-block;height:24px;line-height:24px;margin-right:10px;padding:0;cursor:default;float:left}.at4-follow .at4-follow-container .at-icon-wrapper{height:24px;width:24px}.at4-follow.ats-transparent .at4-follow-inner,.at-follow-open-control.ats-transparent{border-color:transparent}.at4-follow.ats-dark .at4-follow-inner,.at-follow-open-control.ats-dark{background:#262b30;border-color:#000;color:#fff}.at4-follow.ats-dark .at-follow-close-control{background-color:#262b30}.at4-follow.ats-light .at4-follow-inner{background:#fff;border-color:#c5c5c5}.at4-follow.ats-gray .at4-follow-inner,.at-follow-open-control.ats-gray{background:#f2f2f2;border-color:#c5c5c5}.at4-follow.ats-light .at4-follow-close-control,.at-follow-open-control.ats-light{background:#e5e5e5}.at4-follow .at4-follow-inner .at4-follow-close-control{position:absolute;top:0;bottom:0;left:0;width:20px;cursor:pointer;display:none}.at4-follow .at4-follow-inner .at4-follow-close-control div{display:block;line-height:20px;text-indent:-9999em;margin-top:calc(50% + 1px);overflow:hidden}.at-follow-open-control div.at4-arrow.at-left{background-position:0 -2px}.at-follow-open-control{position:fixed;height:35px;top:0;right:0;padding-top:10px;z-index:10002}.at-follow-btn{margin:0 5px 5px 0;padding:0;outline-offset:-1px;display:inline-block;box-sizing:content-box;transition:all .2s ease-in-out}.at-follow-btn:focus,.at-follow-btn:hover{transform:translateY(-4px)}.at4-follow-24 .at-follow-btn{height:25px;line-height:0;width:25px}</style><style type="text/css">.at-follow-tbx-element .at300b,.at-follow-tbx-element .at300m{display:inline-block;width:auto;padding:0;margin:0 2px 5px;outline-offset:-1px;transition:all .2s ease-in-out}.at-follow-tbx-element .at300b:focus,.at-follow-tbx-element .at300b:hover,.at-follow-tbx-element .at300m:focus,.at-follow-tbx-element .at300m:hover{transform:translateY(-4px)}.at-follow-tbx-element .addthis_vertical_style .at300b,.at-follow-tbx-element .addthis_vertical_style .at300m{display:block}.at-follow-tbx-element .addthis_vertical_style .at300b .addthis_follow_label,.at-follow-tbx-element .addthis_vertical_style .at300b .at-icon-wrapper,.at-follow-tbx-element .addthis_vertical_style .at300m .addthis_follow_label,.at-follow-tbx-element .addthis_vertical_style .at300m .at-icon-wrapper{display:inline-block;vertical-align:middle;margin-right:5px}.at-follow-tbx-element .addthis_vertical_style .at300b:focus,.at-follow-tbx-element .addthis_vertical_style .at300b:hover,.at-follow-tbx-element .addthis_vertical_style .at300m:focus,.at-follow-tbx-element .addthis_vertical_style .at300m:hover{transform:none}</style><style type="text/css">.at4-jumboshare .at-share-btn{display:inline-block;margin-right:13px;margin-top:13px}.at4-jumboshare .at-share-btn .at-icon{float:left}.at4-jumboshare .at-share-btn .at300bs{display:inline-block;float:left;cursor:pointer}.at4-jumboshare .at4-mobile .at-share-btn .at-icon,.at4-jumboshare .at4-mobile .at-share-btn .at-icon-wrapper{margin:0;padding:0}.at4-jumboshare .at4-mobile .at-share-btn{padding:0}.at4-jumboshare .at4-mobile .at-share-btn .at-label{display:none}.at4-jumboshare .at4-count{font-size:60px;line-height:60px;font-family:Helvetica neue,arial;font-weight:700}.at4-jumboshare .at4-count-container{display:table-cell;text-align:center;min-width:200px;vertical-align:middle;border-right:1px solid #ccc;padding-right:20px}.at4-jumboshare .at4-share-container{display:table-cell;vertical-align:middle;padding-left:20px}.at4-jumboshare .at4-share-container.at-share-tbx-element{padding-top:0}.at4-jumboshare .at4-title{position:relative;font-size:18px;line-height:18px;bottom:2px}.at4-jumboshare .at4-spacer{height:1px;display:block;visibility:hidden;opacity:0}.at4-jumboshare .at-share-btn{display:inline-block;margin:0 2px;line-height:0;padding:0;overflow:hidden;text-decoration:none;text-transform:none;color:#fff;cursor:pointer;transition:all .2s ease-in-out;border:0;background-color:transparent}.at4-jumboshare .at-share-btn:focus,.at4-jumboshare .at-share-btn:hover{transform:translateY(-4px);color:#fff;text-decoration:none}.at4-jumboshare .at-label{font-family:helvetica neue,helvetica,arial,sans-serif;font-size:9pt;padding:0 15px 0 0;margin:0;height:2pc;line-height:2pc;background:none}.at4-jumboshare .at-share-btn:hover,.at4-jumboshare .at-share-btn:link{text-decoration:none}.at4-jumboshare .at-share-btn::-moz-focus-inner{border:0;padding:0}.at4-jumboshare.at-mobile .at-label{display:none}</style><style type="text/css">.at4-recommendedbox-outer-container{display:inline}.at4-recommended-outer{position:static}.at4-recommended{top:20%;margin:0;text-align:center;font-weight:400;font-size:13px;line-height:17px;color:#666}.at4-recommended.at-inline .at4-recommended-horizontal{text-align:left}.at4-recommended-recommendedbox{padding:0;z-index:inherit}.at4-recommended-recommended{padding:40px 0}.at4-recommended-horizontal{max-height:340px}.at4-recommended.at-medium .at4-recommended-horizontal{max-height:15pc}.at4-recommended.at4-minimal.at-medium .at4-recommended-horizontal{padding-top:10px;max-height:230px}.at4-recommended-text-only .at4-recommended-horizontal{max-height:130px}.at4-recommended-horizontal{padding-top:5px;overflow-y:hidden}.at4-minimal{background:none;color:#000;border:none!important;box-shadow:none!important}@media screen and (max-width:900px){.at4-recommended-horizontal .at4-recommended-item,.at4-recommended-horizontal .at4-recommended-item .at4-recommended-item-img{width:15pc}}.at4-recommended.at4-minimal .at4-recommended-horizontal .at4-recommended-item .at4-recommended-item-caption{padding:0 0 10px}.at4-recommended.at4-minimal .at4-recommended-horizontal .at4-recommended-item-caption{padding:20px 0 0!important}.addthis-smartlayers .at4-recommended .at-h3.at-recommended-label{margin:0;padding:0;font-weight:300;font-size:18px;line-height:24px;color:#464646;width:100%;display:inline-block;zoom:1}.addthis-smartlayers .at4-recommended.at-inline .at-h3.at-recommended-label{text-align:left}#at4-thankyou .addthis-smartlayers .at4-recommended.at-inline .at-h3.at-recommended-label{text-align:center}.at4-recommended .at4-recommended-item{display:inline-block;zoom:1;position:relative;background:#fff;border:1px solid #c5c5c5;width:200px;margin:10px}.addthis_recommended_horizontal .at4-recommended-item{border:none}.at4-recommended .at4-recommended-item .sponsored-label{color:#666;font-size:9px;position:absolute;top:-20px}.at4-recommended .at4-recommended-item-img .at-tli,.at4-recommended .at4-recommended-item-img a{position:absolute;left:0}.at4-recommended.at-inline .at4-recommended-horizontal .at4-recommended-item{margin:10px 20px 0 0}.at4-recommended.at-medium .at4-recommended-horizontal .at4-recommended-item{margin:10px 10px 0 0}.at4-recommended.at-medium .at4-recommended-item{width:140px;overflow:hidden}.at4-recommended .at4-recommended-item .at4-recommended-item-img{position:relative;text-align:center;width:100%;height:200px;line-height:0;overflow:hidden}.at4-recommended .at4-recommended-item .at4-recommended-item-img a{display:block;width:100%;height:200px}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-img,.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-img a{height:140px}.at4-recommended .at4-recommended-item .at4-recommended-item-img img{position:absolute;top:0;left:0;min-height:0;min-width:0;max-height:none;max-width:none;margin:0;padding:0}.at4-recommended .at4-recommended-item .at4-recommended-item-caption{height:74px;overflow:hidden;padding:20px;text-align:left;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption{height:50px;padding:15px}.at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4{height:54px;margin:0 0 5px;padding:0;overflow:hidden;word-wrap:break-word;font-size:14px;font-weight:400;line-height:18px;text-align:left}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption .at-h4{font-size:9pt;line-height:1pc;height:33px}.at4-recommended .at4-recommended-item:hover .at4-recommended-item-caption .at-h4{text-decoration:underline}.at4-recommended a:link,.at4-recommended a:visited{text-decoration:none;color:#464646}.at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4 a:hover{text-decoration:underline;color:#000}.at4-recommended .at4-recommended-item .at4-recommended-item-caption small{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:11px;color:#666}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption small{font-size:9px}.at4-recommended .at4-recommended-vertical{padding:15px 0 0}.at4-recommended .at4-recommended-vertical .at4-recommended-item{display:block;width:auto;max-width:100%;height:60px;border:none;margin:0 0 15px;box-shadow:none;background:none}.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img,.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img img{width:60px;height:60px;float:left}.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption{border-top:none;margin:0;height:60px;padding:3px 5px}.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4{height:38px;margin:0}.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption small{position:absolute;bottom:0}.at4-recommended .at-recommended-label.at-vertical{text-align:left}.at4-no-image-light-recommended,.at4-no-image-minimal-recommended{background-color:#f2f2f2!important}.at4-no-image-gray-recommended{background-color:#e6e6e5!important}.at4-no-image-dark-recommended{background-color:#4e555e!important}.at4-recommended .at4-recommended-item-placeholder-img{background-repeat:no-repeat!important;background-position:center!important;width:100%!important;height:100%!important}.at4-recommended-horizontal .at4-no-image-dark-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAfCAYAAACCox+xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlFNUUyQTg3MTI0RDExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlFNUUyQTg4MTI0RDExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OUU1RTJBODUxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OUU1RTJBODYxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6oCfPiAAABfUlEQVR42uyWTU/DMAyGm3bdBxp062hHe+PC//9HCIkDYpNAO7CPAuWN5Eohyhpno2GHWqq8pO78xHHsiLquH4L/l6cwuBAZaOPKs//YBFIJIR59UiAt7huYi90aE/UQakTDLaL26RUEAAJqiefm93T9Bpj1X4O0bY0OIUXCpYBJvYDAUWyAUCWliHGTcnpqRMaM72ImRAJVknYG+eb4YEDIBeU0zGnsBLK1ODogYSsLhDwIJeVVk18lzfNA4ERGZNXi59UCIQhiYDilpSm/jp4awLxDvWhlf4/nGe8+LLuSt+SZul28ggaHG6gNVhDR+IuRFzOoxGKWwG7vVFm5AAQxgcqYpzrjFjR9zwPH5LSuT7XlNr2MQm5LzqjLpncNNaM+s8M27Y60g3FwhoSMzrtUQllgLtRs5pZ2cB4IhbvQbGRZv1NsrhyS8+SI5Mo9RJWpjAI1xqKL+0iEP180vy214JbeR12AyOgsHI7e0NfFyKv0ID1ID+IqPwIMAOeljGQOryBmAAAAAElFTkSuQmCC)!important}.at4-recommended-vertical .at4-no-image-dark-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTM2MTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTM3MTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDNEQzI1MzQxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDNEQzI1MzUxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5GfbtkAAAAxklEQVR42qRSTQvCMAxduk53mEOHKFPP/v8/5cGTiIibivVFUomlG7gFHvloXpKmJefcPhkmNyvGEWj+IOZA6ckPImoxxVwOLvCvXUzkpayNCpRQK64IbOBnAYGAXMeMslNlU+CzrIEdCkxi5DPAoz6BE8ZuVNdKJuL8rS9sv62IXlCHyP0KqKUKZXK9uwkSLVArfwpVR3b225kXwovibcP+jC4jUtfWPZmfqJJnYlkAM128j1z0nHWKSUbIKDL/msHktwADAPptQo+vkZNLAAAAAElFTkSuQmCC)!important}.at4-recommended-horizontal .at4-no-image-gray-recommended .at4-recommended-item-placeholder-img,.at4-recommended-horizontal .at4-no-image-light-recommended .at4-recommended-item-placeholder-img,.at4-recommended-horizontal .at4-no-image-minimal-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAfCAYAAACCox+xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTMyMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTMzMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OUU1RTJBODkxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OUU1RTJBOEExMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6dfDQvAAABg0lEQVR42uyWS0vDQBDH82jaKNW0qUltbl68e/Di98eLBz+CCB5EBaWIpUat/4UJLMuame1j7SEDYbqbKfPLvHbDi8ur8+D/5T4K9kR6xrr27D+xgdS3N9d3PilQFmcNzN6mxkbdhxrQcoGofXkFAUAINcVzrG2vsP8KmJdtg7SlxoRQouBywOReQOAosUDoklPEpEU5XDciqeB/iRAig6pIO4P8CHysBBDqg0palrR2Alkwjj5RsDUDoRqhorpq6quifRkInKiIPLf4eWIgQoLoWbq0stXXn10DmDeoR2PsL/E84N0Hk5Wypc70dMkGGhzOoeb4gpjW34K6GEFljFkGu6XTZJUCEMQBVCHs6kI60MycB47FyUmo20oPvYJCzhVnvIsR3zg5ghoRTNpyHKTBBhIJTt6pFsoZ9iLDZswcB5uBULhnho0a66eazaFDca59Hym1e4guQ4rCO4Fu/T4Sw8Gk+c3MghN6H+8CRKVg4tB6fV8XI6/SgXQgHYir/AowAMU5TskhKVUNAAAAAElFTkSuQmCC)!important}.at4-recommended-vertical .at4-no-image-gray-recommended .at4-recommended-item-placeholder-img,.at4-recommended-vertical .at4-no-image-light-recommended .at4-recommended-item-placeholder-img,.at4-recommended-vertical .at4-no-image-minimal-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTNBMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTNCMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDNEQzI1MzgxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDNEQzI1MzkxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz65Fr9cAAAA0ElEQVR42qRRuQrCQBDd3SSaIgYNosSrtLew8f+xsfAnYmEVRMR4YHwjExjCbsBk4DHHzptjR2+2u7VqJ3efjTNQ/EEMgbgiv46H/QNTDPnhCv/mYiLPI21EIIaaUEVgBj+oETQQypgRtidsXfNJpsACBXo28gWgUd9AjrEL0TXhiSh/XhWudlZI/kCdLPtFUGMRCni9p6kl+kAq/D5UavmzX2fNd87obsCSfztnrOR0rjvTiRImkoyAQQNRyZ2jhjenGNVBOpF1WZatyV8BBgBJ+irgS/KHdAAAAABJRU5ErkJggg==)!important}#at-drawer.ats-dark,.at4-recommended.ats-dark .at4-recommended-horizontal .at4-recommended-item-caption,.at4-recommended.ats-dark .at4-recommended-vertical .at4-recommended-item-caption{background:#262b30}#at-drawer.ats-gray,.at4-recommended.ats-gray .at4-recommended-horizontal .at4-recommended-item-caption{background:#f2f2f2}#at-drawer.ats-light,.at4-recommended.ats-light .at4-recommended-horizontal .at4-recommended-item-caption{background:#fff}.at4-recommended.ats-dark .at4-recommended-vertical .at4-recommended-item{background:none}.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:hover,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:link,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:visited,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption small,.at4-recommended.ats-dark .at4-recommended-item-caption,.at4-recommended.ats-dark .at-logo a:hover,.at4-recommended.ats-dark .at-recommended-label.at-vertical{color:#fff}.at4-recommended-vertical-logo{padding-top:0;text-align:left}.at4-recommended-vertical-logo .at4-logo-container{line-height:10px}.at4-recommended-horizontal-logo{text-align:center}.at4-recommended.at-inline .at4-recommended-horizontal-logo{text-align:left}#at4-thankyou .at4-recommended.at-inline .at4-recommended-horizontal{text-align:center}.at4-recommended .at-logo{margin:10px 0 0;padding:0;height:25px;overflow:auto;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.at4-recommended.at-inline .at4-recommended-horizontal .at-logo{text-align:left}.at4-recommended .at4-logo-container a.at-sponsored-link{color:#666}.at4-recommended-class .at4-logo-container a:hover,.at4-recommendedbox-outer-container .at4-recommended-recommendedbox .at4-logo-container a:hover{color:#000}</style><style type="text/css">.at-recommendedjumbo-outer-container{margin:0;padding:0;border:0;background:none;color:#000}.at-recommendedjumbo-footer{position:relative;width:100%;height:510px;overflow:hidden;transition:all .3s ease-in-out}.at-mobile .at-recommendedjumbo-footer{height:250px}.at-recommendedjumbo-footer #bg-link:after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.75)}.at-recommendedjumbo-footer:hover #bg-link:after{background:rgba(0,0,0,.85)}.at-recommendedjumbo-footer *,.at-recommendedjumbo-footer :after,.at-recommendedjumbo-footer :before{box-sizing:border-box}.at-recommendedjumbo-footer:hover #at-recommendedjumbo-footer-bg{animation:atRecommendedJumboAnimatedBackground 1s ease-in-out 1;animation-fill-mode:forwards}.at-recommendedjumbo-footer #at-recommendedjumbo-top-holder{position:absolute;top:0;padding:0 40px;width:100%}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-top-holder{padding:0 20px}.at-recommendedjumbo-footer .at-recommendedjumbo-footer-inner{position:relative;text-align:center;font-family:helvetica,arial,sans-serif;z-index:2;width:100%}.at-recommendedjumbo-footer #at-recommendedjumbo-label-holder{margin:40px 0 0;max-height:30px}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-label-holder{margin:20px 0 0;max-height:20px}.at-recommendedjumbo-footer #at-recommendedjumbo-label{font-weight:300;font-size:24px;line-height:24px;color:#fff;margin:0}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-label{font-weight:150;font-size:14px;line-height:14px}.at-recommendedjumbo-footer #at-recommendedjumbo-title-holder{margin:20px 0 0;min-height:3pc;max-height:78pt}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-title-holder{margin:10px 0 0;min-height:24px;max-height:54px}.at-recommendedjumbo-footer #at-recommendedjumbo-content-title{font-size:3pc;line-height:52px;font-weight:700;margin:0}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-content-title{font-size:24px;line-height:27px}.at-recommendedjumbo-footer a{text-decoration:none;color:#fff}.at-recommendedjumbo-footer a:visited{color:#fff}.at-recommendedjumbo-footer small{margin:20px 0 0;display:inline-block;height:2pc;line-height:2pc;font-size:14px;color:#ccc;cursor:default}.at-mobile .at-recommendedjumbo-footer small{margin:10px 0 0;height:14px;line-height:14px;font-size:9pt}.at-recommendedjumbo-footer .at-logo-container{position:absolute;bottom:20px;margin:auto;left:0;right:0}.at-mobile .at-recommendedjumbo-footer .at-logo-container{bottom:10px}.at-recommendedjumbo-footer a.at-sponsored-link{color:#ccc}.at-recommendedjumbo-footer div #at-recommendedjumbo-logo-link{padding:2px 0 0 11px;text-decoration:none;line-height:20px;font-family:helvetica,arial,sans-serif;font-size:9px;color:#ccc}@keyframes atRecommendedJumboAnimatedBackground{0%{transform:scale(1,1)}to{transform:scale(1.1,1.1)}}</style><style type="text/css">.at-resp-share-element{position:relative;padding:0;margin:0;font-size:0;line-height:0}.at-resp-share-element:after,.at-resp-share-element:before{content:" ";display:table}.at-resp-share-element.at-mobile .at4-share-count-container,.at-resp-share-element.at-mobile .at-label{display:none}.at-resp-share-element .at-share-btn{display:inline-block;*display:inline;*zoom:1;margin:0 2px 5px;padding:0;overflow:hidden;line-height:0;text-decoration:none;text-transform:none;color:#fff;cursor:pointer;transition:all .2s ease-in-out;border:0;font-family:helvetica neue,helvetica,arial,sans-serif;background-color:transparent}.at-resp-share-element .at-share-btn::-moz-focus-inner{border:0;padding:0}.at-resp-share-element .at-share-btn:focus,.at-resp-share-element .at-share-btn:hover{transform:translateY(-4px);color:#fff;text-decoration:none}.at-resp-share-element .at-share-btn .at-icon-wrapper{float:left}.at-resp-share-element .at-share-btn.at-share-btn.at-svc-compact:hover{transform:none}.at-resp-share-element .at-share-btn .at-label{font-family:helvetica neue,helvetica,arial,sans-serif;font-size:9pt;padding:0 15px 0 0;margin:0 0 0 5px;height:2pc;line-height:2pc;background:none}.at-resp-share-element .at-icon,.at-resp-share-element .at-label{cursor:pointer}.at-resp-share-element .at4-share-count-container{text-decoration:none;float:right;padding-right:15px;font-size:9pt}.at-mobile .at-resp-share-element .at-label{display:none}.at-resp-share-element.at-mobile .at-share-btn{margin-right:5px}.at-mobile .at-resp-share-element .at-share-btn{padding:5px;margin-right:5px}</style><style type="text/css">.at-share-tbx-element{position:relative;margin:0;color:#fff;font-size:0}.at-share-tbx-element,.at-share-tbx-element .at-share-btn{font-family:helvetica neue,helvetica,arial,sans-serif;padding:0;line-height:0}.at-share-tbx-element .at-share-btn{cursor:pointer;margin:0 5px 5px 0;display:inline-block;overflow:hidden;border:0;text-decoration:none;text-transform:none;background-color:transparent;color:inherit;transition:all .2s ease-in-out}.at-share-tbx-element .at-share-btn:focus,.at-share-tbx-element .at-share-btn:hover{transform:translateY(-4px);outline-offset:-1px;color:inherit}.at-share-tbx-element .at-share-btn::-moz-focus-inner{border:0;padding:0}.at-share-tbx-element .at-share-btn.at-share-btn.at-svc-compact:hover{transform:none}.at-share-tbx-element .at-icon-wrapper{vertical-align:middle}.at-share-tbx-element .at4-share-count,.at-share-tbx-element .at-label{margin:0 7.5px 0 2.5px;text-decoration:none;vertical-align:middle;display:inline-block;background:none;height:0;font-size:inherit;line-height:inherit;color:inherit}.at-share-tbx-element.at-mobile .at4-share-count,.at-share-tbx-element.at-mobile .at-label{display:none}.at-share-tbx-element .at_native_button{vertical-align:middle}.at-share-tbx-element .addthis_counter.addthis_bubble_style{margin:0 2px;vertical-align:middle;display:inline-block}.at-share-tbx-element .fb_iframe_widget{display:block}.at-share-tbx-element.at-share-tbx-native .at300b{vertical-align:middle}.at-style-responsive .at-share-btn{padding:5px}.at-style-jumbo{display:table}.at-style-jumbo .at4-spacer{height:1px;display:block;visibility:hidden;opacity:0}.at-style-jumbo .at4-count-container{display:table-cell;text-align:center;min-width:200px;vertical-align:middle;border-right:1px solid #ccc;padding-right:20px}.at-style-jumbo .at4-count{font-size:60px;line-height:60px;font-weight:700}.at-style-jumbo .at4-count-title{position:relative;font-size:18px;line-height:18px;bottom:2px}.at-style-jumbo .at-share-btn-elements{display:table-cell;vertical-align:middle;padding-left:20px}.at_flat_counter{cursor:pointer;font-family:helvetica,arial,sans-serif;font-weight:700;text-transform:uppercase;display:inline-block;position:relative;vertical-align:top;height:auto;margin:0 5px;padding:0 6px;left:-1px;background:#ebebeb;color:#32363b;transition:all .2s ease}.at_flat_counter:after{top:30%;left:-4px;content:"";position:absolute;border-width:5px 8px 5px 0;border-style:solid;border-color:transparent #ebebeb transparent transparent;display:block;width:0;height:0;transform:translateY(360deg)}.at_flat_counter:hover{background:#e1e2e2}</style><style type="text/css">.at4-thankyou-background{top:0;right:0;left:0;bottom:0;-webkit-overflow-scrolling:touch;z-index:9999999;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpizCuu/sRABGBiIBKMKqSOQoAAAwC8KgJipENhxwAAAABJRU5ErkJggg==);background:hsla(217,6%,46%,.95)}.at4-thankyou-background.at-thankyou-shown{position:fixed}.at4-thankyou-inner{position:absolute;width:100%;top:10%;left:50%;margin-left:-50%;text-align:center}.at4-thankyou-mobile .at4-thankyou-inner{top:5%}.thankyou-description{font-weight:400}.at4-thankyou-background .at4lb-inner{position:relative;width:100%;height:100%}.at4-thankyou-background .at4lb-inner .at4x{position:absolute;top:15px;right:15px;display:block;width:20px;height:20px;padding:20px;margin:0;cursor:pointer;transition:opacity .25s ease-in;opacity:.4;background:url("data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMTMvMTKswDp5AAAAd0lEQVQ4jb2VQRLAIAgDE///Z3qqY1FAhalHMCsCIkVEAIAkkVgvp2lDBgYAnAyHkWotLccNrEd4A7X2TqIdqLfnWBAdaF5rJdyJfjtPH5GT37CaGhoVq3nOm/XflUuLUto2pY1d+vRKh0Pp+MrAVtDe2JkvYNQ+jVSEEFmOkggAAAAASUVORK5CYII=") no-repeat center center;overflow:hidden;text-indent:-99999em;border:1px solid transparent}.at4-thankyou-background .at4lb-inner .at4x:focus,.at4-thankyou-background .at4lb-inner .at4x:hover{border:1px solid #fff;border-radius:50%;outline:0}.at4-thankyou-background .at4lb-inner #at4-palogo{position:absolute;bottom:10px;display:inline-block;text-decoration:none;font-family:helvetica,arial,sans-serif;font-size:11px;cursor:pointer;-webkit-transition:opacity .25s ease-in;moz-transition:opacity .25s ease-in;transition:opacity .25s ease-in;opacity:.5;z-index:100020;color:#fff;padding:2px 0 0 13px}.at4-thankyou-background .at4lb-inner #at4-palogo .at-branding-addthis,.at4-thankyou-background .at4lb-inner #at4-palogo .at-branding-info{color:#fff}.at4-thankyou-background .at4lb-inner #at4-palogo:hover,.at4-thankyou-background.ats-dark .at4lb-inner a#at4-palogo:hover{text-decoration:none;color:#fff;opacity:1}.at4-thankyou-background.ats-dark{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgeMZABGBiIBKMKqSOQoAAAwB+cQD6hqlbCwAAAABJRU5ErkJggg==");background:rgba(0,0,0,.85)}.at4-thankyou-background .thankyou-title{color:#fff;font-size:38.5px;margin:10px 20px;line-height:38.5px;font-family:helvetica neue,helvetica,arial,sans-serif;font-weight:300}.at4-thankyou-background.ats-dark .thankyou-description,.at4-thankyou-background.ats-dark .thankyou-title{color:#fff}.at4-thankyou-background .thankyou-description{color:#fff;font-size:18px;margin:10px 0;line-height:24px;padding:0;font-family:helvetica neue,helvetica,arial,sans-serif;font-weight:300}.at4-thankyou-background .at4-thanks-icons{padding-top:10px}.at4-thankyou-mobile *{-webkit-overflow-scrolling:touch}#at4-thankyou .at4-recommended-recommendedbox .at-logo{display:none}.at4-thankyou .at-h3{height:49px;line-height:49px;margin:0 50px 0 20px;padding:1px 0 0;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:1pc;font-weight:700;color:#fff;text-shadow:0 1px #000}.at4-thanks{padding-top:50px;text-align:center}.at4-thanks label{display:block;margin:0 0 15px;font-size:1pc;line-height:1pc}.at4-thanks .at4-h2{background:none;border:none;margin:0 0 10px;padding:0;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:28px;font-weight:300;color:#000}.at4-thanks .at4-thanks-icons{position:relative;height:2pc}.at4-thanks .at4-thanks-icons .at-thankyou-label{display:block;padding-bottom:10px;font-size:14px;color:#666}.at4-thankyou-layer .at-follow .at-icon-wrapper{width:2pc;height:2pc}</style><style type="text/css">.at4-recommended-toaster{position:fixed;top:auto;bottom:0;right:0;z-index:100021}.at4-recommended-toaster.ats-light{border:1px solid #c5c5c5;background:#fff}.at4-recommended-toaster.ats-gray{border:1px solid #c5c5c5;background:#f2f2f2}.at4-recommended-toaster.ats-dark{background:#262b30;color:#fff}.at4-recommended-toaster .at4-recommended-container{padding-top:0;margin:0}.at4-recommended.at4-recommended-toaster div.at-recommended-label{line-height:1pc;font-size:1pc;text-align:left;padding:20px 0 0 20px}.at4-toaster-outer .at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4{font-size:11px;line-height:11px;margin:10px 0 6px;height:30px}.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-gray,.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-light{color:#464646}.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-dark{color:#fff}.at4-toaster-close-control{position:absolute;top:0;right:0;display:block;width:20px;height:20px;line-height:20px;margin:5px 5px 0 0;padding:0;text-indent:-9999em}.at4-toaster-open-control{position:fixed;right:0;bottom:0;z-index:100020}.at4-toaster-outer .at4-recommended-item{width:90pt;border:0;margin:9px 10px 0}.at4-toaster-outer .at4-recommended-item:first-child{margin-left:20px}.at4-toaster-outer .at4-recommended-item:last-child{margin-right:20px}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-img{max-height:90pt;max-width:90pt}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-img img{height:90pt;width:90pt}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-caption{height:30px;padding:0;margin:0;height:initial}.at4-toaster-outer .ats-dark .at4-recommended-item .at4-recommended-item-caption{background:#262b30}.at4-toaster-outer .at4-recommended .at4-recommended-item .at4-recommended-item-caption small{width:auto;line-height:14px;margin:0}.at4-toaster-outer .at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption small{color:#fff}.at4-recommended-toaster .at-logo{margin:0 0 3px 20px;text-align:left}.at4-recommended-toaster .at-logo .at4-logo-container.at-sponsored-logo{position:relative}.at4-toaster-outer .at4-recommended-item .sponsored-label{text-align:right;font-size:10px;color:#666;float:right;position:fixed;bottom:6px;right:20px;top:initial;z-index:99999}</style><style type="text/css">.at4-whatsnext{position:fixed;bottom:0!important;right:0;background:#fff;border:1px solid #c5c5c5;margin:-1px;width:390px;height:90pt;overflow:hidden;font-size:9pt;font-weight:400;color:#000;z-index:1800000000}.at4-whatsnext a{color:#666}.at4-whatsnext .at-whatsnext-content{height:90pt;position:relative}.at4-whatsnext .at-whatsnext-content .at-branding{position:absolute;bottom:15px;right:10px;padding-left:9px;text-decoration:none;line-height:10px;font-family:helvetica,arial,sans-serif;font-size:10px;color:#666}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-inner{position:absolute;top:15px;right:20px;bottom:15px;left:140px;text-align:left;height:105px}.at4-whatsnext .at-whatsnext-content-inner a{display:inline-block}.at4-whatsnext .at-whatsnext-content-inner div.at-h6{text-align:left;margin:0;padding:0 0 3px;font-size:11px;color:#666;cursor:default}.at4-whatsnext .at-whatsnext-content .at-h3{text-align:left;margin:5px 0;padding:0;line-height:1.2em;font-weight:400;font-size:14px;height:3pc}.at4-whatsnext .at-whatsnext-content-inner a:link,.at4-whatsnext .at-whatsnext-content-inner a:visited{text-decoration:none;font-weight:400;color:#464646}.at4-whatsnext .at-whatsnext-content-inner a:hover{color:#000}.at4-whatsnext .at-whatsnext-content-inner small{position:absolute;bottom:15px;line-height:10px;font-size:11px;color:#666;cursor:default;text-align:left}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-img{position:absolute;top:0;left:0;width:90pt;height:90pt;overflow:hidden}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-img img{position:absolute;top:0;left:0;max-height:none;max-width:none}.at4-whatsnext .at-whatsnext-close-control{position:absolute;top:0;right:0;display:block;width:20px;height:20px;line-height:20px;margin:0 5px 0 0;padding:0;text-indent:-9999em}.at-whatsnext-open-control{position:fixed;right:0;bottom:0;z-index:100020}.at4-whatsnext.ats-dark{background:#262b30}.at4-whatsnext.ats-dark .at-whatsnext-content .at-h3,.at4-whatsnext.ats-dark .at-whatsnext-content a.at4-logo:hover,.at4-whatsnext.ats-dark .at-whatsnext-content-inner a:link,.at4-whatsnext.ats-dark .at-whatsnext-content-inner a:visited{color:#fff}.at4-whatsnext.ats-light{background:#fff}.at4-whatsnext.ats-gray{background:#f2f2f2}.at4-whatsnext.at-whatsnext-nophoto{width:270px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content-img{display:none}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner{top:15px;right:0;left:20px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner.addthis_32x32_style{top:0;right:0;left:0;padding:45px 20px 0;font-size:20px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .at4-icon,.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .at4-icon-fw,.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .whatsnext-msg{vertical-align:middle}.at-whatsnext-img,.at-whatsnext-img-lnk{position:absolute;left:0}</style><style type="text/css">.at4-whatsnextmobile{position:fixed;bottom:0;right:0;left:0;background:#fff;z-index:9999998;height:170px;font-size:28px}.at4-whatsnextmobile .col-2{height:100%;font-size:1em}.at4-whatsnextmobile .col-2:first-child{max-width:200px;display:inline-block;float:left}.at4-whatsnextmobile .col-2:last-child{position:absolute;left:200px;right:50px;top:0;bottom:0;display:inline-block}.at4-whatsnextmobile .at-whatsnext-content-inner{font-size:1em}.at4-whatsnextmobile .at-whatsnext-content-img img{height:100%;width:100%}.at4-whatsnextmobile .at-close-control{font-size:1em;position:absolute;top:0;right:0;width:50px;height:50px}.at4-whatsnextmobile .at-close-control button{width:100%;height:100%;font-size:1em;font-weight:400;text-decoration:none;opacity:.5;padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.at4-whatsnextmobile .at-h3,.at4-whatsnextmobile .at-h6{font-size:1em;margin:0;color:#a1a1a1;margin-left:2.5%;margin-top:25px}.at4-whatsnextmobile .at-h3{font-size:1em;line-height:1em;font-weight:500;height:50%}.at4-whatsnextmobile .at-h3 a{font-size:1em;text-decoration:none}.at4-whatsnextmobile .at-h6{font-size:.8em;line-height:.8em;font-weight:500}.at4-whatsnextmobile .footer{position:absolute;bottom:2px;left:200px;right:0;padding-left:2.5%;font-size:1em;line-height:.6em}.at4-whatsnextmobile .footer small{font-size:.6em;color:#a1a1a1}.at4-whatsnextmobile .footer small:first-child{margin-right:5%;float:left}.at4-whatsnextmobile .footer small:last-child{margin-right:2.5%;float:right}.at4-whatsnextmobile .at-whatsnext-content{height:100%}.at4-whatsnextmobile.ats-dark{background:#262b30;color:#fff}.at4-whatsnextmobile .at-close-control button{color:#bfbfbf}.at4-whatsnextmobile.ats-dark a:link,.at4-whatsnextmobile.ats-dark a:visited{color:#fff}.at4-whatsnextmobile.ats-gray{background:#f2f2f2;color:#262b30}.at4-whatsnextmobile.ats-light{background:#fff;color:#262b30}.at4-whatsnextmobile.ats-dark .footer a:link,.at4-whatsnextmobile.ats-dark .footer a:visited,.at4-whatsnextmobile.ats-gray .footer a:link,.at4-whatsnextmobile.ats-gray .footer a:visited,.at4-whatsnextmobile.ats-light .footer a:link,.at4-whatsnextmobile.ats-light .footer a:visited{color:#a1a1a1}.at4-whatsnextmobile.ats-gray a:link,.at4-whatsnextmobile.ats-gray a:visited,.at4-whatsnextmobile.ats-light a:link,.at4-whatsnextmobile.ats-light a:visited{color:#262b30}@media only screen and (min-device-width:320px) and (max-device-width:480px){.at4-whatsnextmobile{height:85px;font-size:14px}.at4-whatsnextmobile .col-2:first-child{width:75pt}.at4-whatsnextmobile .col-2:last-child{right:25px;left:75pt}.at4-whatsnextmobile .footer{left:75pt}.at4-whatsnextmobile .at-close-control{width:25px;height:25px}.at4-whatsnextmobile .at-h3,.at4-whatsnextmobile .at-h6{margin-top:12.5px}}</style><style type="text/css">.at-custom-mobile-bar{left:0;right:0;width:100%;height:56px;position:fixed;text-align:center;z-index:100020;background:#fff;overflow:hidden;box-shadow:0 0 10px 0 rgba(0,0,0,.2);font:initial;line-height:normal;top:auto;bottom:0}.at-custom-mobile-bar.at-custom-mobile-bar-zindex-hide{z-index:-1!important}.at-custom-mobile-bar.atss-top{top:0;bottom:auto}.at-custom-mobile-bar.atss-bottom{top:auto;bottom:0}.at-custom-mobile-bar .at-custom-mobile-bar-btns{display:inline-block;text-align:center}.at-custom-mobile-bar .at-custom-mobile-bar-counter,.at-custom-mobile-bar .at-share-btn{margin-top:4px}.at-custom-mobile-bar .at-share-btn{display:inline-block;text-decoration:none;transition:none;box-sizing:content-box}.at-custom-mobile-bar .at-custom-mobile-bar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-left:4px;margin-right:4px;display:inline-block}.at-custom-mobile-bar .at-custom-mobile-bar-count{font-size:26px;line-height:1.25em;color:#222}.at-custom-mobile-bar .at-custom-mobile-bar-text{font-size:9pt;line-height:1.25em;color:#888;letter-spacing:1px}.at-custom-mobile-bar .at-icon-wrapper{text-align:center;height:3pc;width:3pc;margin:0 4px}.at-custom-mobile-bar .at-icon{vertical-align:top;margin:8px;width:2pc;height:2pc}.at-custom-mobile-bar.at-shfs-medium{height:3pc}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-counter{margin-top:6px}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-count{font-size:18px}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-text{font-size:10px}.at-custom-mobile-bar.at-shfs-medium .at-icon-wrapper{height:40px;width:40px}.at-custom-mobile-bar.at-shfs-medium .at-icon{margin:6px;width:28px;height:28px}.at-custom-mobile-bar.at-shfs-small{height:40px}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-counter{margin-top:3px}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-count{font-size:1pc}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-text{font-size:10px}.at-custom-mobile-bar.at-shfs-small .at-icon-wrapper{height:2pc;width:2pc}.at-custom-mobile-bar.at-shfs-small .at-icon{margin:4px;width:24px;height:24px}</style><style type="text/css">.at-custom-sidebar{top:20%;width:58px;position:fixed;text-align:center;z-index:100020;background:#fff;overflow:hidden;box-shadow:0 0 10px 0 rgba(0,0,0,.2);font:initial;line-height:normal;top:auto;bottom:0}.at-custom-sidebar.at-custom-sidebar-zindex-hide{z-index:-1!important}.at-custom-sidebar.atss-left{left:0;right:auto;float:left;border-radius:0 4px 4px 0}.at-custom-sidebar.atss-right{left:auto;right:0;float:right;border-radius:4px 0 0 4px}.at-custom-sidebar .at-custom-sidebar-btns{display:inline-block;text-align:center;padding-top:4px}.at-custom-sidebar .at-custom-sidebar-counter{margin-bottom:8px}.at-custom-sidebar .at-share-btn{display:inline-block;text-decoration:none;transition:none;box-sizing:content-box}.at-custom-sidebar .at-custom-sidebar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-left:4px;margin-right:4px;display:inline-block}.at-custom-sidebar .at-custom-sidebar-count{font-size:21px;line-height:1.25em;color:#222}.at-custom-sidebar .at-custom-sidebar-text{font-size:10px;line-height:1.25em;color:#888;letter-spacing:1px}.at-custom-sidebar .at-icon-wrapper{text-align:center;margin:0 4px}.at-custom-sidebar .at-icon{vertical-align:top;margin:9px;width:2pc;height:2pc}.at-custom-sidebar .at-icon-wrapper{position:relative}.at-custom-sidebar .at4-share-count,.at-custom-sidebar .at4-share-count-container{line-height:1pc;font-size:10px}.at-custom-sidebar .at4-share-count{text-indent:0;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-weight:200;width:100%;height:1pc}.at-custom-sidebar .at4-share-count-anchor .at-icon{margin-top:3px}.at-custom-sidebar .at4-share-count-container{position:absolute;left:0;right:auto;top:auto;bottom:0;width:100%;color:#fff;background:inherit}</style><style type="text/css">.at-image-sharing-mobile-icon{position:absolute;background:#000 url(//s7.addthis.com/static/44a36d35bafef33aa9455b7d3039a771.png) no-repeat top center;background-color:rgba(0,0,0,.9);background-image:url(//s7.addthis.com/static/10db525181ee0bbe1a515001be1c7818.svg),none;border-radius:3px;width:50px;height:40px;top:-9999px;left:-9999px}.at-image-sharing-tool{display:block;position:absolute;text-align:center;z-index:9001;background:none;overflow:hidden;top:-9999px;left:-9999px;font:initial;line-height:0}.at-image-sharing-tool.addthis-animated{animation-duration:.15s}.at-image-sharing-tool.at-orientation-vertical .at-share-btn{display:block}.at-image-sharing-tool.at-orientation-horizontal .at-share-btn{display:inline-block}.at-image-sharing-tool.at-image-sharing-tool-size-big .at-icon{width:43px;height:43px}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-share-btn{margin:0!important}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-icon-wrapper{height:60px;width:100%;border-radius:0!important}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-icon{max-width:100%;height:54px!important;width:54px!important}.at-image-sharing-tool .at-custom-shape.at-image-sharing-tool-btns{margin-right:8px;margin-bottom:8px}.at-image-sharing-tool .at-custom-shape .at-share-btn{margin-top:8px;margin-left:8px}.at-image-sharing-tool .at-share-btn{line-height:0;text-decoration:none;transition:none;box-sizing:content-box}.at-image-sharing-tool .at-icon-wrapper{text-align:center;height:100%;width:100%}.at-image-sharing-tool .at-icon{vertical-align:top;width:2pc;height:2pc;margin:3px}</style><style type="text/css">.at-expanding-share-button{box-sizing:border-box;position:fixed;z-index:9999}.at-expanding-share-button[data-position=bottom-right]{bottom:10px;right:10px}.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-bg,.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-btn[data-name]:after,.at-expanding-share-button[data-position=bottom-right] .at-icon-wrapper,.at-expanding-share-button[data-position=bottom-right] [data-name]:after{float:right}.at-expanding-share-button[data-position=bottom-right] [data-name]:after{margin-right:10px}.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-btn[data-name]:after{margin-right:5px}.at-expanding-share-button[data-position=bottom-right] .at-icon-wrapper{margin-right:-3px}.at-expanding-share-button[data-position=bottom-left]{bottom:10px;left:10px}.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-bg,.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-btn[data-name]:after,.at-expanding-share-button[data-position=bottom-left] .at-icon-wrapper,.at-expanding-share-button[data-position=bottom-left] [data-name]:after{float:left}.at-expanding-share-button[data-position=bottom-left] [data-name]:after{margin-left:10px}.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-btn[data-name]:after{margin-left:5px}.at-expanding-share-button *,.at-expanding-share-button :after,.at-expanding-share-button :before{box-sizing:border-box}.at-expanding-share-button .at-expanding-share-button-services-list{display:none;list-style:none;margin:0 5px;overflow:visible;padding:0}.at-expanding-share-button .at-expanding-share-button-services-list>li{display:block;height:45px;position:relative;overflow:visible}.at-expanding-share-button .at-expanding-share-button-toggle-btn,.at-expanding-share-button .at-share-btn{transition:.1s;text-decoration:none}.at-expanding-share-button .at-share-btn{display:block;height:40px;padding:0 3px 0 0}.at-expanding-share-button .at-expanding-share-button-toggle-btn{position:relative;overflow:auto}.at-expanding-share-button .at-expanding-share-button-toggle-btn.at-expanding-share-button-hidden[data-name]:after{display:none}.at-expanding-share-button .at-expanding-share-button-toggle-bg{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);border-radius:50%;position:relative}.at-expanding-share-button .at-expanding-share-button-toggle-bg>span{background-image:url("data:image/svg+xml,%3Csvg%20width%3D%2232px%22%20height%3D%2232px%22%20viewBox%3D%220%200%2032%2032%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ctitle%3Eshare%3C%2Ftitle%3E%3Cg%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23FFFFFF%22%3E%3Cpath%20d%3D%22M26%2C13.4285714%20C26%2C13.6220248%2025.9293162%2C13.7894338%2025.7879464%2C13.9308036%20L20.0736607%2C19.6450893%20C19.932291%2C19.786459%2019.7648819%2C19.8571429%2019.5714286%2C19.8571429%20C19.3779752%2C19.8571429%2019.2105662%2C19.786459%2019.0691964%2C19.6450893%20C18.9278267%2C19.5037195%2018.8571429%2C19.3363105%2018.8571429%2C19.1428571%20L18.8571429%2C16.2857143%20L16.3571429%2C16.2857143%20C15.6279725%2C16.2857143%2014.9750773%2C16.3080355%2014.3984375%2C16.3526786%20C13.8217977%2C16.3973217%2013.2488868%2C16.477306%2012.6796875%2C16.5926339%20C12.1104882%2C16.7079619%2011.6157015%2C16.8660704%2011.1953125%2C17.0669643%20C10.7749235%2C17.2678581%2010.3824423%2C17.5264121%2010.0178571%2C17.8426339%20C9.65327199%2C18.1588557%209.35565592%2C18.534596%209.125%2C18.9698661%20C8.89434408%2C19.4051361%208.71391434%2C19.9203839%208.58370536%2C20.515625%20C8.45349637%2C21.1108661%208.38839286%2C21.7842224%208.38839286%2C22.5357143%20C8.38839286%2C22.9449425%208.40699386%2C23.4025272%208.44419643%2C23.9084821%20C8.44419643%2C23.9531252%208.45349693%2C24.0405499%208.47209821%2C24.1707589%20C8.4906995%2C24.3009679%208.5%2C24.3995532%208.5%2C24.4665179%20C8.5%2C24.5781256%208.46837829%2C24.6711306%208.40513393%2C24.7455357%20C8.34188956%2C24.8199408%208.25446484%2C24.8571429%208.14285714%2C24.8571429%20C8.02380893%2C24.8571429%207.9196433%2C24.7938994%207.83035714%2C24.6674107%20C7.77827355%2C24.6004461%207.72991094%2C24.5186017%207.68526786%2C24.421875%20C7.64062478%2C24.3251483%207.59040206%2C24.2135423%207.53459821%2C24.0870536%20C7.47879436%2C23.9605648%207.43973225%2C23.87128%207.41741071%2C23.8191964%20C6.47246551%2C21.6986501%206%2C20.0208395%206%2C18.7857143%20C6%2C17.3050521%206.19717065%2C16.0662252%206.59151786%2C15.0691964%20C7.79688103%2C12.0706695%2011.0520568%2C10.5714286%2016.3571429%2C10.5714286%20L18.8571429%2C10.5714286%20L18.8571429%2C7.71428571%20C18.8571429%2C7.52083237%2018.9278267%2C7.35342333%2019.0691964%2C7.21205357%20C19.2105662%2C7.07068382%2019.3779752%2C7%2019.5714286%2C7%20C19.7648819%2C7%2019.932291%2C7.07068382%2020.0736607%2C7.21205357%20L25.7879464%2C12.9263393%20C25.9293162%2C13.067709%2026%2C13.2351181%2026%2C13.4285714%20L26%2C13.4285714%20Z%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");background-position:center center;background-repeat:no-repeat;transition:transform .4s ease;border-radius:50%;display:block}.at-expanding-share-button .at-icon-wrapper{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);border-radius:50%;display:inline-block;height:40px;line-height:40px;text-align:center;width:40px}.at-expanding-share-button .at-icon{display:inline-block;height:34px;margin:3px 0;vertical-align:top;width:34px}.at-expanding-share-button [data-name]:after{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);transform:translate(0, -50%);transition:.4s;background-color:#fff;border-radius:3px;color:#666;content:attr(data-name);font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:9pt;line-height:9pt;font-weight:500;opacity:0;padding:3px 5px;position:relative;top:20px;white-space:nowrap}.at-expanding-share-button.at-expanding-share-button-show-icons .at-expanding-share-button-services-list{display:block}.at-expanding-share-button.at-expanding-share-button-animate-in .at-expanding-share-button-toggle-bg>span{transform:rotate(270deg);background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewBox%3D%220%200%2032%2032%22%3E%3Cg%3E%3Cpath%20d%3D%22M18%2014V8h-4v6H8v4h6v6h4v-6h6v-4h-6z%22%20fill-rule%3D%22evenodd%22%20fill%3D%22white%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fsvg%3E");background-position:center center;background-repeat:no-repeat}.at-expanding-share-button.at-expanding-share-button-animate-in [data-name]:after{opacity:1}.at-expanding-share-button.at-hide-label [data-name]:after{display:none}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle{height:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-icon-wrapper:hover{box-shadow:0 2px 5px 0 rgba(0,0,0,.5)}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg{height:50px;line-height:50px;width:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg>span{height:50px;width:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg:after{box-shadow:0 2px 5px 0 rgba(0,0,0,.2);transition:opacity .2s ease;border-radius:50%;content:'';height:100%;opacity:0;position:absolute;top:0;left:0;width:100%}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg:hover:after{opacity:1}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-btn[data-name]:after{top:25px}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-services-list{margin:0}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-btn,.at-expanding-share-button.at-expanding-share-button-mobile .at-share-btn{outline:0}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle{height:40px;-webkit-tap-highlight-color:transparent}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-bg,.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-bg span{height:40px;line-height:40px;width:40px}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-click-flash{transform:scale(0);transition:transform ease,opacity ease-in;background-color:hsla(0,0%,100%,.3);border-radius:50%;height:40px;opacity:1;position:absolute;width:40px;z-index:10000}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-click-flash.at-expanding-share-button-click-flash-animate{transform:scale(1);opacity:0}.at-expanding-share-button.at-expanding-share-button-mobile+.at-expanding-share-button-mobile-overlay{transition:opacity ease;bottom:0;background-color:hsla(0,0%,87%,.7);display:block;height:auto;left:0;opacity:0;position:fixed;right:0;top:0;width:auto;z-index:9998}.at-expanding-share-button.at-expanding-share-button-mobile+.at-expanding-share-button-mobile-overlay.at-expanding-share-button-hidden{height:0;width:0;z-index:-10000}.at-expanding-share-button.at-expanding-share-button-mobile.at-expanding-share-button-animate-in+.at-expanding-share-button-mobile-overlay{transition:opacity ease;opacity:1}</style><style type="text/css">.at-tjin-element .at300b,.at-tjin-element .at300m{display:inline-block;width:auto;padding:0;margin:0 2px 5px;outline-offset:-1px;transition:all .2s ease-in-out}.at-tjin-element .at300b:focus,.at-tjin-element .at300b:hover,.at-tjin-element .at300m:focus,.at-tjin-element .at300m:hover{transform:translateY(-4px)}.at-tjin-element .addthis_tjin_label{display:none}.at-tjin-element .addthis_vertical_style .at300b,.at-tjin-element .addthis_vertical_style .at300m{display:block}.at-tjin-element .addthis_vertical_style .at300b .addthis_tjin_label,.at-tjin-element .addthis_vertical_style .at300b .at-icon-wrapper,.at-tjin-element .addthis_vertical_style .at300m .addthis_tjin_label,.at-tjin-element .addthis_vertical_style .at300m .at-icon-wrapper{display:inline-block;vertical-align:middle;margin-right:5px}.at-tjin-element .addthis_vertical_style .at300b:focus,.at-tjin-element .addthis_vertical_style .at300b:hover,.at-tjin-element .addthis_vertical_style .at300m:focus,.at-tjin-element .addthis_vertical_style .at300m:hover{transform:none}.at-tjin-element .at-tjin-btn{margin:0 5px 5px 0;padding:0;outline-offset:-1px;display:inline-block;box-sizing:content-box;transition:all .2s ease-in-out}.at-tjin-element .at-tjin-btn:focus,.at-tjin-element .at-tjin-btn:hover{transform:translateY(-4px)}.at-tjin-element .at-tjin-title{margin:0 0 15px}</style><style type="text/css">#addthissmartlayerscssready{color:#bada55!important}.addthis-smartlayers,div#at4-follow,div#at4-share,div#at4-thankyou,div#at4-whatsnext{padding:0;margin:0}#at4-follow-label,#at4-share-label,#at4-whatsnext-label,.at4-recommended-label.hidden{padding:0;border:none;background:none;position:absolute;top:0;left:0;height:0;width:0;overflow:hidden;text-indent:-9999em}.addthis-smartlayers .at4-arrow:hover{cursor:pointer}.addthis-smartlayers .at4-arrow:after,.addthis-smartlayers .at4-arrow:before{content:none}a.at4-logo{background:url(data:image/gif;base64,R0lGODlhBwAHAJEAAP9uQf///wAAAAAAACH5BAkKAAIALAAAAAAHAAcAAAILFH6Ge8EBH2MKiQIAOw==) no-repeat left center}.at4-minimal a.at4-logo{background:url(data:image/gif;base64,R0lGODlhBwAHAJEAAP9uQf///wAAAAAAACH5BAkKAAIALAAAAAAHAAcAAAILFH6Ge8EBH2MKiQIAOw==) no-repeat left center!important}button.at4-closebutton{position:absolute;top:0;right:0;padding:0;margin-right:10px;cursor:pointer;background:transparent;border:0;-webkit-appearance:none;font-size:19px;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2}button.at4-closebutton:hover{color:#000;text-decoration:none;cursor:pointer;opacity:.5}div.at4-arrow{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAYAAABpYH0BAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAV1JREFUeNrsmesOgyAMhQfxwfrofTM3E10ME2i5Oeppwr9a5OMUCrh1XV+wcvNAAIAA+BiAzrmtUWln27dbjEcC3AdODfo0BdEPhmcO4nIDvDNELi2jggk4/k8dT7skfeKzWIEd4VUpMQKvNB7X+OZSmAZkATWC1xvipbpnLmOosbJZC08CkAeA4E6qFUEMwLAGnlSBPCE8lW8CYnZTcimH2HoT7kSFOx5HBmCnDhTIu1p5s98G+QZrxGPhZVMY1vgyAQaAAAiAAAgDQACcBOD+BvJtBWfRy7NpJK5tBe4FNzXokywV734wPHMQlxvgnSGyNoUP/2ACjv/7iSeYKO3YWKzAjvCqlBiBVxqPa3ynexNJwOsN8TJbzL6JNIYYXWpMv4lIIAZgWANPqkCeEJ7KNwExu8lpLlSpAVQarO77TyKdBsyRPuwV0h0gmoGnTWFYzVkYBoAA+I/2FmAAt6+b5XM9mFkAAAAASUVORK5CYII=);background-repeat:no-repeat;width:20px;height:20px;margin:0;padding:0;overflow:hidden;text-indent:-9999em;text-align:left;cursor:pointer}#at4-recommendedpanel-outer-container .at4-arrow.at-right,div.at4-arrow.at-right{background-position:-20px 0}#at4-recommendedpanel-outer-container .at4-arrow.at-left,div.at4-arrow.at-left{background-position:0 0}div.at4-arrow.at-down{background-position:-60px 0}div.at4-arrow.at-up{background-position:-40px 0}.ats-dark div.at4-arrow.at-right{background-position:-20px -20px}.ats-dark div.at4-arrow.at-left{background-position:0 -20px}.ats-dark div.at4-arrow.at-down{background-position:-60px -20px}.ats-dark div.at4-arrow.at-up{background-position:-40px -20}.at4-opacity-hidden{opacity:0!important}.at4-opacity-visible{opacity:1!important}.at4-visually-hidden{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;overflow:hidden}.at4-hidden-off-screen,.at4-hidden-off-screen *{position:absolute!important;top:-9999px!important;left:-9999px!important}.at4-show{display:block!important;opacity:1!important}.at4-show-content{opacity:1!important;visibility:visible}.at4-hide{display:none!important;opacity:0!important}.at4-hide-content{opacity:0!important;visibility:hidden}.at4-visible{display:block!important;opacity:0!important}.at-wordpress-hide{display:none!important;opacity:0!important}.addthis-animated{animation-fill-mode:both;animation-timing-function:ease-out;animation-duration:.3s}.slideInDown.addthis-animated,.slideInLeft.addthis-animated,.slideInRight.addthis-animated,.slideInUp.addthis-animated,.slideOutDown.addthis-animated,.slideOutLeft.addthis-animated,.slideOutRight.addthis-animated,.slideOutUp.addthis-animated{animation-duration:.4s}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.fadeIn{animation-name:fadeIn}@keyframes fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.fadeInUp{animation-name:fadeInUp}@keyframes fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.fadeInDown{animation-name:fadeInDown}@keyframes fadeInLeft{0%{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.fadeInLeft{animation-name:fadeInLeft}@keyframes fadeInRight{0%{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}.fadeInRight{animation-name:fadeInRight}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.fadeOut{animation-name:fadeOut}@keyframes fadeOutUp{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-20px)}}.fadeOutUp{animation-name:fadeOutUp}@keyframes fadeOutDown{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}.fadeOutDown{animation-name:fadeOutDown}@keyframes fadeOutLeft{0%{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(-20px)}}.fadeOutLeft{animation-name:fadeOutLeft}@keyframes fadeOutRight{0%{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(20px)}}.fadeOutRight{animation-name:fadeOutRight}@keyframes slideInUp{0%{transform:translateY(1500px)}0%,to{opacity:1}to{transform:translateY(0)}}.slideInUp{animation-name:slideInUp}.slideInUp.addthis-animated{animation-duration:.4s}@keyframes slideInDown{0%{transform:translateY(-850px)}0%,to{opacity:1}to{transform:translateY(0)}}.slideInDown{animation-name:slideInDown}@keyframes slideOutUp{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(-250px)}}.slideOutUp{animation-name:slideOutUp}@keyframes slideOutUpFast{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(-1250px)}}#at4m-menu.slideOutUp{animation-name:slideOutUpFast}@keyframes slideOutDown{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(350px)}}.slideOutDown{animation-name:slideOutDown}@keyframes slideOutDownFast{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(1250px)}}#at4m-menu.slideOutDown{animation-name:slideOutDownFast}@keyframes slideInLeft{0%{opacity:0;transform:translateX(-850px)}to{transform:translateX(0)}}.slideInLeft{animation-name:slideInLeft}@keyframes slideInRight{0%{opacity:0;transform:translateX(1250px)}to{transform:translateX(0)}}.slideInRight{animation-name:slideInRight}@keyframes slideOutLeft{0%{transform:translateX(0)}to{opacity:0;transform:translateX(-350px)}}.slideOutLeft{animation-name:slideOutLeft}@keyframes slideOutRight{0%{transform:translateX(0)}to{opacity:0;transform:translateX(350px)}}.slideOutRight{animation-name:slideOutRight}.at4win{margin:0 auto;background:#fff;border:1px solid #ebeced;width:25pc;box-shadow:0 0 10px rgba(0,0,0,.3);border-radius:8px;font-family:helvetica neue,helvetica,arial,sans-serif;text-align:left;z-index:9999}.at4win .at4win-header{position:relative;border-bottom:1px solid #f2f2f2;background:#fff;height:49px;-webkit-border-top-left-radius:8px;-webkit-border-top-right-radius:8px;-moz-border-radius-topleft:8px;-moz-border-radius-topright:8px;border-top-left-radius:8px;border-top-right-radius:8px;cursor:default}.at4win .at4win-header .at-h3,.at4win .at4win-header h3{height:49px;line-height:49px;margin:0 50px 0 0;padding:1px 0 0;margin-left:20px;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:1pc;font-weight:700;text-shadow:0 1px #fff;color:#333}.at4win .at4win-header .at-h3 img,.at4win .at4win-header h3 img{display:inline-block;margin-right:4px}.at4win .at4win-header .at4-close{display:block;position:absolute;top:0;right:0;background:url("data:image/gif;base64,R0lGODlhFAAUAIABAAAAAP///yH5BAEAAAEALAAAAAAUABQAAAIzBIKpG+YMm5Enpodw1HlCfnkKOIqU1VXk55goVb2hi7Y0q95lfG70uurNaqLgTviyyUoFADs=") no-repeat center center;background-repeat:no-repeat;background-position:center center;border-left:1px solid #d2d2d1;width:49px;height:49px;line-height:49px;overflow:hidden;text-indent:-9999px;text-shadow:none;cursor:pointer;opacity:.5;border:0;transition:opacity .15s ease-in}.at4win .at4win-header .at4-close::-moz-focus-inner{border:0;padding:0}.at4win .at4win-header .at4-close:hover{opacity:1;background-color:#ebeced;border-top-right-radius:7px}.at4win .at4win-content{position:relative;background:#fff;min-height:220px}#at4win-footer{position:relative;background:#fff;border-top:1px solid #d2d2d1;-webkit-border-bottom-right-radius:8px;-webkit-border-bottom-left-radius:8px;-moz-border-radius-bottomright:8px;-moz-border-radius-bottomleft:8px;border-bottom-right-radius:8px;border-bottom-left-radius:8px;height:11px;line-height:11px;padding:5px 20px;font-size:11px;color:#666;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}#at4win-footer a{margin-right:10px;text-decoration:none;color:#666}#at4win-footer a:hover{text-decoration:none;color:#000}#at4win-footer a.at4-logo{top:5px;padding-left:10px}#at4win-footer a.at4-privacy{position:absolute;top:5px;right:10px;padding-right:14px}.at4win.ats-dark{border-color:#555;box-shadow:none}.at4win.ats-dark .at4win-header{background:#1b1b1b;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border-top-left-radius:6px;border-top-right-radius:6px}.at4win.ats-dark .at4win-header .at4-close{background:url("data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMTMvMTKswDp5AAAAd0lEQVQ4jb2VQRLAIAgDE///Z3qqY1FAhalHMCsCIkVEAIAkkVgvp2lDBgYAnAyHkWotLccNrEd4A7X2TqIdqLfnWBAdaF5rJdyJfjtPH5GT37CaGhoVq3nOm/XflUuLUto2pY1d+vRKh0Pp+MrAVtDe2JkvYNQ+jVSEEFmOkggAAAAASUVORK5CYII=") no-repeat center center;background-image:url(//s7.addthis.com/static/fb08f6d50887bd0caacc86a62bcdcf68.svg),none;border-color:#333}.at4win.ats-dark .at4win-header .at4-close:hover{background-color:#000}.at4win.ats-dark .at4win-header .at-h3,.at4win.ats-dark .at4win-header h3{color:#fff;text-shadow:0 1px #000}.at4win.ats-gray .at4win-header{background:#fff;border-color:#d2d2d1;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border-top-left-radius:6px;border-top-right-radius:6px}.at4win.ats-gray .at4win-header a.at4-close{border-color:#d2d2d1}.at4win.ats-gray .at4win-header a.at4-close:hover{background-color:#ebeced}.at4win.ats-gray #at4win-footer{border-color:#ebeced}.at4win .clear{clear:both}.at4win ::selection{background:#fe6d4c;color:#fff}.at4win ::-moz-selection{background:#fe6d4c;color:#fff}.at4-icon-fw{display:inline-block;background-repeat:no-repeat;background-position:0 0;margin:0 5px 0 0;overflow:hidden;text-indent:-9999em;cursor:pointer;padding:0;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%}.at44-follow-container a.aticon{height:2pc;margin:0 5px 5px 0}.at44-follow-container .at4-icon-fw{margin:0}</style><script type="text/javascript" charset="utf-8" async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/83.c0c22134626f8bea7883.js.下载"></script><script type="text/javascript" charset="utf-8" async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/187.17b13b39eda06230365c.js.下载"></script><script type="text/javascript" charset="utf-8" async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/188.a96b86e7a0e171c60e86.js.下载"></script></head><body class="" style="padding-left: 300px;"><canvas class="fireworks" width="1920" height="1008" style="width: 1920px; height: 1008px;"></canvas><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true" style="color: rgb(153, 169, 191); transform: rotateZ(180deg);"></i><div id="sidebar" class="" style="transform: translateX(300px);"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar" style="width: calc(0px + 0%);"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">2.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E7%94%A8%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E4%BE%9D%E8%B5%96"><span class="toc-number">4.</span> <span class="toc-text">项目用到的一些关键依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8"><span class="toc-number">5.</span> <span class="toc-text">项目启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%9E%84%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">前端页面构建</span></a><ol class="toc-child" style="display: none; opacity: 1;"><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="toc-number">6.1.</span> <span class="toc-text">登录界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#TodoList%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.2.</span> <span class="toc-text">TodoList页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">6.3.</span> <span class="toc-text">页面路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%90%8E%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">7.</span> <span class="toc-text">后端环境搭建</span></a><ol class="toc-child" style="display: none; opacity: 1;"><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#MySQL"><span class="toc-number">7.1.</span> <span class="toc-text">MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Sequelize"><span class="toc-number">7.2.</span> <span class="toc-text">Sequelize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#API-Test"><span class="toc-number">7.3.</span> <span class="toc-text">API Test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.4.</span> <span class="toc-text">登录系统的实现</span></a><ol class="toc-child" style="display: none; opacity: 1;"><li class="toc-item toc-level-4"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#JSON-WEB-TOKEN"><span class="toc-number">7.4.1.</span> <span class="toc-text">JSON-WEB-TOKEN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%BC%95%E5%85%A5Axios"><span class="toc-number">7.4.2.</span> <span class="toc-text">引入Axios</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%AF%86%E7%A0%81bcrypt%E5%8A%A0%E5%AF%86"><span class="toc-number">7.4.3.</span> <span class="toc-text">密码bcrypt加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E8%B7%B3%E8%BD%AC%E6%8B%A6%E6%88%AA"><span class="toc-number">7.4.4.</span> <span class="toc-text">跳转拦截</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E8%A7%A3%E6%9E%90token"><span class="toc-number">7.4.5.</span> <span class="toc-text">解析token</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Todolist-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.</span> <span class="toc-text">Todolist 增删改查的实现</span></a><ol class="toc-child" style="display: none; opacity: 1;"><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Token%E7%9A%84%E5%8F%91%E9%80%81"><span class="toc-number">8.1.</span> <span class="toc-text">Token的发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Koa%E7%AB%AF%E5%AF%B9Token%E7%9A%84%E9%AA%8C%E8%AF%81"><span class="toc-number">8.2.</span> <span class="toc-text">Koa端对Token的验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%89%8D%E7%AB%AF%E5%AF%B9%E6%8E%A5%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.3.</span> <span class="toc-text">前端对接接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Todolist%E7%9A%84%E6%94%B9%E3%80%81%E5%88%A0"><span class="toc-number">8.4.</span> <span class="toc-text">Todolist的改、删</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number">9.</span> <span class="toc-text">项目部署</span></a><ol class="toc-child" style="display: none; opacity: 1;"><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Webpack%E6%89%93%E5%8C%85"><span class="toc-number">9.1.</span> <span class="toc-text">Webpack打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Koa-serve%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">9.2.</span> <span class="toc-text">Koa serve静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#API-Test-1"><span class="toc-number">9.3.</span> <span class="toc-text">API Test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#Nginx%E9%85%8D%E7%BD%AE"><span class="toc-number">9.4.</span> <span class="toc-text">Nginx配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="https://molunerfinn.com/Vue+Koa/#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="toc-number">10.</span> <span class="toc-text">写在最后</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/8700af19ly1fm4iuz15lsj20ix0iw0u8"></div><div class="author-info__name text-center">Molunerfinn</div><div class="author-info__description text-center">For MElody</div><div class="follow-button"><a href="https://github.com/Molunerfinn">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="https://molunerfinn.com/archives"><span class="pull-left">Articles</span><span class="pull-right">71</span></a><a class="author-info-articles__tags article-meta" href="https://molunerfinn.com/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a><a class="author-info-articles__categories article-meta" href="https://molunerfinn.com/categories"><span class="pull-left">Categories</span><span class="pull-right">23</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://molunerfinn.com/">Molunerfinn</a><a class="author-info-links__name text-center" href="https://elody-07.github.io/">Elody</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(&quot;https://ws1.sinaimg.cn/large/8700af19ly1fvpabr30o6j22yo1o0q7i.jpg&quot;); opacity: 1; display: block;" class=""><div id="page-header" class="open-sidebar"><span class="pull-left"><a id="site-name" href="https://molunerfinn.com/">MARKSZのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="https://molunerfinn.com/about">About</a><a class="site-page" href="https://molunerfinn.com/archives">Archives</a><a class="site-page" href="https://molunerfinn.com/tags">Tags</a><a class="site-page" href="https://molunerfinn.com/categories">Categories</a></span></div><div id="post-info"><div id="post-title">全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-05-03</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="https://molunerfinn.com/categories/Web/">Web</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="https://molunerfinn.com/categories/Web/%E5%BC%80%E5%8F%91/">开发</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="https://molunerfinn.com/categories/Web/%E5%BC%80%E5%8F%91/Nodejs/">Nodejs</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">14.4k</span><span class="post-meta__separator">|</span><span>Reading time: 55 min</span></div></div></div></div><div class="layout" id="content-inner" style="opacity: 1; display: block; transform: translateY(0px);"><article id="post"><div class="article-container" id="post-content"><h2 id="简介"><a href="https://molunerfinn.com/Vue+Koa/#%E7%AE%80%E4%BB%8B" class="headerlink" title="简介"></a>简介</h2><p>本文从一名新手的角度（默认对Vue有了解，对Koa或者Express有了解）出发，从0开始构建一个数据通过Koa提供API的形式获取，页面通过Vue渲染的完整的前端项目。可以了解到Vue构建单页面的一些知识以及前端路由的使用、Koa如何提供API接口，如何进行访问过滤（路由）、验证（JSON-WEB-TOKEN）以及Sequelize操作MySQL数据库的一些知识和技巧，希望能够作为一篇入门全栈开发的文章吧。</p><p><strong>更新</strong>：文末给出的github仓库已经更新Koa2版本。请使用Node.js v7.6.0及以上版本体验~</p><a id="more"></a><h2 id="写在前面"><a href="https://molunerfinn.com/Vue+Koa/#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" class="headerlink" title="写在前面"></a>写在前面</h2><p>我曾经写过一篇<a href="https://molunerfinn.com/nodejs-2/">文章</a>，是用express和mongodb入门Nodejs的前后端开发，这篇文章里简单的做了一个小demo，能够让你读写mongodb数据库，并且从数据库里将数据读取出来显示到页面上。算是一个简单的读写小demo吧，也算是服务端渲染的一次初尝试。并且我还写过用nodejs写简单小爬虫的<a href="https://molunerfinn.com/nodejs-1/">文章</a>，用爬虫来获取数据写入数据库。通过以上的的方法我用express写了一个小网站，记录并显示北邮人论坛每天的十大的<a href="http://topten.piegg.cn/" target="_blank" rel="noopener">内容</a>。挺好玩的对吧，可以把想要做的事用代码来实现。</p><p>后来我接触到了Koa，并开始了学习，从express迁移到Koa其实曲线还算是比较平滑的。不过用Koa的方式也还是采用服务端渲染页面的方式。而且我发现目前网络上少有写过用Koa构建的前后端分离的应用、网站文章，我最近做的一个项目里需要用到的方式就是用Vue构建页面，数据的获取全部走后端API的形式，也就是所谓的前后端分离吧。正好在这过程中走了不少的坑，包括数据库的使用上也算是个新手，所以写篇文章记录一下，用同样的思路和方法构建一个简单的Todolist，欢迎讨论，轻拍~</p><h2 id="项目结构"><a href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight plain"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── LICENSE</span><br><span class="line">├── README.md</span><br><span class="line">├── .env  // 环境变量配置文件</span><br><span class="line">├── app.js  // Koa入口文件</span><br><span class="line">├── build // vue-cli 生成，用于webpack监听、构建</span><br><span class="line">│&nbsp;&nbsp; ├── build.js</span><br><span class="line">│&nbsp;&nbsp; ├── check-versions.js</span><br><span class="line">│&nbsp;&nbsp; ├── dev-client.js</span><br><span class="line">│&nbsp;&nbsp; ├── dev-server.js</span><br><span class="line">│&nbsp;&nbsp; ├── utils.js</span><br><span class="line">│&nbsp;&nbsp; ├── webpack.base.conf.js</span><br><span class="line">│&nbsp;&nbsp; ├── webpack.dev.conf.js</span><br><span class="line">│&nbsp;&nbsp; └── webpack.prod.conf.js</span><br><span class="line">├── config // vue-cli 生成&amp;自己加的一些配置文件</span><br><span class="line">│&nbsp;&nbsp; ├── default.conf</span><br><span class="line">│&nbsp;&nbsp; ├── dev.env.js</span><br><span class="line">│&nbsp;&nbsp; ├── index.js</span><br><span class="line">│&nbsp;&nbsp; └── prod.env.js</span><br><span class="line">├── dist // Vue build 后的文件夹</span><br><span class="line">│&nbsp;&nbsp; ├── index.html // 入口文件</span><br><span class="line">│&nbsp;&nbsp; └── static // 静态资源</span><br><span class="line">├── index.html // vue-cli生成，用于容纳Vue组件的主html文件。单页应用就只有一个html</span><br><span class="line">├── package.json // npm的依赖、项目信息文件</span><br><span class="line">├── server // Koa后端，用于提供Api</span><br><span class="line">│&nbsp;&nbsp; ├── config // 配置文件夹</span><br><span class="line">│&nbsp;&nbsp; ├── controllers // controller-控制器</span><br><span class="line">│&nbsp;&nbsp; ├── models // model-模型</span><br><span class="line">│&nbsp;&nbsp; ├── routes // route-路由</span><br><span class="line">│&nbsp;&nbsp; └── schema // schema-数据库表结构</span><br><span class="line">├── src // vue-cli 生成&amp;自己添加的utils工具类</span><br><span class="line">│&nbsp;&nbsp; ├── App.vue // 主文件</span><br><span class="line">│&nbsp;&nbsp; ├── assets // 相关静态资源存放</span><br><span class="line">│&nbsp;&nbsp; ├── components // 单文件组件</span><br><span class="line">│&nbsp;&nbsp; ├── main.js // 引入Vue等资源、挂载Vue的入口js</span><br><span class="line">│&nbsp;&nbsp; └── utils // 工具文件夹-封装的可复用的方法、功能</span><br><span class="line">└── yarn.lock // 用yarn自动生成的lock文件</span><br></pre></td></tr></tbody></table></figure><p>看起来好像很复杂的样子，其实很大一部分文件夹的结构是<code>vue-cli</code>这个工具帮我们生成的。而我们需要额外添加的主要是Koa的入口文件以及一个<code>server</code>文件夹用于Koa提供API。这样的话，在获取数据的方面就可以走Koa所提供的API，而Vue只需关心怎么把这些数据渲染到页面上就好了。</p><h2 id="项目用到的一些关键依赖"><a href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E7%94%A8%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E4%BE%9D%E8%B5%96" class="headerlink" title="项目用到的一些关键依赖"></a>项目用到的一些关键依赖</h2><p>以下依赖的版本都是本文所写的时候的版本，或者更旧一些</p><ul><li>Vue.js(v2.1.8)</li><li>Vue-Router(v2.1.1)</li><li>Axios(v0.15.3)</li><li>Element(v1.1.2)</li><li>Koa.js(v1.2.4) // 没采用Koa2</li><li><a href="mailto:Koa-Router@5.4" target="_blank" rel="noopener">Koa-Router@5.4</a>\Koa-jwt\Koa-static等一系列Koa中间件</li><li>Mysql(v2.12.0) // nodejs的mysql驱动，并不是mysql本身版本（项目采用mysql5.6）</li><li>Sequelize(v3.28.0) // 操作数据库的ORM</li><li>Yarn(v0.18.1) // 比起npm更快一些</li></ul><p>剩下依赖可以参考本文最后给出的项目demo仓库。</p><h2 id="项目启动"><a href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8" class="headerlink" title="项目启动"></a>项目启动</h2><p>Nodejs与npm的安装不再叙述（希望大家装上的node版本大于等于6.x，不然还需要加上–harmony标志才可以开启es6），默认读者已经掌握npm安装依赖的方法。首先全局安装<code>npm i vue-cli -g</code>，当然本项目基本上是采用<code>yarn</code>，所以也可以<code>yarn global add vue-cli</code>。</p><blockquote><p>Tips: 可以给yarn换上淘宝源，速度更快: <code>yarn config set registry "https://registry.npm.taobao.org"</code></p></blockquote><p>然后我们初始化一个<code>Vue2的webpack</code>的模板：</p><p><code>vue init webpack demo</code></p><blockquote><p>Tips: 上面的demo可以填写你自己的项目名称</p></blockquote><p>然后进行一些基本配置选择之后，你就可以得到一个基本的<code>vue-cli</code>生成的项目结构。</p><p>接着我们进入<code>vue-cli</code>生成的目录，安装<code>Vue</code>的项目依赖并安装<code>Koa</code>的项目依赖：<code>yarn &amp;&amp; yarn add koa koa-router@5.4 koa-logger koa-json koa-bodyparser</code>，（注意是安装<code>koa-router</code>的5.4版，因为7.X版本是支持Koa2的）然后进行一些基本目录建立：</p><p>在<code>vue-cli</code>生成的<code>demo</code>目录下，建立<code>server</code>文件夹以及子文件夹：</p><figure class="highlight plain"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── server // Koa后端，用于提供Api</span><br><span class="line"> &nbsp;&nbsp; ├── config // 配置文件夹</span><br><span class="line"> &nbsp;&nbsp; ├── controllers // controller-控制器</span><br><span class="line">&nbsp; &nbsp; ├── models // model-模型</span><br><span class="line">&nbsp;&nbsp;  ├── routes // route-路由</span><br><span class="line">&nbsp;&nbsp;  └── schema // schema-数据库表结构</span><br></pre></td></tr></tbody></table></figure><p>然后在<code>demo</code>文件夹下我们创建一个<code>app.js</code>的文件，作为<code>Koa</code>的启动文件。</p><p>写入如下基本的内容就可以启动<code>Koa</code>啦：</p><figure class="highlight javascript"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>)()</span><br><span class="line">  , koa = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)()</span><br><span class="line">  , json = <span class="built_in">require</span>(<span class="string">'koa-json'</span>)</span><br><span class="line">  , logger = <span class="built_in">require</span>(<span class="string">'koa-logger'</span>); <span class="comment">// 引入各种依赖</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)());</span><br><span class="line">app.use(json());</span><br><span class="line">app.use(logger());</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>* (<span class="params">next</span>)</span>{</span><br><span class="line">  <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>;</span><br><span class="line">  <span class="keyword">yield</span> next;</span><br><span class="line">  <span class="keyword">let</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span> - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'%s %s - %s'</span>, <span class="keyword">this</span>.method, <span class="keyword">this</span>.url, ms); <span class="comment">// 显示执行的时间</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, ctx</span>)</span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server error'</span>, err);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8889</span>,() =&gt; {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Koa is listening in 8889'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></tbody></table></figure><p>然后在控制台输入<code>node app.js</code>，能看到输出<code>Koa is listening in 8889</code>，则说明我们的<code>Koa</code>已经启动成功了，并在8889端口监听。</p><h2 id="前端页面构建"><a href="https://molunerfinn.com/Vue+Koa/#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%9E%84%E5%BB%BA" class="headerlink" title="前端页面构建"></a>前端页面构建</h2><p>这个DEMO是做一个Todo-List，我们首先来做一个登录页面。</p><blockquote><p>Tips: 为了方便构建页面和美观，本文采用的Vue2的前端UI框架是<code>element-ui</code>。安装：<code>yarn add element-ui</code></p></blockquote><p>模板引擎我习惯用<code>pug</code>，CSS预处理我习惯用<code>stylus</code>，当然每个人自己的习惯和喜好是不一样的，所以大家根据自己平时的喜好来就行了。</p><p>为了方便大家查看代码，就不用<code>pug</code>了，学习成本相对高一些。不过CSS用<code>stylus</code>写起来简便，看起来也不会难懂，是我自己的习惯，所以还需要安装一下<code>yarn add stylus stylus-loader</code>。</p><blockquote><p>Tips: 安装stylus-loader是为了让webpack能够渲染stylus</p></blockquote><p>然后要把<code>element-ui</code>引入项目中。打开<code>src/main.js</code>，将文件改写如下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">'element-ui'</span> <span class="comment">// 引入element-ui</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-default/index.css'</span></span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI) <span class="comment">// Vue全局使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span>,</span><br><span class="line">  components: { App }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><p>然后我们在项目根目录下输入<code>npm run dev</code>，启动开发模式，这个模式有webpack的热加载，也就是你写完代码，浏览器立即就能响应变化。</p><p>为了实现响应式页面，我们要在项目目录下的<code>index.html</code>的<code>head</code>标签内加入以下<code>meta</code>：</p><p><code>&lt;meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"&gt;</code></p><h3 id="登录界面"><a href="https://molunerfinn.com/Vue+Koa/#%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2" class="headerlink" title="登录界面"></a>登录界面</h3><p>进入<code>src/components</code>目录，新建一个<code>Login.vue</code>的文件。然后我们来写第一个页面：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:xs</span>=<span class="string">"24"</span> <span class="attr">:sm</span>=<span class="string">"{span: 6,offset: 9}"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">       欢迎登录 </span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">"account"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">placeholder</span>=<span class="string">"账号"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">"password"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">placeholder</span>=<span class="string">"密码"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="undefined">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      account: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">      password: <span class="string">''</span></span></span><br><span class="line"><span class="undefined">    };</span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="undefined">};</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"stylus"</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.el-row</span><span class="selector-class">.content</span></span></span><br><span class="line"><span class="undefined">    padding 16px</span></span><br><span class="line"><span class="css">  <span class="selector-class">.title</span></span></span><br><span class="line"><span class="undefined">    font-size 28px</span></span><br><span class="line"><span class="css">  <span class="selector-class">.el-input</span></span></span><br><span class="line"><span class="undefined">    margin 12px 0</span></span><br><span class="line"><span class="css">  <span class="selector-class">.el-button</span></span></span><br><span class="line"><span class="undefined">    width 100%</span></span><br><span class="line"><span class="undefined">    margin-top 12px    </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>在这里就有一些值得注意的地方。首先是<code>template</code>标签内的直接子元素最多只能挂载一个。也就是你不能这么写：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span>&gt;</span><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span>&gt;</span><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>否则会报错：<code>template syntax error Component template should contain exactly one root element</code>，template下只能有一个根元素。不过为了写多个元素，你可以这样：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>同时注意到，在<code>Login.vue</code>的<code>style</code>标签内有个<code>scoped</code>属性，这个属性能够使这些样式只在这个组件内生效（因为Webpack在渲染的时候会将这个组件内的元素自动打上一串形如<code>data-v-62a7f97e</code>这样的属性，对于这些样式也会变成形如<code>.title[data-v-62a7f97e]{ font-size: 28px;}</code>的样子，保证了不会和其他组件的样式冲突。</p><p>页面写完之后，如果不把组件注册到Vue之下那么页面是不会显示的。因此这个时候需要把<code>APP.vue</code>这个文件改写一下：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./assets/logo.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Login</span>&gt;</span><span class="tag">&lt;/<span class="name">Login</span>&gt;</span> <span class="comment">&lt;!--使用Login组件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'./components/Login'</span> <span class="comment">// 引入Login组件</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'app'</span>,</span></span><br><span class="line"><span class="undefined">  components: {</span></span><br><span class="line"><span class="javascript">    Login <span class="comment">// 注册组件</span></span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="undefined">}</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> {</span></span><br><span class="line"><span class="undefined">  font-family: 'Avenir', Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="undefined">  -webkit-font-smoothing: antialiased;</span></span><br><span class="line"><span class="undefined">  -moz-osx-font-smoothing: grayscale;</span></span><br><span class="line"><span class="undefined">  text-align: center;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line"><span class="undefined">  margin-top: 60px;</span></span><br><span class="line"><span class="undefined">}</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>也就是把<code>Login</code>这个组件注册到<code>Vue</code>下，同时你再看浏览器，已经不再是<code>vue-cli</code>默认生成的<code>Hello</code>欢迎界面了。</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login.png" data-fancybox="group" data-caption="Login" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login.png" alt="Login" title="Login"><div class="img-alt">Login</div></a></p><p>接着我们写一下登录成功后的界面。</p><h3 id="TodoList页面"><a href="https://molunerfinn.com/Vue+Koa/#TodoList%E9%A1%B5%E9%9D%A2" class="headerlink" title="TodoList页面"></a>TodoList页面</h3><p>还是在<code>src/components</code>目录下，写一个叫做<code>TodoList.vue</code>的文件。</p><p>接着我们开始写一个TodoList：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:xs</span>=<span class="string">"{span:20,offset:2}"</span> <span class="attr">:sm</span>=<span class="string">"{span:8,offset:8}"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">        欢迎：{{name}}！你的待办事项是：</span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">"请输入待办事项"</span> <span class="attr">v-model</span>=<span class="string">"todos"</span> @<span class="attr">keyup.enter.native</span>=<span class="string">"addTodos"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">v-model</span>=<span class="string">"activeName"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">"待办事项"</span> <span class="attr">name</span>=<span class="string">"first"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:xs</span>=<span class="string">"24"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">"!Done"</span>&gt;</span> <span class="comment">&lt;!--v-if和v-for不能同时在一个元素内使用，因为Vue总会先执行v-for--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in list"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"todo-list"</span> <span class="attr">v-if</span>=<span class="string">"item.status == false"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">                    {{ index + 1 }}. {{ item.content }}</span><br><span class="line">                  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"finished(index)"</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">:plain</span>=<span class="string">"true"</span> <span class="attr">type</span>=<span class="string">"danger"</span> @<span class="attr">click</span>=<span class="string">"remove(index)"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">template</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"Done"</span>&gt;</span></span><br><span class="line">              暂无待办事项</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">"已完成事项"</span> <span class="attr">name</span>=<span class="string">"second"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">"count &gt; 0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in list"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"todo-list"</span> <span class="attr">v-if</span>=<span class="string">"item.status == true"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"item finished"</span>&gt;</span></span><br><span class="line">                  {{ index + 1 }}. {{ item.content }}</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"restore(index)"</span>&gt;</span>还原<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">            暂无已完成事项</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="undefined">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      name: <span class="string">'Molunerfinn'</span>,</span></span><br><span class="line"><span class="javascript">      todos: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">      activeName: <span class="string">'first'</span>,</span></span><br><span class="line"><span class="undefined">      list:[],</span></span><br><span class="line"><span class="undefined">      count: 0</span></span><br><span class="line"><span class="undefined">    };</span></span><br><span class="line"><span class="undefined">  },</span></span><br><span class="line"><span class="javascript">  computed: { <span class="comment">// 计算属性用于计算是否已经完成了所有任务</span></span></span><br><span class="line"><span class="undefined">    Done(){</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> length = <span class="keyword">this</span>.list.length;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> <span class="keyword">this</span>.list){</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.list[i].status == <span class="literal">true</span> ? count += <span class="number">1</span> : <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">      }</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.count = count;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(count == length || length == <span class="number">0</span>){</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">      }<span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">      }</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined">  },</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  methods: {</span></span><br><span class="line"><span class="undefined">    addTodos() {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(<span class="keyword">this</span>.todos == <span class="string">''</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> obj = {</span></span><br><span class="line"><span class="javascript">        status: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">        content: <span class="keyword">this</span>.todos</span></span><br><span class="line"><span class="undefined">      }</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.list.push(obj);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.todos = <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">    },</span></span><br><span class="line"><span class="undefined">    finished(index) {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$<span class="keyword">set</span>(this.list[index],'status',true) // 通过<span class="keyword">set</span>的方法让数组的变动能够让Vue检测到</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$message({</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'success'</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">'任务完成'</span></span></span><br><span class="line"><span class="undefined">      })</span></span><br><span class="line"><span class="undefined">    },</span></span><br><span class="line"><span class="undefined">    remove(index) {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.list.splice(index,<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$message({</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'info'</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">'任务删除'</span></span></span><br><span class="line"><span class="undefined">      })</span></span><br><span class="line"><span class="undefined">    },</span></span><br><span class="line"><span class="undefined">    restore(index) {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$<span class="keyword">set</span>(this.list[index],'status',false)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$message({</span></span><br><span class="line"><span class="javascript">        type: <span class="string">'info'</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">'任务还原'</span></span></span><br><span class="line"><span class="undefined">      })</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="undefined">};</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"stylus"</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">  <span class="selector-class">.el-input</span></span></span><br><span class="line"><span class="undefined">    margin 20px auto</span></span><br><span class="line"><span class="css">  <span class="selector-class">.todo-list</span></span></span><br><span class="line"><span class="undefined">    width 100%</span></span><br><span class="line"><span class="undefined">    margin-top 8px</span></span><br><span class="line"><span class="undefined">    padding-bottom 8px</span></span><br><span class="line"><span class="css">    <span class="selector-tag">border-bottom</span> 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#eee</span></span></span><br><span class="line"><span class="undefined">    overflow hidden</span></span><br><span class="line"><span class="undefined">    text-align left</span></span><br><span class="line"><span class="css">    <span class="selector-class">.item</span></span></span><br><span class="line"><span class="undefined">      font-size 20px</span></span><br><span class="line"><span class="css">      &amp;<span class="selector-class">.finished</span></span></span><br><span class="line"><span class="undefined">        text-decoration line-through</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span> <span class="selector-id">#ddd</span></span></span><br><span class="line"><span class="css">  <span class="selector-class">.pull-right</span></span></span><br><span class="line"><span class="undefined">    float right</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>页面构建其实没有什么特别好说的，但是因为我自己有踩点坑，所以还是专门讲一下：</p><ol><li><p><code>v-if</code>和<code>v-for</code>放在一个元素内同时使用，因为Vue总会先执行<code>v-for</code>，所以导致<code>v-if</code>不会被执行。替代地，你可以使用一个额外的<code>template</code>元素用来放置<code>v-if</code>或者<code>v-for</code>从而达到同样的目的。这是相关的<a href="https://github.com/vuejs/vue/issues/3106" target="_blank" rel="noopener">issue</a>。</p></li><li><p>计算属性对于直接的数据比如<code>a: 2</code> -&gt; <code>a: 3</code>这样的数据变动可以直接检测到。但是如果是本例中的<code>list</code>的某一项的<code>status</code>这个属性变化了，如果我们直接使用<code>list[index].status = true</code>这样的写法的话，Vue将无法检测到数据变动。替代地，可以使用<code>set</code>方法（全局是<code>Vue.set()</code>，实例中是<code>this.$set()</code>），通过<code>set</code>方法可以让数据的变动变得可以被检测到。从而让计算属性能够捕捉到变化。可以参考官方文档对于响应式原理的<a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">描述</a>。</p></li></ol><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist.gif" data-fancybox="group" data-caption="Todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist.gif" alt="Todolist" title="Todolist"><div class="img-alt">Todolist</div></a></p><p>写完<code>TodoList</code>之后，我们需要将它和<code>vue-router</code>配合起来，从而使这个单页应用能够进行页面跳转。</p><h3 id="页面路由"><a href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1" class="headerlink" title="页面路由"></a>页面路由</h3><p>由于不采用服务端渲染，所以页面路由走的是前端路由。安装一下<code>vue-router</code>：<code>yarn add vue-router</code>。</p><p>安装好后，我们挂载一下路由。打开<code>main.js</code>文件改写如下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-default/index.css'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI);</span><br><span class="line">Vue.use(VueRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">`./components/Login`</span></span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">`./components/TodoList`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router =  <span class="keyword">new</span> VueRouter({</span><br><span class="line">  mode: <span class="string">'history'</span>, <span class="comment">// 开启HTML5的history模式，可以让地址栏的url长得跟正常页面跳转的url一样。（不过还需要后端配合，讲Koa的时候会说）</span></span><br><span class="line">  base: __dirname, </span><br><span class="line">  routes: [</span><br><span class="line">    {</span><br><span class="line">      path: <span class="string">'/'</span>,  <span class="comment">// 默认首页打开是登录页</span></span><br><span class="line">      component: Login</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      path: <span class="string">'/todolist'</span>,</span><br><span class="line">      component: TodoList</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      path: <span class="string">'*'</span>,</span><br><span class="line">      redirect: <span class="string">'/'</span> <span class="comment">// 输入其他不存在的地址自动跳回首页</span></span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue({</span><br><span class="line">  router: router, <span class="comment">// 启用router</span></span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App) </span><br><span class="line">}).$mount(<span class="string">'#app'</span>) <span class="comment">//挂载到id为app的元素上</span></span><br></pre></td></tr></tbody></table></figure><p>这样就把路由挂载好了，但是你打开页面发现好像还是没有什么变化。这是因为我们没有把路由视图放到页面上。现在我们改写一下<code>APP.vue</code>：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- APP.vue --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./assets/logo.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span> <span class="comment">&lt;!-- 原本的Login换成了router-view 这就是路由视图渲染的目标元素--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'app'</span> <span class="comment">// 不需要再引入`Login`\`TodoList`组件了，因为在路由里已经注册了</span></span></span><br><span class="line"><span class="undefined">}</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> {</span></span><br><span class="line"><span class="undefined">  font-family: 'Avenir', Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="undefined">  -webkit-font-smoothing: antialiased;</span></span><br><span class="line"><span class="undefined">  -moz-osx-font-smoothing: grayscale;</span></span><br><span class="line"><span class="undefined">  text-align: center;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line"><span class="undefined">  margin-top: 60px;</span></span><br><span class="line"><span class="undefined">}</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>然后再看一下你的页面，这个时候你如果在地址栏后加上<code>/todolist</code>那么就会跳转到<code>TodoList</code>页面啦。</p><p>不过我们如何通过点击登录按钮跳转到<code>TodoList</code>呢？改写一下<code>Login.vue</code>，就可以跳转了。</p><p>只需要给登录的<code>button</code>加一个方法即可：</p><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Login.vue --&gt;</span></span><br><span class="line">······</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 给input增加键盘事件，当输入完密码回车也执行loginToDo方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-input</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">"password"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">"密码"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">keyup.enter.native</span>=<span class="string">"loginToDo"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 增加一个click方法 loginToDo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"loginToDo"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">······</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> {</span></span><br><span class="line"><span class="undefined">  data () {</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> {</span></span><br><span class="line"><span class="javascript">      account: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">      password: <span class="string">''</span></span></span><br><span class="line"><span class="undefined">    };</span></span><br><span class="line"><span class="undefined">  },</span></span><br><span class="line"><span class="undefined">  methods: {</span></span><br><span class="line"><span class="undefined">    loginToDo() {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$router.push(<span class="string">'/todolist'</span>) <span class="comment">// 编程式路由，通过push方法，改变路由。</span></span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="undefined">};</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>然后你就可以通过点击<code>登录</code>按钮进行页面跳转了。并且你可以发现，页面地址从<code>localhost:8080</code>变成了<code>localhost:8080/todolist</code>，长得跟正常的url跳转一样。（但是实际上我们是单页应用，只是在应用内进行页面跳转而已，没有向后端额外请求）</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist.gif" data-fancybox="group" data-caption="login2todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist.gif" alt="login2todolist" title="login2todolist"><div class="img-alt">login2todolist</div></a></p><p>至此，我们已经完成了一个纯前端的单页应用，能够进行页面跳转，能够做简单的ToDoList的添加和删除和还原。当然这个东西只能算是个能看不能用的东西——因为登录系统有名无实、ToDoList只要页面刷新一下就没了。</p><p>于是我们可以先把前端放一放。开启我们的后端之旅。</p><h2 id="后端环境搭建" class=""><a href="https://molunerfinn.com/Vue+Koa/#%E5%90%8E%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" class="headerlink" title="后端环境搭建"></a>后端环境搭建</h2><h3 id="MySQL"><a href="https://molunerfinn.com/Vue+Koa/#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>之所以没有用Node界大家普遍喜爱的<code>Mongodb</code>主要是因为之前我用过它，而没有用过<code>MySQL</code>，本着学习的态度，我决定用用<code>MySQL</code>。还有就是<code>Express + Mongodb</code>的教程其实很早之前就已经满大街都是了。所以如果你觉得<code>Mongodb</code>更合你的胃口，看完本文你完全可以用<code>Mongodb</code>构建一个类似的应用。</p><p>去<code>MySQL</code>的<a href="https://dev.mysql.com/downloads/" target="_blank" rel="noopener">官网</a>下载安装对应平台<code>MySQL</code>的<code>Community Server</code>。</p><p>通常来说安装的步骤都是比较简单的。对于<code>MySQL</code>的基本安装、开启步骤可以参考这篇<a href="http://www.rathishkumar.in/2016/01/how-to-install-mysql-server-on-windows.html" target="_blank" rel="noopener">文章</a>，这篇是windows的。当然其他平台的安装也是很方便的，都有相应的包管理工具可以获取。值得注意的就是，安装完<code>MySQL</code>之后你需要设定一下<code>root</code>账户的密码。保证安全性。如果你漏了设定，或者你不知道怎么设定，可以参考这篇<a href="https://www.howtoforge.com/setting-changing-resetting-mysql-root-passwords" target="_blank" rel="noopener">文章</a></p><p>因为我对<code>MySQL</code>的SQL语句不是很熟悉，所以我需要一个可视化的工具来操作<code>MySQL</code>。Windows上我用的是<a href="http://www.heidisql.com/" target="_blank" rel="noopener">HediSQL</a>，macOS上我用的是<a href="https://www.sequelpro.com/" target="_blank" rel="noopener">Sequel Pro</a>。它们都是免费的。</p><p>然后我们可以用这些可视化工具连上MySQL的server（默认端口是3306）之后，创建一个新的数据库，叫做<code>todolist</code>。（当然你也可以用SQL语句:<code>CREATE DATABASE todolist</code>，之后不再赘述）。</p><p>接着我们可以来开始创建数据表了。</p><p>我们需要创建两张表，一张是用户表，一张是待办事项表。用户表用于登录、验证，待办事项表用于展示我们的待办事项。</p><p>创建一张<code>user</code>表，其中<code>password</code>我们稍后会进行<code>bcrypt</code>加密（取128位）。</p><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>int（自增）</td><td>用户的id</td></tr><tr><td>user_name</td><td>CHAR(50)</td><td>用户的名字</td></tr><tr><td>password</td><td>CHAR(128)</td><td>用户的密码</td></tr></tbody></table><p>创建一张<code>list</code>表，所需的字段是<code>id</code>、<code>user_id</code>、<code>content</code>、<code>status</code>即可。</p><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>int（自增）</td><td>list的id</td></tr><tr><td>user_id</td><td>int(11)</td><td>用户的id</td></tr><tr><td>content</td><td>CHAR(255)</td><td>list的内容</td></tr><tr><td>status</td><td>tinyint(1)</td><td>list的状态</td></tr></tbody></table><p>直接跟数据库打交道的部分基本就是这样了。</p><h3 id="Sequelize"><a href="https://molunerfinn.com/Vue+Koa/#Sequelize" class="headerlink" title="Sequelize"></a>Sequelize</h3><p>跟数据库打交道的时候我们都需要一个好的操作数据库的工具，能够让我们用比较简单的方法来对数据库进行增删改查。对于<code>Mongodb</code>来说大家熟悉的是<a href="http://mongoosejs.com/" target="_blank" rel="noopener"><code>Mongoose</code></a>以及我用过一个相对更简单点的<a href="https://github.com/Automattic/monk" target="_blank" rel="noopener"><code>Monk</code></a>。对于<code>MySQL</code>，我选用的是<a href="https://github.com/sequelize/sequelize" target="_blank" rel="noopener"><code>Sequelize</code></a>，它支持多种关系型数据库（<code>Sqlite</code>、<code>MySQL</code>、<code>Postgres</code>等），它的操作基本都能返回一个<code>Promise</code>对象，这样在Koa里面我们能够很方便地进行”同步”操作。</p><blockquote><p>更多关于Sequelize的用法，可以参考<a href="http://docs.sequelizejs.com/en/latest/" target="_blank" rel="noopener">官方文档</a>，以及这两篇文章——<a href="http://itbilu.com/nodejs/npm/VkYIaRPz-.html" target="_blank" rel="noopener">Sequelize中文API文档</a>、<a href="https://segmentfault.com/a/1190000003987871" target="_blank" rel="noopener">Sequelize和MySQL对照</a></p></blockquote><p>在用<code>Sequelize</code>连接数据库之前我们需要把数据库的表结构用<code>sequelize-auto</code>导出来。</p><blockquote><p>更多关于<code>sequelize-auto</code>的使用可以参考<a href="https://github.com/sequelize/sequelize-auto" target="_blank" rel="noopener">官方介绍</a>或者<a href="http://itbilu.com/nodejs/npm/41mRdls_Z.html" target="_blank" rel="noopener">这篇文章</a></p></blockquote><p>由此我们需要分别安装这几个依赖：<code>yarn global add sequelize-auto &amp;&amp; yarn add sequelize mysql</code>。</p><blockquote><p>注：上面用yarn安装的mysql是nodejs环境下的mysql驱动。</p></blockquote><p>进入<code>server</code>的目录，执行如下语句<code>sequelize-auto -o "./schema" -d todolist -h 127.0.0.1 -u root -p 3306 -x XXXXX -e mysql</code>，（其中 -o 参数后面的是输出的文件夹目录， -d 参数后面的是数据库名， -h 参数后面是数据库地址， -u 参数后面是数据库用户名， -p 参数后面是端口号， -x 参数后面是数据库密码，这个要根据自己的数据库密码来！ -e 参数后面指定数据库为mysql）</p><p>然后就会在<code>schema</code>文件夹下自动生成两个文件：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">sequelize, DataTypes</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> sequelize.define(<span class="string">'user'</span>, {</span><br><span class="line">    id: {</span><br><span class="line">      type: DataTypes.INTEGER(<span class="number">11</span>), <span class="comment">// 字段类型</span></span><br><span class="line">      allowNull: <span class="literal">false</span>, <span class="comment">// 是否允许为NULL</span></span><br><span class="line">      primaryKey: <span class="literal">true</span>, <span class="comment">// 主键</span></span><br><span class="line">      autoIncrement: <span class="literal">true</span> <span class="comment">// 是否自增</span></span><br><span class="line">    },</span><br><span class="line">    user_name: {</span><br><span class="line">      type: DataTypes.CHAR(<span class="number">50</span>), <span class="comment">// 最大长度为50的字符串</span></span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    password: {</span><br><span class="line">      type: DataTypes.CHAR(<span class="number">32</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">  }, {</span><br><span class="line">    tableName: <span class="string">'user'</span> <span class="comment">// 表名</span></span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">sequelize, DataTypes</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> sequelize.define(<span class="string">'list'</span>, {</span><br><span class="line">    id: {</span><br><span class="line">      type: DataTypes.INTEGER(<span class="number">11</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      primaryKey: <span class="literal">true</span>,</span><br><span class="line">      autoIncrement: <span class="literal">true</span></span><br><span class="line">    },</span><br><span class="line">    user_id: {</span><br><span class="line">      type: DataTypes.INTEGER(<span class="number">11</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    content: {</span><br><span class="line">      type: DataTypes.CHAR(<span class="number">255</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    },</span><br><span class="line">    status: {</span><br><span class="line">      type: DataTypes.INTEGER(<span class="number">1</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">  }, {</span><br><span class="line">    tableName: <span class="string">'list'</span></span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>自动化工具省去了很多我们手动定义表结构的时间。同时注意到生成的数据库表结构文件都自动帮我们<code>module.exports</code>出来了，所以很方便我们之后的引入。</p><p>在<code>server</code>目录下的<code>config</code>目录下我们新建一个<code>db.js</code>，用于初始化<code>Sequelize</code>和数据库的连接。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">'sequelize'</span>); <span class="comment">// 引入sequelize</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用url连接的形式进行连接，注意将root: 后面的XXXX改成自己数据库的密码</span></span><br><span class="line"><span class="keyword">const</span> Todolist = <span class="keyword">new</span> Sequelize(<span class="string">'mysql://root:XXXX@localhost/todolist'</span>,{</span><br><span class="line">  define: {</span><br><span class="line">    timestamps: <span class="literal">false</span> <span class="comment">// 取消Sequelzie自动给数据表加入时间戳（createdAt以及updatedAt）</span></span><br><span class="line">  }</span><br><span class="line">}) </span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  Todolist <span class="comment">// 将Todolist暴露出接口方便Model调用</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>接着我们去<code>models</code>文件夹里将数据库和表结构文件连接起来。在这个文件夹下新建一个<code>user.js</code>的文件。我们先来写一个查询用户<code>id</code>的东西。</p><p>为此我们可以先在数据库里随意加一条数据：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/database-1.png" data-fancybox="group" data-caption="test" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/database-1.png" alt="test" title="test"><div class="img-alt">test</div></a></p><p>通常我们要查询一个用户id为1的数据，会很自然的想到类似如下的写法：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> userInfo = User.findOne({ <span class="attr">where</span>: { <span class="attr">id</span>: <span class="number">1</span>} }); <span class="comment">// 查询</span></span><br><span class="line"><span class="built_in">console</span>.log(userInfo); <span class="comment">// 输出结果</span></span><br></pre></td></tr></tbody></table></figure><p>但是上面的写法实际上是行不通的。因为JS的特性让它的IO操作是异步的。而上面的写法，<code>userInfo</code>将是返回的一个<code>Promise</code>对象，而不是最终的<code>userInfo</code>。如果又想用同步的写法获取异步IO操作得到的数据的话，通常情况下是不能直接得到的。但是在Koa里，由于有<a href="https://github.com/tj/co" target="_blank" rel="noopener"><code>co</code></a>的存在，让这一切变得十分简单。改写如下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/user.js</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'../config/db.js'</span>), </span><br><span class="line">      userModel = <span class="string">'../schema/user.js'</span>; <span class="comment">// 引入user的表结构</span></span><br><span class="line"><span class="keyword">const</span> TodolistDb = db.Todolist; <span class="comment">// 引入数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = TodolistDb.import(userModel); <span class="comment">// 用sequelize的import方法引入表结构，实例化了User。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserById = <span class="function"><span class="keyword">function</span>* (<span class="params">id</span>)</span>{ <span class="comment">// 注意是function* 而不是function 对于需要yield操作的函数都需要这种generator函数。</span></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="keyword">yield</span> User.findOne({ <span class="comment">// 用yield控制异步操作，将返回的Promise对象里的数据返回出来。也就实现了“同步”的写法获取异步IO操作的数据</span></span><br><span class="line">    where: {</span><br><span class="line">      id: id</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> userInfo <span class="comment">// 返回数据</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getUserById  <span class="comment">// 导出getUserById的方法，将会在controller里调用</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>接着我们在<code>controllers</code>写一个user的controller，来执行这个方法，并返回结果。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllers/user.js </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">'../models/user.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserInfo = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id; <span class="comment">// 获取url里传过来的参数里的id</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> user.getUserById(id);  <span class="comment">// 通过yield “同步”地返回查询结果</span></span><br><span class="line">  <span class="keyword">this</span>.body = result <span class="comment">// 将请求的结果放到response的body里返回</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getUserInfo <span class="comment">// 把获取用户信息的方法暴露出去 </span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>写完这个还不能直接请求，因为我们还没有定义路由，请求经过<code>Koa</code>找不到这个路径是没有反应的。</p><p>在<code>routes</code>文件夹下写一个<code>auth.js</code>的文件。（其实<code>user</code>表是用于登录的，所以走<code>auth</code>）</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/auth.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = <span class="built_in">require</span>(<span class="string">'../controllers/user.js'</span>); </span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/user/:id'</span>, auth.getUserInfo); <span class="comment">// 定义url的参数是id,用user的auth方法引入router</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router; <span class="comment">// 把router规则暴露出去</span></span><br></pre></td></tr></tbody></table></figure><p>至此我们已经接近完成我们的第一个API了，还缺最后一步，将这个路由规则“挂载”到Koa上去。</p><p>回到根目录的<code>app.js</code>，改写如下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>)()</span><br><span class="line">  , koa = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)()</span><br><span class="line">  , json = <span class="built_in">require</span>(<span class="string">'koa-json'</span>)</span><br><span class="line">  , logger = <span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</span><br><span class="line">  , auth = <span class="built_in">require</span>(<span class="string">'./server/routes/auth.js'</span>); <span class="comment">// 引入auth</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)());</span><br><span class="line">app.use(json());</span><br><span class="line">app.use(logger());</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>* (<span class="params">next</span>)</span>{</span><br><span class="line">  <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>;</span><br><span class="line">  <span class="keyword">yield</span> next;</span><br><span class="line">  <span class="keyword">let</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span> - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'%s %s - %s'</span>, <span class="keyword">this</span>.method, <span class="keyword">this</span>.url, ms);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, ctx</span>)</span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server error'</span>, err);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">koa.use(<span class="string">'/auth'</span>, auth.routes()); <span class="comment">// 挂载到koa-router上，同时会让所有的auth的请求路径前面加上'/auth'的请求路径。</span></span><br><span class="line"></span><br><span class="line">app.use(koa.routes()); <span class="comment">// 将路由规则挂载到Koa上。</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8889</span>,() =&gt; {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Koa is listening in 8889'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></tbody></table></figure><p>打开你的控制台，输入<code>node app.js</code>，一切运行正常没有报错的话，大功告成，我们的第一个API已经构建完成！</p><p>如何测试呢？</p><h3 id="API-Test"><a href="https://molunerfinn.com/Vue+Koa/#API-Test" class="headerlink" title="API Test"></a>API Test</h3><p>接口在跟跟前端对接之前，我们应该先进行一遍测试，防止出现问题。在测试接口的工具上，我推荐<a href="https://www.getpostman.com/" target="_blank" rel="noopener"><code>Postman</code></a>，这个工具能够很好的模拟发送的各种请求，方便的查看响应结果，用来进行测试是最好不过了。</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/postman-1.png" data-fancybox="group" data-caption="Postman" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/postman-1.png" alt="Postman"><div class="img-alt">Postman</div></a></p><p>测试成功，我发送了正确的url请求，返回的结果也是我想看到的。我们看到返回的结果实际上是个JSON，这对于我们前后端来说都是十分方便处理的数据格式。</p><p>但是如果我们代码出了问题，返回error了我们该怎么测试呢？如果说控制台能够反馈一定的信息，但是绝对不充分，并且我们很可能不知道哪步出错了导致最终结果出问题。</p><p>所以我推荐用<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">VSCode</a>这个工具来帮我们调试nodejs后端的代码。它能够添加断点，能够很方便地查看请求的信息。并且配合上<a href="https://github.com/remy/nodemon" target="_blank" rel="noopener"><code>nodemon</code></a>这类的工具，调试简直不要更舒服。</p><p>关于<code>VSCode</code>的nodejs调试，可以参考官方的这篇<a href="https://code.visualstudio.com/docs/editor/node-debugging" target="_blank" rel="noopener">文章</a></p><blockquote><p>我自己是用Sublime写代码，用VSCode调试，哈哈。</p></blockquote><h3 id="登录系统的实现"><a href="https://molunerfinn.com/Vue+Koa/#%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0" class="headerlink" title="登录系统的实现"></a>登录系统的实现</h3><p>刚才实现的不过是一个简单的用户信息查询的接口，但是我们要实现的是一个登录系统，所以还需要做一些工作。</p><h4 id="JSON-WEB-TOKEN"><a href="https://molunerfinn.com/Vue+Koa/#JSON-WEB-TOKEN" class="headerlink" title="JSON-WEB-TOKEN"></a>JSON-WEB-TOKEN</h4><p>基于cookie或者session的登录验证已经屡见不鲜，前段时间<code>JSON-WEB-TOKEN</code>出来后很是风光了一把。引入了它之后，能够实现真正无状态的请求，而不是基于session和cookie的存储式的有状态验证。</p><p>关于JSON-WEB-TOKEN的描述可以参考这篇<a href="http://blog.leapoahead.com/2015/09/07/user-authentication-with-jwt/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener">文章</a>比较简单，我还推荐一篇<a href="https://segmentfault.com/a/1190000005783306" target="_blank" rel="noopener">文章</a>，将如何使用JSON-WEB-TOKEN写得很清楚。</p><p>另外可以在JSON-WEB-TOKEN的<a href="https://jwt.io/" target="_blank" rel="noopener">官网</a>上感受一下。</p><blockquote><p>Tips：JSON-WEB-TOKEN分三部分，头部信息+主体信息+密钥信息，其中主体传递的信息（是我们存放我们需要的信息的部分）是用BASE64编码的，所以很容易被解码，一定不能存放明文密码这种关键信息！替代地可以存放一些不是特别关键的信息，比如用户名这样能够做区分的信息。</p></blockquote><p>简单来说，运用了JSON-WEB-TOKEN的登录系统应该是这样的：</p><ol><li>用户在登录页输入账号密码，将账号密码（密码进行md5加密）发送请求给后端</li><li>后端验证一下用户的账号和密码的信息，如果符合，就下发一个TOKEN返回给客户端。如果不符合就不发送TOKEN回去，返回验证错误信息。</li><li>如果登录成功，客户端将TOKEN用某种方式存下来（SessionStorage、LocalStorage）,之后要请求其他资源的时候，在请求头（Header）里带上这个TOKEN进行请求。</li><li>后端收到请求信息，先验证一下TOKEN是否有效，有效则下发请求的资源，无效则返回验证错误。</li></ol><p>通过这个TOKEN的方式，客户端和服务端之间的访问，是<code>无状态</code>的：也就是服务端不知道你这个用户到底还在不在线，只要你发送的请求头里的TOKEN是正确的我就给你返回你想要的资源。这样能够不占用服务端宝贵的空间资源，而且如果涉及到服务器集群，如果服务器进行维护或者迁移或者需要CDN节点的分配的话，<code>无状态</code>的设计显然维护成本更低。</p><p>话不多说，我们来把<code>JSON-WEB-TOKEN</code>用到我们的项目中。</p><p><code>yarn add koa-jwt</code>，安装<code>Koa</code>的<code>JSON-WEB-TOKEN</code>库。</p><p>我们需要在<code>models</code>里的<code>user.js</code>加一个方法，通过用户名查找用户：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/user.js</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// 前面的省略了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增一个方法，通过用户名查找</span></span><br><span class="line"><span class="keyword">const</span> getUserByName = <span class="function"><span class="keyword">function</span>* (<span class="params">name</span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="keyword">yield</span> User.findOne({</span><br><span class="line">    where: {</span><br><span class="line">      user_name: name</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> userInfo</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getUserById, <span class="comment">// 导出getUserById的方法，将会在controller里调用</span></span><br><span class="line">  getUserByName</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后我们写一下<code>controllers</code>里的<code>user.js</code>：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllers/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">'../models/user.js'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'koa-jwt'</span>); <span class="comment">// 引入koa-jwt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserInfo = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id; <span class="comment">// 获取url里传过来的参数里的id</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> user.getUserById(id);  <span class="comment">// 通过yield “同步”地返回查询结果</span></span><br><span class="line">  <span class="keyword">this</span>.body = result <span class="comment">// 将请求的结果放到response的body里返回</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postUserAuth = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">this</span>.request.body; <span class="comment">// post过来的数据存在request.body里</span></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="keyword">yield</span> user.getUserByName(data.name);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(userInfo != <span class="literal">null</span>){ <span class="comment">// 如果查无此用户会返回null</span></span><br><span class="line">    <span class="keyword">if</span>(userInfo.password != data.password){</span><br><span class="line">      <span class="keyword">this</span>.body = {</span><br><span class="line">        success: <span class="literal">false</span>, <span class="comment">// success标志位是方便前端判断返回是正确与否</span></span><br><span class="line">        info: <span class="string">'密码错误！'</span></span><br><span class="line">      }</span><br><span class="line">    }<span class="keyword">else</span>{ <span class="comment">// 如果密码正确</span></span><br><span class="line">      <span class="keyword">const</span> userToken = {</span><br><span class="line">        name: userInfo.user_name,</span><br><span class="line">        id: userInfo.id</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">const</span> secret = <span class="string">'vue-koa-demo'</span>; <span class="comment">// 指定密钥，这是之后用来判断token合法性的标志</span></span><br><span class="line">      <span class="keyword">const</span> token = jwt.sign(userToken,secret); <span class="comment">// 签发token</span></span><br><span class="line">      <span class="keyword">this</span>.body = {</span><br><span class="line">        success: <span class="literal">true</span>,</span><br><span class="line">        token: token, <span class="comment">// 返回token</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }<span class="keyword">else</span>{</span><br><span class="line">    <span class="keyword">this</span>.body = {</span><br><span class="line">      success: <span class="literal">false</span>,</span><br><span class="line">      info: <span class="string">'用户不存在！'</span> <span class="comment">// 如果用户不存在返回用户不存在</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getUserInfo,</span><br><span class="line">  postUserAuth</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>再把<code>routes</code>里的路由规则更新一下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes/auth.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = <span class="built_in">require</span>(<span class="string">'../controllers/user.js'</span>); </span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/user/:id'</span>, auth.getUserInfo); <span class="comment">// 定义url的参数是id,用user的auth方法引入router</span></span><br><span class="line">router.post(<span class="string">'/user'</span>, auth.postUserAuth);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router; <span class="comment">// 把router规则暴露出去</span></span><br></pre></td></tr></tbody></table></figure><p>由此我们写完了用户认证的部分。接下去我们要改写一下前端登录的方法。</p><h4 id="引入Axios"><a href="https://molunerfinn.com/Vue+Koa/#%E5%BC%95%E5%85%A5Axios" class="headerlink" title="引入Axios"></a>引入Axios</h4><p>之前在学<code>Vue</code>的时候一直用的是<a href="https://github.com/pagekit/vue-resource" target="_blank" rel="noopener"><code>vue-resource</code></a>，不过后来<code>Vue2</code>出来之后，Vue官方不再默认推荐它为官方的<code>ajax</code>网络请求库了。替代地推荐了一些其他的库，比如就有我们今天要用的<a href="https://github.com/mzabriskie/axios" target="_blank" rel="noopener"><code>axios</code></a>。我之前也没有用过它，不过看完它的star和简要介绍<code>Promise based HTTP client for the browser and node.js</code>，能够同时支持node和浏览器端的ajax请求工具（还是基于Promised的！），我想就有必要用一用啦。</p><p><code>yarn add axios</code>，安装<code>axios</code>。然后我们在<code>src/main.js</code>里面引入<code>axios</code>：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// scr/main.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$http = Axios <span class="comment">// 类似于vue-resource的调用方法，之后可以在实例里直接用this.$http.get()等</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Login.vue</span></span><br><span class="line"><span class="comment">// 省略前面的部分</span></span><br><span class="line"></span><br><span class="line"> methods: {</span><br><span class="line">    loginToDo() {</span><br><span class="line">      <span class="keyword">let</span> obj = {</span><br><span class="line">        name: <span class="keyword">this</span>.account,</span><br><span class="line">        password: <span class="keyword">this</span>.password</span><br><span class="line">      } </span><br><span class="line">      <span class="keyword">this</span>.$http.post(<span class="string">'/auth/user'</span>, obj) <span class="comment">// 将信息发送给后端</span></span><br><span class="line">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> { <span class="comment">// axios返回的数据都在res.data里</span></span><br><span class="line">          <span class="keyword">if</span>(res.data.success){ <span class="comment">// 如果成功</span></span><br><span class="line">            sessionStorage.setItem(<span class="string">'demo-token'</span>,res.data.token); <span class="comment">// 用sessionStorage把token存下来</span></span><br><span class="line">            <span class="keyword">this</span>.$message({ <span class="comment">// 登录成功，显示提示语</span></span><br><span class="line">              type: <span class="string">'success'</span>,</span><br><span class="line">              message: <span class="string">'登录成功！'</span></span><br><span class="line">            }); </span><br><span class="line">            <span class="keyword">this</span>.$router.push(<span class="string">'/todolist'</span>) <span class="comment">// 进入todolist页面，登录成功</span></span><br><span class="line">          }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">this</span>.$message.error(res.data.info); <span class="comment">// 登录失败，显示提示语</span></span><br><span class="line">            sessionStorage.setItem(<span class="string">'demo-token'</span>,<span class="literal">null</span>); <span class="comment">// 将token清空</span></span><br><span class="line">          }</span><br><span class="line">        }, (err) =&gt; {</span><br><span class="line">            <span class="keyword">this</span>.$message.error(<span class="string">'请求错误！'</span>)</span><br><span class="line">            sessionStorage.setItem(<span class="string">'demo-token'</span>,<span class="literal">null</span>); <span class="comment">// 将token清空</span></span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><h4 id="密码bcrypt加密"><a href="https://molunerfinn.com/Vue+Koa/#%E5%AF%86%E7%A0%81bcrypt%E5%8A%A0%E5%AF%86" class="headerlink" title="密码bcrypt加密"></a>密码bcrypt加密</h4><p>最早的时候我是在前端用了md5加密，但是后来经过提醒这种方式并不安全。md5加密的容易被破解。所以就采用了<code>bcrypt</code>的加密方式。全部走后端加密。也许你会问这样明文给后端发送密码安全吗？没问题，只要用上HTTPS，这将不是问题。</p><p><code>yarn add bcryptjs</code>安装bcryptjs。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllers/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">'../models/user.js'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'koa-jwt'</span>); <span class="comment">// 引入koa-jwt</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">'bcryptjs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserInfo = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id; <span class="comment">// 获取url里传过来的参数里的id</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> user.getUserById(id);  <span class="comment">// 通过yield “同步”地返回查询结果</span></span><br><span class="line">  <span class="keyword">this</span>.body = result <span class="comment">// 将请求的结果放到response的body里返回</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postUserAuth = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">this</span>.request.body; <span class="comment">// post过来的数据存在request.body里</span></span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="keyword">yield</span> user.getUserByName(data.name);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(userInfo != <span class="literal">null</span>){ <span class="comment">// 如果查无此用户会返回null</span></span><br><span class="line">    <span class="keyword">if</span>(!bcrypt.compareSync(data.password, userInfo.password)){ <span class="comment">// 验证密码是否正确</span></span><br><span class="line">      <span class="keyword">this</span>.body = {</span><br><span class="line">        success: <span class="literal">false</span>, <span class="comment">// success标志位是方便前端判断返回是正确与否</span></span><br><span class="line">        info: <span class="string">'密码错误！'</span></span><br><span class="line">      }</span><br><span class="line">    }<span class="keyword">else</span>{ <span class="comment">// 如果密码正确</span></span><br><span class="line">      <span class="keyword">const</span> userToken = {</span><br><span class="line">        name: userInfo.user_name,</span><br><span class="line">        id: userInfo.id</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">const</span> secret = <span class="string">'vue-koa-demo'</span>; <span class="comment">// 指定密钥，这是之后用来判断token合法性的标志</span></span><br><span class="line">      <span class="keyword">const</span> token = jwt.sign(userToken,secret); <span class="comment">// 签发token</span></span><br><span class="line">      <span class="keyword">this</span>.body = {</span><br><span class="line">        success: <span class="literal">true</span>,</span><br><span class="line">        token: token, <span class="comment">// 返回token</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }<span class="keyword">else</span>{</span><br><span class="line">    <span class="keyword">this</span>.body = {</span><br><span class="line">      success: <span class="literal">false</span>,</span><br><span class="line">      info: <span class="string">'用户不存在！'</span> <span class="comment">// 如果用户不存在返回用户不存在</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getUserInfo,</span><br><span class="line">  postUserAuth</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因为我们数据库里还是存着明文的<code>123</code>作为密码，现在要先将它bcrypt化，加密后变为：<code>$2a$10$x3f0Y2SNAmyAfqhKVAV.7uE7RHs3FDGuSYw.LlZhOFoyK7cjfZ.Q6</code>，将其替换掉数据库里的<code>123</code>。不做这步我们将无法登录。</p><p>还没有大功告成，因为我们的界面跑在<code>8080</code>端口，但是Koa提供的API跑在<code>8889</code>端口，所以如果直接通过<code>/auth/user</code>这个url去post是请求不到的。就算写成<code>localhost:8889/auth/user</code>也会因为跨域问题导致请求失败。</p><p>这个时候有两种最方便的解决办法：</p><ol><li>如果是跨域，服务端只要在请求头上加上<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener"><code>CORS</code></a>，客户端即可跨域发送请求。</li><li>变成同域，即可解决跨域请求问题。</li></ol><p>第一种也很方便，采用<a href="https://github.com/koajs/cors" target="_blank" rel="noopener"><code>kcors</code></a>即可解决。<br>不过为了之后部署方便，我们采用第二种，变成同域请求。</p><p>打开根目录下的<code>config/index.js</code>，找到<code>dev</code>下的<code>proxyTable</code>，利用这个<code>proxyTable</code>我们能够将外部的请求通过<code>webpack</code>转发给本地，也就能够将跨域请求变成同域请求了。</p><p>将<code>proxyTable</code>改写如下:</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> proxyTable: {</span><br><span class="line">  <span class="string">'/auth'</span>:{</span><br><span class="line">    target: <span class="string">'http://localhost:8889'</span>,</span><br><span class="line">    changeOrigin: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">'/api'</span>:{</span><br><span class="line">    target: <span class="string">'http://localhost:8889'</span>,</span><br><span class="line">    changeOrigin: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>上面的意思是，我们在组件里请求的地址如果是<code>/api/xxxx</code>实际上请求的是<code>http://localhost:8889/api/xxxx</code>，但是由于<code>webpack</code>帮我们代理了localhost的8889端口的服务，所以我们可以把实际是跨域的请求当做是同域下的接口来调用。</p><p>此时重新启动一下<code>webpack</code>：先<code>ctrl+c</code>退出当前进程，然后<code>npm run dev</code>。</p><p>一切都万事了之后，我们可以看到如下激动人心的画面：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-2.gif" data-fancybox="group" data-caption="login2todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-2.gif" alt="login2todolist" title="login2todolist"><div class="img-alt">login2todolist</div></a></p><h4 id="跳转拦截"><a href="https://molunerfinn.com/Vue+Koa/#%E8%B7%B3%E8%BD%AC%E6%8B%A6%E6%88%AA" class="headerlink" title="跳转拦截"></a>跳转拦截</h4><p>虽然我们现在能够成功登录系统了，但是还是存在一个问题：我在地址栏手动将地址改为<code>localhost:8080/todolist</code>我还是能够成功跳转到登录后的界面啊。于是这就需要一个跳转拦截，当没有登录的时候，不管地址栏输入什么地址，最终都重新定向回登录页。</p><p>这个时候，从后端给我们传回来的<code>token</code>就派上大用处。有<code>token</code>就说明我们的身份是经过验证的，否则就是非法的。</p><div class="google-auto-placed ap_container" style="text-align: center; width: 100%; height: auto; clear: none;"><ins data-ad-format="auto" class="adsbygoogle adsbygoogle-noablate" data-ad-client="ca-pub-2358465699478507" data-adsbygoogle-status="done" style="display: block; margin: auto; background-color: transparent;"><ins id="aswift_2_expand" style="display: inline-table; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 900px; background-color: transparent;"><ins id="aswift_2_anchor" style="display: block; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 900px; background-color: transparent; overflow: hidden; opacity: 0;"><iframe width="900" height="200" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;border:0px;width:900px;height:200px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource.html"></iframe></ins></ins></ins></div><p><code>vue-router</code>提供了页面跳转的钩子，我们可以在<code>router</code>跳转前进行验证，如果<code>token</code>存在就跳转，如果不存在就返回登录页。</p><p>参考路由的<a href="https://router.vuejs.org/zh-cn/advanced/navigation-guards.html" target="_blank" rel="noopener">导航钩子</a></p><p>打开<code>src/main.js</code>，修改如下：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter({....}) <span class="comment">// 省略</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>) =&gt;</span>{</span><br><span class="line">  <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">'demo-token'</span>);</span><br><span class="line">  <span class="keyword">if</span>(to.path == <span class="string">'/'</span>){ <span class="comment">// 如果是跳转到登录页的</span></span><br><span class="line">    <span class="keyword">if</span>(token != <span class="string">'null'</span> &amp;&amp; token != <span class="literal">null</span>){</span><br><span class="line">      next(<span class="string">'/todolist'</span>) <span class="comment">// 如果有token就转向todolist不返回登录页</span></span><br><span class="line">    }</span><br><span class="line">    next(); <span class="comment">// 否则跳转回登录页</span></span><br><span class="line">  }<span class="keyword">else</span>{</span><br><span class="line">    <span class="keyword">if</span>(token != <span class="string">'null'</span> &amp;&amp; token != <span class="literal">null</span>){</span><br><span class="line">      next() <span class="comment">// 如果有token就正常转向</span></span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">      next(<span class="string">'/'</span>) <span class="comment">// 否则跳转回登录页</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue({...}) <span class="comment">// 省略</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>注意：一定要确保要调用 <code>next()</code> 方法，否则钩子就不会被 resolved。</strong>如果纯粹调用<code>next(path)</code>这样的方法最终还是会回到<code>.beforeEach()</code>这个钩子里面来，如果没有写对条件就有可能出现死循环，栈溢出的情况。</p></blockquote><p>然后我们就可以看到如下效果：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-3.gif" data-fancybox="group" data-caption="login2todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-3.gif" alt="login2todolist" title="login2todolist"><div class="img-alt">login2todolist</div></a></p><blockquote><p>Tips：这种只判断token存不存在就通过的验证是很不安全的，此例只是做了一个演示，实际上还应该进行更深一层的判断，比如从token解包出来的信息里包含我们想要的信息才可以作为有效token，才可以登录。等等。本文只是做一个简要介绍。</p></blockquote><h4 id="解析token"><a href="https://molunerfinn.com/Vue+Koa/#%E8%A7%A3%E6%9E%90token" class="headerlink" title="解析token"></a>解析token</h4><p>注意到我们在签发<code>token</code>的时候，写过这样几句话：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// server/controllers/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userToken = {</span><br><span class="line">  name: userInfo.user_name,</span><br><span class="line">  id: userInfo.id</span><br><span class="line">}</span><br><span class="line"><span class="keyword">const</span> secret = <span class="string">'vue-koa-demo'</span>; <span class="comment">// 指定密钥，这是之后用来判断token合法性的标志</span></span><br><span class="line"><span class="keyword">const</span> token = jwt.sign(userToken,secret); <span class="comment">// 签发token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></tbody></table></figure><p>我们将用户名和id打包进JWT的主体部分，同时我们解密的密钥是<code>vue-koa-demo</code>。所以我们可以通过这个信息，来进行登录后的用户名显示，以及用来区别这个用户是谁，这个用户有哪些<code>Todolist</code>。</p><p>接下来在<code>Todolist</code>页面进行token解析，从而让用户名显示为登录用户名。</p><p><strong>注意：</strong> 前端直接暴露<code>secret-key</code>的做法其实并不安全。正确的做法应该是把token跟用户名和其他不是很重要的信息一起传过来，token只用于验证，而其他信息作为返回值正常返回。这样就不会暴露<code>secret-key</code>了。当然本文只是为了方便说明，给出的一个不恰当的获取用户信息的例子。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// src/components/TodoList.vue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jwt <span class="keyword">from</span> <span class="string">'jsonwebtoken'</span> <span class="comment">// 我们安装koa-jwt的时候会自动下载这个依赖</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> {</span><br><span class="line"></span><br><span class="line">  created(){ <span class="comment">// 组件创建时调用</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = <span class="keyword">this</span>.getUserInfo(); <span class="comment">// 新增一个获取用户信息的方法</span></span><br><span class="line">    <span class="keyword">if</span>(userInfo != <span class="literal">null</span>){</span><br><span class="line">      <span class="keyword">this</span>.id = userInfo.id;</span><br><span class="line">      <span class="keyword">this</span>.name = userInfo.name;</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">      <span class="keyword">this</span>.id = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">this</span>.name = <span class="string">''</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line"></span><br><span class="line">  data () {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      name: <span class="string">''</span>, <span class="comment">// 用户名改为空</span></span><br><span class="line">      todos: <span class="string">''</span>,</span><br><span class="line">      activeName: <span class="string">'first'</span>,</span><br><span class="line">      list:[],</span><br><span class="line">      count: <span class="number">0</span>,</span><br><span class="line">      id: <span class="string">''</span> <span class="comment">// 新增用户id属性，用于区别用户</span></span><br><span class="line">    };</span><br><span class="line">  },</span><br><span class="line">  computed: {...}, <span class="comment">//省略</span></span><br><span class="line"></span><br><span class="line">  methods: {</span><br><span class="line">    addTodos() {...}, <span class="comment">// 省略</span></span><br><span class="line">    finished(index) {...},</span><br><span class="line">    remove(index) {...},</span><br><span class="line">    restore(index) {...},</span><br><span class="line">    getUserInfo(){ <span class="comment">// 获取用户信息</span></span><br><span class="line">      <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">'demo-token'</span>);</span><br><span class="line">      <span class="keyword">if</span>(token != <span class="literal">null</span> &amp;&amp; token != <span class="string">'null'</span>){</span><br><span class="line">        <span class="keyword">let</span> decode = jwt.decode(token); <span class="comment">// 解析token</span></span><br><span class="line">        <span class="keyword">return</span> decode <span class="comment">// decode解析出来实际上就是{name: XXX,id: XXX}</span></span><br><span class="line">      }<span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></tbody></table></figure><p>于是你就可以看到：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist-1.png" data-fancybox="group" data-caption="todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist-1.png" alt="todolist" title="todolist"><div class="img-alt">todolist</div></a></p><p>用户名已经不是我们之前默认的<code>Molunerfinn</code>而是登录名<code>molunerfinn</code>了。</p><h2 id="Todolist-增删改查的实现"><a href="https://molunerfinn.com/Vue+Koa/#Todolist-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E7%9A%84%E5%AE%9E%E7%8E%B0" class="headerlink" title="Todolist 增删改查的实现"></a>Todolist 增删改查的实现</h2><p>这个部分就是前后端协作了。我们要实现之前在纯前端部分实现的内容。我以最基本的两个方法来举例子：获取<code>Todolist</code>以及增加<code>Todolist</code>，剩下其实思路大同小异，我就提供代码和注释了，我相信也很容易懂。</p><h3 id="Token的发送"><a href="https://molunerfinn.com/Vue+Koa/#Token%E7%9A%84%E5%8F%91%E9%80%81" class="headerlink" title="Token的发送"></a>Token的发送</h3><p>之前说了，用JSON-WEB-TOKEN之后，这个系统的验证就完全依靠token了。如果token正确就下发资源，如果资源不正确，就返回错误信息。</p><p>因为我们用了<code>koa-jwt</code>，所以只需要在每条请求头上加上<code>Authorization</code>属性，值是<code>Bearer {token值}</code>，然后让<code>Koa</code>在接收请求之前验证一下token即可。但是如果每发一条请求就要手动写一句这个，太累了。于是我们可以做到全局<code>Header</code>设定。</p><p>打开<code>src/main.js</code>，在路由跳转的钩子里加上这句：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// scr/main.json</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>) =&gt;</span>{</span><br><span class="line">  <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">'demo-token'</span>);</span><br><span class="line">  <span class="keyword">if</span>(to.path == <span class="string">'/'</span>){ </span><br><span class="line">    <span class="keyword">if</span>(token != <span class="string">'null'</span> &amp;&amp; token != <span class="literal">null</span>){</span><br><span class="line">      next(<span class="string">'/todolist'</span>) </span><br><span class="line">    }</span><br><span class="line">    next(); </span><br><span class="line">  }<span class="keyword">else</span>{</span><br><span class="line">    <span class="keyword">if</span>(token != <span class="string">'null'</span> &amp;&amp; token != <span class="literal">null</span>){</span><br><span class="line">      Vue.prototype.$http.defaults.headers.common[<span class="string">'Authorization'</span>] = <span class="string">'Bearer '</span> + token; <span class="comment">// 全局设定header的token验证，注意Bearer后有个空格</span></span><br><span class="line">      next() </span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">      next(<span class="string">'/'</span>) </span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><p>这样就完成了token的客户端发送设定。</p><h3 id="Koa端对Token的验证"><a href="https://molunerfinn.com/Vue+Koa/#Koa%E7%AB%AF%E5%AF%B9Token%E7%9A%84%E9%AA%8C%E8%AF%81" class="headerlink" title="Koa端对Token的验证"></a>Koa端对Token的验证</h3><p>接着我们实现两个简单的api，这两个api请求的路径就不是<code>/auth/xxx</code>而是<code>/api/xxx</code>了。我们还需要实现，访问<code>/api/*</code>路径的请求都需要经过<code>koa-jwt</code>的验证，而<code>/auth/*</code>的请求不需要。</p><p>首先去<code>models</code>目录下新建一个<code>todolist.js</code>的文件：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// server/models/todolist.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'../config/db.js'</span>), </span><br><span class="line">      todoModel = <span class="string">'../schema/list.js'</span>; <span class="comment">// 引入todolist的表结构</span></span><br><span class="line"><span class="keyword">const</span> TodolistDb = db.Todolist; <span class="comment">// 引入数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Todolist = TodolistDb.import(todoModel); </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getTodolistById = <span class="function"><span class="keyword">function</span>* (<span class="params">id</span>)</span>{  <span class="comment">// 获取某个用户的全部todolist</span></span><br><span class="line">  <span class="keyword">const</span> todolist = <span class="keyword">yield</span> Todolist.findAll({ <span class="comment">// 查找全部的todolist</span></span><br><span class="line">    where: {</span><br><span class="line">      user_id: id</span><br><span class="line">    },</span><br><span class="line">    attributes: [<span class="string">'id'</span>,<span class="string">'content'</span>,<span class="string">'status'</span>] <span class="comment">// 只需返回这三个字段的结果即可</span></span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> todolist <span class="comment">// 返回数据</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params">data</span>)</span>{ <span class="comment">// 给某个用户创建一条todolist</span></span><br><span class="line">  <span class="keyword">yield</span> Todolist.create({</span><br><span class="line">    user_id: data.id, <span class="comment">// 用户的id，用来确定给哪个用户创建</span></span><br><span class="line">    content: data.content,</span><br><span class="line">    status: data.status </span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getTodolistById,</span><br><span class="line">  createTodolist</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>接着去<code>controllers</code>目录下新建一个<code>todolist.js</code>的文件：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server/controllers/todolist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todolist = <span class="built_in">require</span>(<span class="string">'../models/todolist.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{ <span class="comment">// 获取某个用户的所有todolist</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id; <span class="comment">// 获取url里传过来的参数里的id</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> todolist.getTodolistById(id);  <span class="comment">// 通过yield “同步”地返回查询结果</span></span><br><span class="line">  <span class="keyword">this</span>.body = result <span class="comment">// 将请求的结果放到response的body里返回</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{ <span class="comment">// 给某个用户创建一条todolist</span></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">this</span>.request.body; <span class="comment">// post请求，数据是在request.body里的</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> todolist.createTodolist(data);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.body = {</span><br><span class="line">    success: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getTodolist,</span><br><span class="line">  createTodolist</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后去<code>routes</code>文件夹里新建一个<code>api.js</code>文件：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// server/routes/api.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todolist = <span class="built_in">require</span>(<span class="string">'../controllers/todolist.js'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line"></span><br><span class="line">todolist(router); <span class="comment">// 引入koa-router</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router; <span class="comment">// 导出router规则</span></span><br></pre></td></tr></tbody></table></figure><p>最后，去根目录下的<code>app.js</code>，给koa加上新的路由规则：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>)()</span><br><span class="line">  , koa = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)()</span><br><span class="line">  , json = <span class="built_in">require</span>(<span class="string">'koa-json'</span>)</span><br><span class="line">  , logger = <span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</span><br><span class="line">  , auth = <span class="built_in">require</span>(<span class="string">'./server/routes/auth.js'</span>)</span><br><span class="line">  , api = <span class="built_in">require</span>(<span class="string">'./server/routes/api.js'</span>)</span><br><span class="line">  , jwt = <span class="built_in">require</span>(<span class="string">'koa-jwt'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..... 省略</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>* (<span class="params">next</span>)</span>{</span><br><span class="line">  <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>;</span><br><span class="line">  <span class="keyword">yield</span> next;</span><br><span class="line">  <span class="keyword">let</span> ms = <span class="keyword">new</span> <span class="built_in">Date</span> - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'%s %s - %s'</span>, <span class="keyword">this</span>.method, <span class="keyword">this</span>.url, ms);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>)</span>{  <span class="comment">//  如果JWT验证失败，返回验证失败信息</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">yield</span> next;</span><br><span class="line">  } <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">401</span> == err.status) {</span><br><span class="line">      <span class="keyword">this</span>.status = <span class="number">401</span>;</span><br><span class="line">      <span class="keyword">this</span>.body = {</span><br><span class="line">        success: <span class="literal">false</span>,</span><br><span class="line">        token: <span class="literal">null</span>,</span><br><span class="line">        info: <span class="string">'Protected resource, use Authorization header to get access'</span></span><br><span class="line">      };</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, ctx</span>)</span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server error'</span>, err);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">koa.use(<span class="string">'/auth'</span>, auth.routes()); <span class="comment">// 挂载到koa-router上，同时会让所有的auth的请求路径前面加上'/auth'的请求路径。</span></span><br><span class="line">koa.use(<span class="string">"/api"</span>,jwt({<span class="attr">secret</span>: <span class="string">'vue-koa-demo'</span>}),api.routes()) <span class="comment">// 所有走/api/打头的请求都需要经过jwt中间件的验证。secret密钥必须跟我们当初签发的secret一致</span></span><br><span class="line"></span><br><span class="line">app.use(koa.routes()); <span class="comment">// 将路由规则挂载到Koa上。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...省略</span></span><br></pre></td></tr></tbody></table></figure><p>至此，后端的两个api已经构建完成。</p><p>初始化配置相对复杂一些，涉及到<code>model</code>、<code>controllers</code>、<code>routes</code>和<code>app.js</code>，可能会让人望而却步。实际上第一次构建完成之后，后续要添加api，基本上只需要在<code>model</code>和<code>controllers</code>写好方法，定好接口即可，十分方便。</p><h3 id="前端对接接口"><a href="https://molunerfinn.com/Vue+Koa/#%E5%89%8D%E7%AB%AF%E5%AF%B9%E6%8E%A5%E6%8E%A5%E5%8F%A3" class="headerlink" title="前端对接接口"></a>前端对接接口</h3><p>后端接口已经开放，接下来要把前端和后端进行对接。主要有两个对接接口：</p><ol><li>获取某个用户的所有todolist</li><li>创建某个用户的一条todolist</li></ol><p>接下来就是改写<code>Todolist.vue</code>里的方法了：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// todolist.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"></span><br><span class="line">created(){</span><br><span class="line">  <span class="keyword">const</span> userInfo = <span class="keyword">this</span>.getUserInfo();</span><br><span class="line">  <span class="keyword">if</span>(userInfo != <span class="literal">null</span>){</span><br><span class="line">    <span class="keyword">this</span>.id = userInfo.id;</span><br><span class="line">    <span class="keyword">this</span>.name = userInfo.name;</span><br><span class="line">  }<span class="keyword">else</span>{</span><br><span class="line">    <span class="keyword">this</span>.id = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">''</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">this</span>.getTodolist(); <span class="comment">// 新增：在组件创建时获取todolist</span></span><br><span class="line">},</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"></span><br><span class="line">methods: {</span><br><span class="line">  addTodos() {</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.todos == <span class="string">''</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> obj = {</span><br><span class="line">      status: <span class="literal">false</span>,</span><br><span class="line">      content: <span class="keyword">this</span>.todos,</span><br><span class="line">      id: <span class="keyword">this</span>.id</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">this</span>.$http.post(<span class="string">'/api/todolist'</span>, obj) <span class="comment">// 新增创建请求</span></span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span>(res.status == <span class="number">200</span>){ <span class="comment">// 当返回的状态为200成功时</span></span><br><span class="line">          <span class="keyword">this</span>.$message({</span><br><span class="line">            type: <span class="string">'success'</span>,</span><br><span class="line">            message: <span class="string">'创建成功！'</span> </span><br><span class="line">          })</span><br><span class="line">          <span class="keyword">this</span>.getTodolist(); <span class="comment">// 获得最新的todolist</span></span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">          <span class="keyword">this</span>.$message.error(<span class="string">'创建失败！'</span>) <span class="comment">// 当返回不是200说明处理出问题</span></span><br><span class="line">        }</span><br><span class="line">      }, (err) =&gt; {</span><br><span class="line">        <span class="keyword">this</span>.$message.error(<span class="string">'创建失败！'</span>) <span class="comment">// 当没有返回值说明服务端错误或者请求没发送出去</span></span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      })</span><br><span class="line">    <span class="keyword">this</span>.todos = <span class="string">''</span>; <span class="comment">// 将当前todos清空</span></span><br><span class="line">  },</span><br><span class="line">  <span class="comment">// ... 省略一些方法</span></span><br><span class="line">  getTodolist(){</span><br><span class="line">    <span class="keyword">this</span>.$http.get(<span class="string">'/api/todolist/'</span> + <span class="keyword">this</span>.id) <span class="comment">// 向后端发送获取todolist的请求</span></span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span>(res.status == <span class="number">200</span>){</span><br><span class="line">          <span class="keyword">this</span>.list = res.data <span class="comment">// 将获取的信息塞入实例里的list</span></span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">          <span class="keyword">this</span>.$message.error(<span class="string">'获取列表失败！'</span>)</span><br><span class="line">        }</span><br><span class="line">      }, (err) =&gt; {</span><br><span class="line">        <span class="keyword">this</span>.$message.error(<span class="string">'获取列表失败！'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>至此，前后端的部分已经完整构建。让我们来看看效果：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-4.gif" data-fancybox="group" data-caption="todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/login2todolist-4.gif" alt="todolist" title="todolist"><div class="img-alt">todolist</div></a></p><p>做到这一步的时候其实我们的应用已经基本完成了。最后的收尾工作，让我们来收一下。</p><p>原本的前端版本还有<code>完成</code>、<code>删除</code>、<code>还原</code>三种状态，其中<code>完成</code>和<code>还原</code>只是状态的切换（更新），所以可以算是一个api，然后就是删除是单独一个api。于是我们就能算是完成了增、删、改、查了。接下去的部分就提供代码就行，其实思路跟之前的是一样的，只不过操作的函数不一样罢了。</p><h3 id="Todolist的改、删"><a href="https://molunerfinn.com/Vue+Koa/#Todolist%E7%9A%84%E6%94%B9%E3%80%81%E5%88%A0" class="headerlink" title="Todolist的改、删"></a>Todolist的改、删</h3><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// server/models/todolist.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params">id,user_id</span>)</span>{</span><br><span class="line">  <span class="keyword">yield</span> Todolist.destroy({</span><br><span class="line">    where: {</span><br><span class="line">      id,</span><br><span class="line">      user_id</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params">id,user_id,status</span>)</span>{</span><br><span class="line">  <span class="keyword">yield</span> Todolist.update(</span><br><span class="line">    {</span><br><span class="line">      status</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      where: {</span><br><span class="line">        id,</span><br><span class="line">        user_id</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  getTodolistById,</span><br><span class="line">  createTodolist,</span><br><span class="line">  removeTodolist,</span><br><span class="line">  updateTodolist</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// server/controllers/todolist.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id;</span><br><span class="line">  <span class="keyword">const</span> user_id = <span class="keyword">this</span>.params.userId;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> todolist.removeTodolist(id,user_id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.body = {</span><br><span class="line">    success: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateTodolist = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>{</span><br><span class="line">  <span class="keyword">const</span> id = <span class="keyword">this</span>.params.id;</span><br><span class="line">  <span class="keyword">const</span> user_id = <span class="keyword">this</span>.params.userId;</span><br><span class="line">  <span class="keyword">let</span> status = <span class="keyword">this</span>.params.status; </span><br><span class="line">  status == <span class="string">'0'</span> ? status = <span class="literal">true</span> : status =  <span class="literal">false</span>;<span class="comment">// 状态反转（更新）</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> todolist.updateTodolist(id,user_id,status);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.body = {</span><br><span class="line">    success: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">router</span>) =&gt;</span> {</span><br><span class="line">  getTodolist,</span><br><span class="line">  createTodolist,</span><br><span class="line">  removeTodolist,</span><br><span class="line">  updateTodolist</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight html"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- src/components/TodoList.vue --&gt;</span></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 把完成和还原的方法替换成了update --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"update(index)"</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"update(index)"</span>&gt;</span>还原<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// ....省略</span></span></span><br><span class="line"><span class="undefined">  methods:{</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ... 省略</span></span></span><br><span class="line"><span class="undefined">    update(index) {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$http.put(<span class="string">'/api/todolist/'</span>+ <span class="keyword">this</span>.id + <span class="string">'/'</span> + <span class="keyword">this</span>.list[index].id + <span class="string">'/'</span> + <span class="keyword">this</span>.list[index].status)</span></span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span>(res.status == <span class="number">200</span>){</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$message({</span></span><br><span class="line"><span class="javascript">              type: <span class="string">'success'</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">'任务状态更新成功！'</span></span></span><br><span class="line"><span class="undefined">            })</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.getTodolist();</span></span><br><span class="line"><span class="javascript">          }<span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$message.error(<span class="string">'任务状态更新失败！'</span>)</span></span><br><span class="line"><span class="undefined">          }</span></span><br><span class="line"><span class="undefined">        }, (err) =&gt; {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.$message.error(<span class="string">'任务状态更新失败！'</span>)</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(err)</span></span><br><span class="line"><span class="undefined">        })</span></span><br><span class="line"><span class="undefined">    },</span></span><br><span class="line"><span class="undefined">    remove(index) {</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$http.delete(<span class="string">'/api/todolist/'</span>+ <span class="keyword">this</span>.id + <span class="string">'/'</span> + <span class="keyword">this</span>.list[index].id)</span></span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span>(res.status == <span class="number">200</span>){</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$message({</span></span><br><span class="line"><span class="javascript">              type: <span class="string">'success'</span>,</span></span><br><span class="line"><span class="javascript">              message: <span class="string">'任务删除成功！'</span></span></span><br><span class="line"><span class="undefined">            })</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.getTodolist();</span></span><br><span class="line"><span class="javascript">          }<span class="keyword">else</span>{</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$message.error(<span class="string">'任务删除失败！'</span>)</span></span><br><span class="line"><span class="undefined">          }</span></span><br><span class="line"><span class="undefined">        }, (err) =&gt; {</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.$message.error(<span class="string">'任务删除失败！'</span>)</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(err)</span></span><br><span class="line"><span class="undefined">        })</span></span><br><span class="line"><span class="undefined">    },</span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="javascript"><span class="comment">// ... 省略</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">....</span><br></pre></td></tr></tbody></table></figure><p>让我们来看看最后99%成品的效果吧：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist-5.gif" data-fancybox="group" data-caption="Todolist" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/todolist-5.gif" alt="Todolist" title="todolist"><div class="img-alt">Todolist</div></a></p><h2 id="项目部署"><a href="https://molunerfinn.com/Vue+Koa/#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2" class="headerlink" title="项目部署"></a>项目部署</h2><p>很多教程到类似于我上面的部分就结束了。但是实际上我们做一个项目最想要的就是部署给大家用不是么？</p><p>在部署这块有些坑，需要让大家也一起知道一下。这个项目是个全栈项目（虽然是个很简单的。。。），所以就涉及到前后端通信的问题，也就会涉及到是同域请求还是跨域请求。</p><p>我们也说过，要解决这个问题有两种方便的解决办法，第一种，服务端加上<code>cors</code>，客户端就可以随意的跨域请求。但是这样会有个问题，因为我们是以同域的形式开发，请求的地址也是写的相对地址：<code>/api/*</code>、<code>auth/*</code>这样的路径，访问的路径的自然是同域。如果要在服务端加上<code>cors</code>，我们还需要将我们的所有请求地址改成<code>localhost:8889/api/*</code>，<code>localhost:8889/auth/*</code>，这样的话，如果服务端的端口号一变，我们还需要重新修改前端所有的请求地址。这样很不方便也很不科学。</p><p>因此，要将请求变为同域才是最好的解决办法——不管服务端端口号怎么变，只要是同域都可以请求到。</p><p>于是要把Vue和Koa结合起来变成一个完整的项目（之前实际上都是在开发模式下，webpack帮我们进行请求的代理转发，所以看起来像是同域请求，而Vue和Koa并没有完全结合起来），就得在生产模式下，将Vue的静态文件交给Koa“托管”，所有访问前端的请求全部走Koa端，包括静态文件资源的请求，也走Koa端，把Koa作为一个Vue项目的静态资源服务器，这样就可以让Vue里的请求走的都是同域了。（相当于，之前开发模式是webpack开启了一个服务器托管了Vue的资源和请求，现在生产模式下改成Koa托管Vue的资源和请求）</p><p>要在开发和生产模式改变不同的托管服务器，其实也很简单，只需要在生产模式下，用Koa的静态资源服务中间件托管构建好的Vue文件即可。</p><h3 id="Webpack打包"><a href="https://molunerfinn.com/Vue+Koa/#Webpack%E6%89%93%E5%8C%85" class="headerlink" title="Webpack打包"></a>Webpack打包</h3><p>部署之前我们要用Webpack将我们的前端项目打包输出一下。但是如果直接用<code>npm run build</code>，你会发现打包出来的文件太大了：</p><figure class="highlight bash"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                                                  Asset       Size  Chunks             Chunk Names</span><br><span class="line">    static/css/app.d9034fc06fd57ce00d6e75ed49f0dafe.css     120 kB    2, 0  [emitted]  app</span><br><span class="line">                 static/fonts/element-icons.a61be9c.eot    13.5 kB          [emitted]</span><br><span class="line">                   static/img/element-icons.09162bc.svg    17.4 kB          [emitted]</span><br><span class="line">             static/js/manifest.8ea250834bdc80e4d73b.js  832 bytes       0  [emitted]  manifest</span><br><span class="line">               static/js/vendor.75bbe7ecea37b0d4c62d.js     623 kB    1, 0  [emitted]  vendor</span><br><span class="line">                  static/js/app.e2d125562bfc4c57f9cb.js    16.5 kB    2, 0  [emitted]  app</span><br><span class="line">                 static/fonts/element-icons.b02bdc1.ttf    13.2 kB          [emitted]</span><br><span class="line">         static/js/manifest.8ea250834bdc80e4d73b.js.map    8.86 kB       0  [emitted]  manifest</span><br><span class="line">           static/js/vendor.75bbe7ecea37b0d4c62d.js.map    3.94 MB    1, 0  [emitted]  vendor</span><br><span class="line">              static/js/app.e2d125562bfc4c57f9cb.js.map    64.8 kB    2, 0  [emitted]  app</span><br><span class="line">static/css/app.d9034fc06fd57ce00d6e75ed49f0dafe.css.map     151 kB    2, 0  [emitted]  app</span><br><span class="line">                                             index.html  563 bytes          [emitted]</span><br></pre></td></tr></tbody></table></figure><p>竟然有3.94MB的map文件。这肯定是不能接受的。于是要修改一下webpack的输出的设置，取消输出map文件。</p><p>找到根目录下的<code>config/index.js</code>：把<code>productionSourceMap: true</code>这句话改成<code>productionSourceMap: false</code>。然后再执行一遍<code>npm run build</code>。</p><figure class="highlight bash"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                                              Asset       Size  Chunks             Chunk Names</span><br><span class="line">             static/fonts/element-icons.a61be9c.eot    13.5 kB          [emitted]</span><br><span class="line">             static/fonts/element-icons.b02bdc1.ttf    13.2 kB          [emitted]</span><br><span class="line">               static/img/element-icons.09162bc.svg    17.4 kB          [emitted]</span><br><span class="line">         static/js/manifest.3ba218c80028a707a728.js  774 bytes       0  [emitted]  manifest</span><br><span class="line">           static/js/vendor.75bbe7ecea37b0d4c62d.js     623 kB    1, 0  [emitted]  vendor</span><br><span class="line">              static/js/app.b6acaca2531fc0baa447.js    16.5 kB    2, 0  [emitted]  app</span><br><span class="line">static/css/app.d9034fc06fd57ce00d6e75ed49f0dafe.css     120 kB    2, 0  [emitted]  app</span><br><span class="line">                                         index.html  563 bytes          [emitted]</span><br></pre></td></tr></tbody></table></figure><p>把sourceMap去掉了之后，体积就小下来了。虽然600+kb的大小还是有点大，不过放到服务端，gzip之后只剩150+kb的体积勉强还是可以接受。当然，对于webpack输出的优化，不是本文讨论的范围，有很多更好的文章讲述了这个东西，故本文不再详细展开。</p><p>打包好后就是相当于输出了一堆静态文件，当然这堆静态文件需要放在服务端才可以访问。我们要将这堆静态资源用Koa托管。</p><h3 id="Koa-serve静态资源"><a href="https://molunerfinn.com/Vue+Koa/#Koa-serve%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90" class="headerlink" title="Koa serve静态资源"></a>Koa serve静态资源</h3><p><code>yarn add koa-static</code></p><p>打开<code>app.js</code>，引入两个新依赖，其中<code>path</code>是nodejs原生自带。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .... </span></span><br><span class="line"><span class="keyword">const</span> path =<span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line">    , serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态文件serve在koa-router的其他规则之上 </span></span><br><span class="line">app.use(serve(path.resolve(<span class="string">'dist'</span>))); <span class="comment">// 将webpack打包好的项目目录作为Koa静态文件服务的目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面这些是之前就有的。。。为了方便找位置故标示出来</span></span><br><span class="line">koa.use(<span class="string">'/auth'</span>, auth.routes());</span><br><span class="line">koa.use(<span class="string">"/api"</span>,jwt({<span class="attr">secret</span>: <span class="string">'vue-koa-demo'</span>}),api.routes()) </span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></tbody></table></figure><p>然后重新运行一遍<code>node app.js</code>，看到输出<code>Koa is listening in 8889</code>后，你可以打开浏览器<code>localhost:8889</code>就可以看到如下情景：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/vue-koa.png" data-fancybox="group" data-caption="vue-koa" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/vue-koa.png" alt="vue-koa"><div class="img-alt">vue-koa</div></a></p><p>至此已经基本上接近尾声，不过还存在一个问题：如果我们登录进去之后，在todolist页面一刷新，就会出现：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/404.png" data-fancybox="group" data-caption="404" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/404.png" alt="404" title="404"><div class="img-alt">404</div></a></p><p>为什么会出现这种情况？简单来说是因为我们使用了前端路由，用了HTML5 的History模式，如果没有做其他任何配置的话，刷新页面，那么浏览器将会去服务端访问这个页面地址，因为服务端并没有配置这个地址的路由，所以自然就返回404 Not Found了。</p><p>详细可以参考vue-router的<a href="https://router.vuejs.org/zh-cn/essentials/history-mode.html" target="_blank" rel="noopener">这篇文档</a></p><p>该怎么解决？其实也很简单，多加一个中间件：<code>koa-history-api-fallback</code>即可.</p><p><code>yarn add koa-history-api-fallback</code></p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//... 省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> historyApiFallback = <span class="built_in">require</span>(<span class="string">'koa-history-api-fallback'</span>); <span class="comment">// 引入依赖</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)());</span><br><span class="line">app.use(json());</span><br><span class="line">app.use(logger());</span><br><span class="line">app.use(historyApiFallback()); <span class="comment">// 在这个地方加入。一定要加在静态文件的serve之前，否则会失效。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></tbody></table></figure><p>这个时候，你再重新启动一下koa，登录之后再刷新页面，就不会再出现404 Not Found了。</p><h3 id="API-Test-1"><a href="https://molunerfinn.com/Vue+Koa/#API-Test-1" class="headerlink" title="API Test"></a>API Test</h3><p>本来写到上面基本本文已经算是结束了。但是由于我在开发的过程中遇到了一些问题，所以还需要做一些微调。</p><p>我们知道koa的use方法是有顺序只差的。</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line">app.use(A);</span><br><span class="line">app.use(B);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line">app.use(B);</span><br><span class="line">app.use(A);</span><br></pre></td></tr></tbody></table></figure><p>这二者是有区别的，谁先被use，谁的规则就放到前面先执行。</p><p>因此如果我们将静态文件的serve以及<code>historyApiFallback</code>放在了api的请求之前，那么用postman测试api的时候总会先返回完整的页面：</p><p><a href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/postman.png" data-fancybox="group" data-caption="postman" class="fancybox"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/postman.png" alt="postman"><div class="img-alt">postman</div></a></p><p>因此正确的做法，应该是将它们放到我们写的api的规则之后：</p><figure class="highlight js"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">koa.use(<span class="string">'/auth'</span>, auth.routes()); <span class="comment">// 挂载到koa-router上，同时会让所有的auth的请求路径前面加上'/auth'的请求路径。</span></span><br><span class="line">koa.use(<span class="string">"/api"</span>,jwt({<span class="attr">secret</span>: <span class="string">'vue-koa-demo'</span>}),api.routes()) <span class="comment">// 所有走/api/打头的请求都需要经过jwt验证。</span></span><br><span class="line"></span><br><span class="line">app.use(koa.routes()); <span class="comment">// 将路由规则挂载到Koa上。</span></span><br><span class="line"></span><br><span class="line">app.use(historyApiFallback()); <span class="comment">// 将这两个中间件挂载在api的路由之后</span></span><br><span class="line">app.use(serve(path.resolve(<span class="string">'dist'</span>))); <span class="comment">// 将webpack打包好的项目目录作为Koa静态文件服务的目录</span></span><br></pre></td></tr></tbody></table></figure><p>这样就能正常返回数据了。</p><h3 id="Nginx配置"><a href="https://molunerfinn.com/Vue+Koa/#Nginx%E9%85%8D%E7%BD%AE" class="headerlink" title="Nginx配置"></a>Nginx配置</h3><p>真正部署到服务器的时候，我们肯定不会让大家输入<code>域名:8889</code>这样的方式让大家访问。所以需要用Nginx监听80端口，把访问我们指定域名的请求引导转发给Koa服务端。</p><p>大致的<code>nginx.conf</code>如下：</p><figure class="highlight nginx"><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> {</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="attribute">upstream</span> koa.server{</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8889</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="section">server</span> {</span><br><span class="line">    <span class="attribute">listen</span>   <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> xxx.xxx.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / {</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://koa.server;</span><br><span class="line">      <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">#....</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">#....</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>如果有精力还可以配置一下Nginx的Gzip，能让请求的JS\CSS\HTML等静态文件更小，响应速度更快些。</p><h2 id="写在最后" class=""><a href="https://molunerfinn.com/Vue+Koa/#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E" class="headerlink" title="写在最后"></a>写在最后</h2><p>至此，我们已经完成了一个从前端到后端，从本地到服务器的完整项目。虽然它真的是个很简单的小东西，被大家也已经用其他的方式写烂了（比如用localStorage做存储）。但是它作为一个完整的前后端的DEMO，我觉得让大家入门也相对更容易一些，能够体会到全栈开发也不是想象中的“那么难”（入门的难度还是可以接受的嘛）。有了Nodejs之后我们能够做的事真的好多！</p><p>当然，由于篇幅有限，本文能够讲述东西毕竟不够多，而且讲的东西也不可能面面俱到，很多东西都是点到即止，让大家能够自己发挥。其实还想讲讲<code>Event Bus</code>的简单使用，还有分页的基本实现等等，东西太多了，一时间大家消化不了。</p><div class="google-auto-placed ap_container" style="text-align: center; width: 100%; height: auto; clear: none;"><ins data-ad-format="auto" class="adsbygoogle adsbygoogle-noablate" data-ad-client="ca-pub-2358465699478507" data-adsbygoogle-status="done" style="display: block; margin: auto; background-color: transparent;"><ins id="aswift_3_expand" style="display: inline-table; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 900px; background-color: transparent;"><ins id="aswift_3_anchor" style="display: block; border: none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 900px; background-color: transparent; overflow: hidden; opacity: 0;"><iframe width="900" height="200" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;border:0px;width:900px;height:200px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(2).html"></iframe></ins></ins></ins></div><p>实际上我在做前段时间的项目的时候，也是完全不知道怎么把Vue和Koa结合起来开发。我甚至不知道怎么用Koa来提供API，我只会用Koa来做服务端渲染，比如那些JADE\EJS等模板引擎渲染的页面。所以之前那个项目做完让我自己学到良多东西，故而也分享给大家。</p><p>实际上本文的Koa的api提供的形式也尽量和RESTful靠拢了，因此你也可以学会如何通过Koa提供RESTful形式的API了。</p><p>最后放上本文项目的Github<a href="https://github.com/Molunerfinn/vue-koa-demo" target="_blank" rel="noopener">地址</a>，如果这个项目对你有帮助，希望大家可以fork，给我提建议，如果再有时间，可以点个Star那就更好啦~</p><p>另外，本文的版本是用Koa1写成的。仓库已经更新Koa2。从Koa1-&gt;Koa2并没有什么难度，其实很关键的两点是：</p><ol><li>用<code>async await</code>替代<code>yield generation</code></li><li>用<code>koa2</code>的中间件替代<code>koa1</code>的中间件，原因同上一条</li></ol><p>互相学习，如果能从这个项目里学到东西我就很开心啦~</p><blockquote><p>注： 转载需经过同意，必须署名</p></blockquote></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Molunerfinn</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://molunerfinn.com/Vue+Koa/">https://molunerfinn.com/Vue+Koa/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="https://molunerfinn.com/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="https://molunerfinn.com/tags/Vue/">Vue</a><a class="post-meta__tags" href="https://molunerfinn.com/tags/Nodejs/">Nodejs</a><a class="post-meta__tags" href="https://molunerfinn.com/tags/Koa/">Koa</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/8700af19ly1fjmba1eumhj20jz0jzq4b.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/8700af19ly1fjmbbmp7uwj20jm0jmt9a.jpg"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="addthis_inline_share_toolbox pull-right" data-url="https://molunerfinn.com/Vue+Koa/#API-Test" data-title="全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） | MARKSZのBlog" style="clear: both;"><div id="atstbx" class="at-resp-share-element at-style-responsive addthis-smartlayers addthis-animated at4-show" aria-labelledby="at-0819dfed-72cf-4586-a679-7ef4c2297ea0" role="region"><span id="at-0819dfed-72cf-4586-a679-7ef4c2297ea0" class="at4-visually-hidden">AddThis Sharing Buttons</span><div class="at-share-btn-elements"><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-sinaweibo" style="background-color: rgb(230, 22, 45); border-radius: 0px;"><span class="at4-visually-hidden">Share to Sina Weibo</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-sinaweibo-1" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-sinaweibo"><title id="at-svg-sinaweibo-1">Sina Weibo</title><g><g fill-rule="evenodd"></g><path d="M14.24 23.808c-3.64.367-6.785-1.307-7.022-3.734-.236-2.43 2.525-4.693 6.164-5.06 3.642-.367 6.786 1.307 7.02 3.734.24 2.43-2.522 4.696-6.16 5.06m7.28-8.063c-.31-.096-.523-.157-.362-.57.352-.898.39-1.672.006-2.227-.713-1.036-2.667-.98-4.907-.028 0 0-.705.312-.523-.253.343-1.125.29-2.065-.243-2.61-1.214-1.238-4.446.045-7.216 2.86C6.205 15.023 5 17.26 5 19.192c0 3.694 4.664 5.942 9.226 5.942 5.98 0 9.96-3.53 9.96-6.333.003-1.695-1.402-2.657-2.665-3.055M25.494 8.983a5.76 5.76 0 0 0-5.542-1.823.855.855 0 0 0-.646 1.015.84.84 0 0 0 1 .657c1.398-.303 2.912.138 3.938 1.295a4.254 4.254 0 0 1 .865 4.113c-.144.45.1.93.542 1.076a.84.84 0 0 0 1.06-.55v-.002a5.973 5.973 0 0 0-1.218-5.78"></path><path d="M23.276 11.018a2.8 2.8 0 0 0-2.698-.885.74.74 0 0 0-.56.876c.086.396.472.65.86.563.467-.102.977.046 1.32.432.343.388.437.915.29 1.378a.742.742 0 0 0 .466.928.724.724 0 0 0 .913-.474c.3-.947.113-2.026-.59-2.818M14.44 19.41c-.126.223-.408.328-.627.235-.218-.09-.285-.34-.16-.555.127-.215.397-.32.612-.234.22.08.298.33.176.555m-1.16 1.512c-.353.57-1.11.82-1.676.558-.56-.26-.726-.922-.374-1.48.35-.555 1.078-.802 1.642-.56.57.25.753.905.407 1.482m1.322-4.04c-1.733-.46-3.69.42-4.443 1.97-.77 1.583-.025 3.34 1.723 3.914 1.815.595 3.95-.318 4.695-2.023.734-1.67-.182-3.39-1.976-3.86"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-qzone" style="background-color: rgb(9, 133, 221); border-radius: 0px;"><span class="at4-visually-hidden">Share to Qzone</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-qzone-2" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-qzone"><title id="at-svg-qzone-2">Qzone</title><g><path d="M24.307 19.276c.876-.158.442-.484.084-.442-.65.067-1.575.075-2.593.05l.118.693a25.58 25.58 0 0 0 2.392-.3zm2.686-6.814a.206.206 0 0 0-.175-.142l-7.34-1.067-3.285-6.647c-.075-.14-.31-.14-.384 0l-3.286 6.647-7.34 1.067a.208.208 0 0 0-.174.142.214.214 0 0 0 .058.217l5.312 5.178-1.25 7.305a.205.205 0 0 0 .083.21c.066.05.15.057.225.015l6.57-3.444 6.565 3.453.1.025.125-.042c.067-.05.1-.125.083-.208l-.958-5.596c-1.06.084-2.118.124-2.977.124-3.01 0-5.262-.142-5.296-.142a.642.642 0 0 1-.576-.458.633.633 0 0 1 .233-.692l6.055-4.404c-3.894-.308-7.163-.25-7.196-.25-.526.025-1-.142.025-.56.176-.066 4.254-.924 8.974-.29.26.033.468.224.535.475a.647.647 0 0 1-.244.674l-5.92 4.303c1.084.226 3.91.468 6.262.526l-.176-1.025 5.31-5.18a.208.208 0 0 0 .06-.216z" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-wechat" style="background-color: rgb(45, 193, 0); border-radius: 0px;"><span class="at4-visually-hidden">Share to WeChat</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-wechat-3" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-wechat"><title id="at-svg-wechat-3">WeChat</title><g><path d="M20.285 12.248c-2.042.107-3.818.727-5.26 2.128-1.457 1.415-2.122 3.15-1.94 5.3-.798-.1-1.525-.208-2.256-.27-.254-.02-.554.01-.767.13-.71.4-1.39.854-2.198 1.36.148-.67.244-1.26.414-1.823.123-.416.066-.647-.316-.917-2.452-1.734-3.485-4.328-2.712-7 .716-2.47 2.473-3.97 4.86-4.75 3.26-1.066 6.92.022 8.902 2.613a6.113 6.113 0 0 1 1.27 3.228zM24.873 25c-.647-.288-1.24-.72-1.87-.787-.63-.066-1.292.298-1.95.365-2.005.205-3.8-.354-5.282-1.726-2.816-2.61-2.414-6.61.845-8.75 2.897-1.9 7.145-1.266 9.187 1.37 1.782 2.302 1.572 5.357-.603 7.29-.63.56-.857 1.02-.453 1.757.074.136.083.308.126.48zM10.886 11.416c.02-.49-.404-.93-.906-.944a.915.915 0 0 0-.952.886.904.904 0 0 0 .895.94.93.93 0 0 0 .963-.882zm4.904-.944c-.504.01-.93.44-.92.93a.92.92 0 0 0 .944.9.903.903 0 0 0 .91-.928.91.91 0 0 0-.934-.902zm1.722 7.39c.412 0 .75-.323.766-.73a.767.767 0 0 0-.76-.794.775.775 0 0 0-.77.79.768.768 0 0 0 .764.734zm4.745-1.523a.762.762 0 0 0-.755.728.75.75 0 0 0 .745.79c.413 0 .74-.313.755-.725a.757.757 0 0 0-.745-.794z" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-tencentqq" style="background-color: rgb(0, 0, 0); border-radius: 0px;"><span class="at4-visually-hidden">Share to Tencent QQ</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-tencentqq-4" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-tencentqq"><title id="at-svg-tencentqq-4">Tencent QQ</title><g><path d="M8.494 14.895c-.066-.155-.098-.368-.098-.638 0-.164.045-.365.135-.602.09-.237.19-.42.295-.552-.008-.18.023-.397.092-.65.07-.255.162-.43.277-.53 0-1.137.378-2.317 1.135-3.54C11.085 7.158 11.975 6.3 13 5.81c1.137-.54 2.463-.81 3.977-.81 1.09 0 2.177.225 3.266.675.4.172.77.37 1.105.59.335.22.626.45.87.687.247.237.472.516.676.835.205.32.377.622.516.908.14.287.272.633.4 1.038.126.405.23.77.312 1.098.082.33.172.73.27 1.205l.012.06c.45.68.676 1.294.676 1.842 0 .115-.037.28-.11.492-.074.21-.11.367-.11.465 0 .008.005.023.017.043a.56.56 0 0 0 .043.06c.016.022.025.036.025.044.63.933 1.123 1.81 1.48 2.634a6.38 6.38 0 0 1 .533 2.56c0 .35-.08.76-.24 1.227-.16.467-.386.7-.68.7a.42.42 0 0 1-.24-.092 1.287 1.287 0 0 1-.233-.214 3.28 3.28 0 0 1-.234-.32c-.085-.13-.15-.24-.195-.325a61.17 61.17 0 0 1-.276-.533c-.01-.008-.022-.012-.038-.012l-.062.05c-.482 1.26-1.023 2.172-1.62 2.737.164.164.415.32.755.473.34.15.622.32.847.51.225.187.37.453.436.797a.816.816 0 0 0-.05.197.462.462 0 0 1-.085.22c-.524.793-1.76 1.19-3.708 1.19-.434 0-.886-.036-1.356-.11-.472-.074-.873-.156-1.204-.246-.332-.09-.76-.212-1.283-.368a4.16 4.16 0 0 0-.283-.086 2.423 2.423 0 0 0-.564-.055 6.403 6.403 0 0 1-.492-.02c-.335.37-.857.636-1.565.8a9.17 9.17 0 0 1-2.07.245c-.286 0-.568-.006-.847-.018-.278-.013-.658-.05-1.14-.11a7.404 7.404 0 0 1-1.24-.253 2.634 2.634 0 0 1-.916-.492c-.266-.22-.4-.483-.4-.785 0-.328.042-.57.124-.73.083-.16.25-.36.504-.596.09-.017.256-.07.497-.16.243-.09.445-.14.61-.147.032 0 .09-.008.17-.025.017-.016.026-.032.026-.05L9.88 23.6c-.392-.09-.834-.522-1.325-1.296-.49-.773-.79-1.414-.896-1.92l-.062-.038c-.033 0-.082.082-.148.246a2.73 2.73 0 0 1-.67.914c-.298.274-.615.428-.95.46h-.013c-.032 0-.057-.018-.073-.055-.017-.036-.037-.058-.062-.066-.188-.442-.282-.85-.282-1.228 0-2.25 1.03-4.158 3.094-5.72z" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-facebook" style="background-color: rgb(59, 89, 152); border-radius: 0px;"><span class="at4-visually-hidden">Share to Facebook</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-facebook-5" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-facebook"><title id="at-svg-facebook-5">Facebook</title><g><path d="M22 5.16c-.406-.054-1.806-.16-3.43-.16-3.4 0-5.733 1.825-5.733 5.17v2.882H9v3.913h3.837V27h4.604V16.965h3.823l.587-3.913h-4.41v-2.5c0-1.123.347-1.903 2.198-1.903H22V5.16z" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-twitter" style="background-color: rgb(29, 161, 242); border-radius: 0px;"><span class="at4-visually-hidden">Share to Twitter</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-twitter-6" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-twitter"><title id="at-svg-twitter-6">Twitter</title><g><path d="M27.996 10.116c-.81.36-1.68.602-2.592.71a4.526 4.526 0 0 0 1.984-2.496 9.037 9.037 0 0 1-2.866 1.095 4.513 4.513 0 0 0-7.69 4.116 12.81 12.81 0 0 1-9.3-4.715 4.49 4.49 0 0 0-.612 2.27 4.51 4.51 0 0 0 2.008 3.755 4.495 4.495 0 0 1-2.044-.564v.057a4.515 4.515 0 0 0 3.62 4.425 4.52 4.52 0 0 1-2.04.077 4.517 4.517 0 0 0 4.217 3.134 9.055 9.055 0 0 1-5.604 1.93A9.18 9.18 0 0 1 6 23.85a12.773 12.773 0 0 0 6.918 2.027c8.3 0 12.84-6.876 12.84-12.84 0-.195-.005-.39-.014-.583a9.172 9.172 0 0 0 2.252-2.336" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-compact" style="background-color: rgb(255, 101, 80); border-radius: 0px;"><span class="at4-visually-hidden">Share to More</span><span class="at-icon-wrapper" style="line-height: 16px; height: 16px; width: 16px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-addthis-7" style="fill: rgb(255, 255, 255); width: 16px; height: 16px;" class="at-icon at-icon-addthis"><title id="at-svg-addthis-7">AddThis</title><g><path d="M18 14V8h-4v6H8v4h6v6h4v-6h6v-4h-6z" fill-rule="evenodd"></path></g></svg></span></a></div></div></div><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/addthis_widget.js.下载" async=""></script><nav id="pagination"><div class="prev-post pull-left"><a href="https://molunerfinn.com/Webpack-Optimize/"><i class="fa fa-chevron-left"></i><span>Vuejs项目的Webpack2构建优化</span></a></div><div class="next-post pull-right"><a href="https://molunerfinn.com/gear-system/"><span>【译】Having fun with Html5 Canvas</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="google-auto-placed" style="text-align: center; width: 100%; height: auto; clear: both;"><ins data-ad-format="auto" class="adsbygoogle adsbygoogle-noablate" data-ad-client="ca-pub-2358465699478507" data-adsbygoogle-status="done" style="display: block; margin: 10px auto 20px; background-color: transparent; height: 90px;"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:900px;background-color:transparent;"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:900px;background-color:transparent;"><iframe width="900" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;border:0px;width:900px;height:90px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(3).html"></iframe></ins></ins></ins></div><div class="post-adv"><a href="https://www.vultr.com/?ref=7231808"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/banner_1.png" width="100%" height="90"></a></div><div id="gitalk-container"><div class="gt-container"><div class="gt-meta"><span class="gt-counts"><a class="gt-link gt-link-counts" href="https://github.com/Molunerfinn/Molunerfinn.github.io/issues/98" target="_blank">7</a> comments</span><div class="gt-user"><div class="gt-user-inner"><span class="gt-user-name">Anonymous</span><span class="gt-ico gt-ico-arrdown"><span class="gt-svg"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1619"><path d="M511.872 676.8c-0.003 0-0.006 0-0.008 0-9.137 0-17.379-3.829-23.21-9.97l-251.277-265.614c-5.415-5.72-8.743-13.464-8.744-21.984 0-17.678 14.33-32.008 32.008-32.008 9.157 0 17.416 3.845 23.25 10.009l228.045 241.103 228.224-241.088c5.855-6.165 14.113-10.001 23.266-10.001 8.516 0 16.256 3.32 21.998 8.736 12.784 12.145 13.36 32.434 1.264 45.233l-251.52 265.6c-5.844 6.155-14.086 9.984-23.223 9.984-0.025 0-0.051 0-0.076 0z" p-id="1620"></path></svg></span></span></div></div></div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span></span></a><div class="gt-header-comment"><textarea class="gt-header-textarea " placeholder="Leave a comment" style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 72px;"></textarea><div class="gt-header-preview markdown-body hide"></div><div class="gt-header-controls"><a class="gt-header-controls-tip" href="https://guides.github.com/features/mastering-markdown/" target="_blank"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z" p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z" p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z" p-id="3085"></path>
</svg>
</span><span class="gt-ico-text">Markdown is supported</span></span></a><button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span></button><button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span></button></div></div></div><div class="gt-comments"><div style="position: relative;"><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/30224517" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/Nebulazheng">Nebulazheng</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">26 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>你好博主，你的这篇博客对我入门学习有很大帮助，但我在使用你的DEMO运行后进行登录报错504，我又按照你的思路重新初始化一个项目并按照你的流程，但在api test时 node app.js运行正常 访问接口却报not found 服务端监控显示404</p></div></div></div><div class="gt-comment gt-comment-admin" style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/12621342" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/Molunerfinn">Molunerfinn</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">26 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>404说明你的路由没配对</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/33571709" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/BelleChou">BelleChou</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">22 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>同在那一步出错</p></div></div></div><div class="gt-comment gt-comment-admin" style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/12621342" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/Molunerfinn">Molunerfinn</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">22 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>如果是新的demo代码，运行的时候注意看README啊...不是node app.js了是node server-entry.js：</p>
<p><a target="_blank" rel="noopener noreferrer" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/54730776-a5929b80-4bc5-11e9-858c-ffa75847aadd.png"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/54730776-a5929b80-4bc5-11e9-858c-ffa75847aadd.png" alt="image" style="max-width:100%;"></a><br>
<a target="_blank" rel="noopener noreferrer" href="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/54730787-b3e0b780-4bc5-11e9-9f50-47ba17ad423b.png"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/54730787-b3e0b780-4bc5-11e9-9f50-47ba17ad423b.png" alt="image" style="max-width:100%;"></a></p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/33571709" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/BelleChou">BelleChou</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">22 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>应该是改成koa2的时候 controller里面没有写next</p></div></div></div><div class="gt-comment gt-comment-admin" style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/12621342" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/Molunerfinn">Molunerfinn</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">22 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>next只是用来控制中间件的，如果你的controller不需要执行下一个中间件是不需要写next的，直接返回ctx.body即可。</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/33571709" alt="头像"></div><div class="gt-comment-content"><div class="gt-comment-header"><a class="gt-comment-username" href="https://github.com/BelleChou">BelleChou</a><span class="gt-comment-text">commented</span><span class="gt-comment-date">22 days ago</span><a class="gt-comment-reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"></path>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p>研究清楚了。我是边跟着blog边改koa2的。刚到api test那里。是自己语法写错了导致404了。小白新手。谢谢你回复我～</p></div></div></div></div></div></div></div><script>var gitalk=new Gitalk({clientID:"f7b6cca0b0a65f07a027",clientSecret:"84b5ccac558161d1bdaa50fc498619fca9d4c640",repo:"Molunerfinn.github.io",owner:"Molunerfinn",admin:"Molunerfinn",id:md5(decodeURI(location.pathname)),language:"en"});gitalk.render("gitalk-container")</script></div></div><footer class="footer-bg" style="background-image:url(https://ws1.sinaimg.cn/large/8700af19ly1fvpabr30o6j22yo1o0q7i.jpg)"><div class="layout" id="footer" style="opacity: 1; display: block; transform: translateY(0px);"><div class="copyright">©2015 - 2019 By Molunerfinn</div><div class="framework-info"><span>Driven - </span><a href="https://hexo.io/"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async="" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/busuanzi.pure.mini.js.下载"></script><span id="busuanzi_container_page_pv" style="display: inline;"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv">36099</span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true" style="opacity: 0; transform: translateX(0px) rotateZ(180deg);"></i><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/anime.min.js.下载"></script><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" style="display: none !important;"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;"><iframe frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0px;width:0px;height:0px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(4).html"></iframe></ins></ins></ins><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/jquery.min.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/jquery.fancybox.min.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/velocity.min.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/velocity.ui.min.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/utils.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/fancybox.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/sidebar.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/copy.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/fireworks.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/transition.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/scroll.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/head.js.下载"></script><script src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/algolia.js.下载"></script><script>/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"))</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"><div class="ais-search-box"><input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Search for Posts" role="textbox" spellcheck="false" type="text" value="" class="ais-search-box--input"></div></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><div id="_atssh" style="visibility: hidden; height: 1px; width: 1px; position: absolute; top: -9999px; z-index: 100000;"><iframe id="_atssh147" title="AddThis utility frame" style="height: 1px; width: 1px; position: absolute; top: 0px; z-index: 100000; border: 0px; left: 0px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/sh.e4e8af4de595fdb10ec1459d.html"></iframe></div><style id="service-icons-0"></style><iframe id="google_osd_static_frame_5417930330818" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(5).html"></iframe></body><iframe id="google_shimpl" style="display: none;" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/saved_resource(6).html"></iframe><iframe id="google_esf" name="google_esf" src="./全栈开发实战：用Vue2+Koa1开发完整的前后端项目（更新Koa2） _ MARKSZのBlog_files/zrt_lookup.html" data-ad-client="ca-pub-2358465699478507" style="display: none;"></iframe><style id="igor_ext_nofollow">a[rel~='nofollow']{outline:.14em dotted red !important;outline-offset:.2em;}a[rel~='nofollow'] > img{outline:thin dotted red !important;outline-offset:.2em;}</style></html>